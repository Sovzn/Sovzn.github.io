<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="Sovzn"><meta name="copyright" content="Sovzn"><meta name="generator" content="Hexo 5.3.0"><meta name="theme" content="hexo-theme-yun"><title>ElasticSearch-7.14 | 大师兄</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#6200ee"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"sovzn.github.io","root":"/","title":"大师兄的小破站","version":"1.3.0","mode":"auto","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="ElasticSearch 7.14-分布式搜索引擎 全文检索 简介 安装 kibana 核心概念 索引 映射 文档 高级查询 Query DSL 索引原理 分词器 过滤查询 聚合查询 整合应用 集群  全文检索全文检索是计算机程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置。当用户查询时根据建立的索引查找，类似于通过字典的检索字表查字的过程。 索: 建立索引">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch-7.14">
<meta property="og:url" content="http://sovzn.github.io/2025/10/26/ElasticSearch-7-14/index.html">
<meta property="og:site_name" content="大师兄">
<meta property="og:description" content="ElasticSearch 7.14-分布式搜索引擎 全文检索 简介 安装 kibana 核心概念 索引 映射 文档 高级查询 Query DSL 索引原理 分词器 过滤查询 聚合查询 整合应用 集群  全文检索全文检索是计算机程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置。当用户查询时根据建立的索引查找，类似于通过字典的检索字表查字的过程。 索: 建立索引">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816103401531-1761485322098.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816131801300-1761485322099.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816132834613-1761485322099.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816135925943-1761485322099.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816140453458-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816143542689-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816145724047-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20210816150025038-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211020205824120-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211020210043010-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211020205934645-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211020211425811-1761485322100.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211020211531271-1761485322101.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211024212944413-1761485322102.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211024213133835-1761485322102.png">
<meta property="og:image" content="http://sovzn.github.io/img/image-20211101113527794-1761485322102.png">
<meta property="article:published_time" content="2025-10-26T13:26:35.000Z">
<meta property="article:modified_time" content="2025-10-26T13:48:06.830Z">
<meta property="article:author" content="Sovzn">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://sovzn.github.io/img/image-20210816103401531-1761485322098.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Sovzn"><img width="96" loading="lazy" src="/Yun.png" alt="Sovzn"><span class="site-author-status" title="永远相信美好的事情即将发生">😊</span></a><div class="site-author-name"><a href="/about/">Sovzn</a></div><a class="site-name" href="/about/site.html">大师兄</a><sub class="site-subtitle"></sub><div class="site-desciption">我只拥有你的月光,我要把它当作骄阳。</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">90</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">30</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">20</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/null" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch-7-14-%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">1.</span> <span class="toc-text">ElasticSearch 7.14-分布式搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-number">1.1.</span> <span class="toc-text">全文检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFElasticSearch"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">什么是ElasticSearch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticSearch%E8%AF%9E%E7%94%9F"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">ElasticSearch诞生</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">传统方式安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="toc-number">1.3.1.0.1.</span> <span class="toc-text">开启远程访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.</span> <span class="toc-text">Docker方式安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kibana"><span class="toc-number">1.4.</span> <span class="toc-text">Kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">传统方式安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">Docker方式安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-compose%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">Docker_compose方式安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.5.</span> <span class="toc-text">核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">1.5.2.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="toc-number">1.6.1.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.6.3.</span> <span class="toc-text">文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">添加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.3.5.</span> <span class="toc-text">批量操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.</span> <span class="toc-text">高级查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.7.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%A3%80%E7%B4%A2"><span class="toc-number">1.7.3.</span> <span class="toc-text">常见检索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89-match-all"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">查询所有[match_all]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D%E6%9F%A5%E8%AF%A2-term"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">关键词查询(term)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2-range"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">范围查询[range]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E6%9F%A5%E8%AF%A2-prefix"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">前缀查询[prefix]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E8%AF%A2-wildcard"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">通配符查询[wildcard]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9Aid%E6%9F%A5%E8%AF%A2-ids"><span class="toc-number">1.7.3.6.</span> <span class="toc-text">多id查询[ids]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2-fuzzy"><span class="toc-number">1.7.3.7.</span> <span class="toc-text">模糊查询[fuzzy]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2-bool"><span class="toc-number">1.7.3.8.</span> <span class="toc-text">布尔查询[bool]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2-multi-match"><span class="toc-number">1.7.3.9.</span> <span class="toc-text">多字段查询[multi_match]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%AD%97%E6%AE%B5%E5%88%86%E8%AF%8D%E6%9F%A5%E8%AF%A2-query-string"><span class="toc-number">1.7.3.10.</span> <span class="toc-text">默认字段分词查询[query_string]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2-highlight"><span class="toc-number">1.7.3.11.</span> <span class="toc-text">高亮查询[highlight]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E6%9D%A1%E6%95%B0-size"><span class="toc-number">1.7.3.12.</span> <span class="toc-text">返回指定条数[size]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-form"><span class="toc-number">1.7.3.13.</span> <span class="toc-text">分页查询[form]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F-sort"><span class="toc-number">1.7.3.14.</span> <span class="toc-text">指定字段排序[sort]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5-source"><span class="toc-number">1.7.3.15.</span> <span class="toc-text">返回指定字段[_source]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">索引原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">1.8.1.</span> <span class="toc-text">倒排索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">索引模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.9.</span> <span class="toc-text">分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis-%E5%92%8C-Analyzer"><span class="toc-number">1.9.1.</span> <span class="toc-text">Analysis 和 Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analyzer-%E7%BB%84%E6%88%90"><span class="toc-number">1.9.2.</span> <span class="toc-text">Analyzer 组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.9.3.</span> <span class="toc-text">内置分词器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%88%86%E8%AF%8D%E5%99%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.4.</span> <span class="toc-text">内置分词器测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%88%86%E8%AF%8D"><span class="toc-number">1.9.5.</span> <span class="toc-text">创建索引设置分词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.9.6.</span> <span class="toc-text">中文分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85IK"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">安装IK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IK%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.6.2.</span> <span class="toc-text">IK使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E8%AF%8D%E3%80%81%E5%81%9C%E7%94%A8%E8%AF%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.6.3.</span> <span class="toc-text">扩展词、停用词配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2-Filter-Query"><span class="toc-number">1.10.</span> <span class="toc-text">过滤查询 Filter Query</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.10.1.</span> <span class="toc-text">过滤查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.3.</span> <span class="toc-text">类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#term-%E3%80%81-terms-Filter"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">term 、 terms Filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ranage-filter"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">ranage filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exists-filter"><span class="toc-number">1.10.3.3.</span> <span class="toc-text">exists filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ids-filter"><span class="toc-number">1.10.3.4.</span> <span class="toc-text">ids filter</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number">1.11.</span> <span class="toc-text">整合应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.11.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.11.2.</span> <span class="toc-text">配置客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.11.3.</span> <span class="toc-text">客户端对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticsearchOperations"><span class="toc-number">1.11.3.1.</span> <span class="toc-text">ElasticsearchOperations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.11.3.1.1.</span> <span class="toc-text">相关注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><span class="toc-number">1.11.3.1.2.</span> <span class="toc-text">索引文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.11.3.1.3.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.11.3.1.4.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.11.3.1.5.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89"><span class="toc-number">1.11.3.1.6.</span> <span class="toc-text">删除所有</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89"><span class="toc-number">1.11.3.1.7.</span> <span class="toc-text">查询所有</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RestHighLevelClient"><span class="toc-number">1.11.4.</span> <span class="toc-text">RestHighLevelClient</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%98%A0%E5%B0%84"><span class="toc-number">1.11.4.0.1.</span> <span class="toc-text">创建索引映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3-1"><span class="toc-number">1.11.4.0.2.</span> <span class="toc-text">索引文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3-2"><span class="toc-number">1.11.4.0.3.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-2"><span class="toc-number">1.11.4.0.4.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-id-%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">1.11.4.0.5.</span> <span class="toc-text">基于 id 查询文档</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89-1"><span class="toc-number">1.11.4.0.6.</span> <span class="toc-text">查询所有</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.11.4.0.7.</span> <span class="toc-text">综合查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.12.</span> <span class="toc-text">聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="toc-number">1.12.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.12.2.</span> <span class="toc-text">测试数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">1.12.3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%88%86%E7%BB%84"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">根据某个字段分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">求最大值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E6%9C%80%E5%B0%8F%E5%80%BC"><span class="toc-number">1.12.3.3.</span> <span class="toc-text">求最小值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="toc-number">1.12.3.4.</span> <span class="toc-text">求平均值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E5%92%8C"><span class="toc-number">1.12.3.5.</span> <span class="toc-text">求和</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E5%BA%94%E7%94%A8-1"><span class="toc-number">1.12.3.6.</span> <span class="toc-text">整合应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4-Cluster"><span class="toc-number">1.13.</span> <span class="toc-text">集群 Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.13.1.</span> <span class="toc-text">相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-2"><span class="toc-number">1.13.1.3.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84-2"><span class="toc-number">1.13.1.4.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-2"><span class="toc-number">1.13.1.5.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%89%87"><span class="toc-number">1.13.1.6.</span> <span class="toc-text">分片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6"><span class="toc-number">1.13.1.7.</span> <span class="toc-text">复制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">1.13.2.</span> <span class="toc-text">搭建集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">集群规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99-compose-%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.3.</span> <span class="toc-text">编写 compose 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kibana-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.4.</span> <span class="toc-text">kibana 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-number">1.13.2.5.</span> <span class="toc-text">查看集群状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85head%E6%8F%92%E4%BB%B6"><span class="toc-number">1.13.3.</span> <span class="toc-text">安装head插件</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://Sovzn.github.io/2025/10/26/ElasticSearch-7-14/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Sovzn"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="大师兄"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">ElasticSearch-7.14</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2025-10-26 21:26:35" itemprop="dateCreated datePublished" datetime="2025-10-26T21:26:35+08:00">2025-10-26</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/ElasticSearch/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">ElasticSearch</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/ElasticSearch/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">ElasticSearch</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><h1 id="ElasticSearch-7-14-分布式搜索引擎"><a href="#ElasticSearch-7-14-分布式搜索引擎" class="headerlink" title="ElasticSearch 7.14-分布式搜索引擎"></a>ElasticSearch 7.14-分布式搜索引擎</h1><ol>
<li>全文检索</li>
<li>简介</li>
<li>安装</li>
<li>kibana</li>
<li>核心概念 索引 映射 文档</li>
<li>高级查询 Query DSL</li>
<li>索引原理</li>
<li>分词器</li>
<li>过滤查询</li>
<li>聚合查询</li>
<li>整合应用</li>
<li>集群</li>
</ol>
<h2 id="全文检索"><a href="#全文检索" class="headerlink" title="全文检索"></a>全文检索</h2><p><code>全文检索</code>是计算机程序通过扫描文章中的<code>每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置</code>。当用户<code>查询时根据建立的索引查找</code>，类似于通过字典的检索字表查字的过程。</p>
<p>索: 建立索引 文本—-&gt;切分 —&gt; 词 文章出现过  出现多少次 </p>
<p>检索: 查询  关键词—&gt; 索引中–&gt; 符合条件文章  相关度排序</p>
<p>全文检索(Full-Text Retrieval)以文本作为检索对象，找出含有指定词汇的文本。<strong>全面、准确和快速是衡量全文检索系统的关键指标。</strong></p>
<ul>
<li><code>只处理文本、不处理语义</code>  </li>
<li><code>搜索时英文不区分大小写</code> </li>
<li><code>结果列表有相关度排序</code></li>
</ul>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h4 id="什么是ElasticSearch"><a href="#什么是ElasticSearch" class="headerlink" title="什么是ElasticSearch"></a>什么是ElasticSearch</h4><p>​    <code>ElasticSearch</code> 简称 <code>ES</code> ，是基于<code>Apache Lucene</code>构建的<code>开源搜索引擎</code>，是当前最流行的<code>企业级搜索引擎</code>。<code>Lucene本身就可以被认为迄今为止性能最好的一款开源搜索引擎工具包</code>，但是lucene的API相对复杂，需要深厚的搜索理论。很难集成到实际的应用中去。<code>ES是采用java语言编写，提供了简单易用的RestFul API，开发者可以使用其简单的RestFul API，开发相关的搜索功能，从而避免lucene的复杂性</code>。</p>
<h4 id="ElasticSearch诞生"><a href="#ElasticSearch诞生" class="headerlink" title="ElasticSearch诞生"></a>ElasticSearch诞生</h4><p>​    多年前，一个叫做<code>Shay Banon</code>的刚结婚不久的失业开发者，由于妻子要去伦敦学习厨师，他便跟着也去了。在他找工作的过程中，为了给妻子构建一个食谱的搜索引擎，他开始构建一个早期版本的<code>Lucene</code>。</p>
<p>直接基于Lucene工作会比较困难，所以<code>Shay</code>开始抽象<code>Lucene</code>代码以便Java程序员可以在应用中添加搜索功能。他发布了他的第一个开源项目，叫做“<code>Compass</code>”。</p>
<p>后来<code>Shay</code>找到一份工作，这份工作处在<code>高性能和内存数据网格的分布式环境中</code>，因此<code>高性能的、实时的、分布式的搜索引擎</code>也是理所当然需要的。然后他决定重写<code>Compass</code>库使其成为一个独立的服务叫做<code>Elasticsearch</code>。</p>
<p>第一个公开版本出现在<code>2010年2月</code>，在那之后Elasticsearch已经成为Github上<code>最受欢迎的项目之一，</code>代码贡献者超过<code>300</code>人。一家主营<code>Elasticsearch的公司</code>就此成立，他们一边提供商业支持一边开发新功能，不过<code>Elasticsearch将永远开源</code>且对所有人可用。</p>
<p>Shay的妻子依旧等待着她的<code>食谱搜索……</code></p>
<p>目前国内大厂几乎无一不用Elasticsearch，阿里，腾讯，京东，美团 等等 …..</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>传统方式安装  下载安装包—&gt; 平台 window macos  linux(ubuntu)</li>
<li>Docker 方式安装  推荐</li>
</ul>
<h3 id="传统方式安装"><a href="#传统方式安装" class="headerlink" title="传统方式安装"></a>传统方式安装</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.环境准备</span>
<span class="token list punctuation">-</span> centos7.x+、ubuntu、windows、macos
<span class="token list punctuation">-</span> 安装jdk11.0+ 并配置环境变量 jdk8 

<span class="token title important"><span class="token punctuation">#</span> 1.下载ES</span>
<span class="token list punctuation">-</span> https://www.elastic.co/cn/start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20210816103401531-1761485322098.png" alt="image-20210816103401531" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.安装ES不用使用root用户,创建普通用户</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 添加用户名</span>
$ <span class="token function">useradd</span> chenyn
<span class="token comment"># 修改密码</span>
$ <span class="token function">passwd</span> chenyn
<span class="token comment"># 普通用户登录</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.解压缩ES安装包</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">tar</span> -zxvf elasticsearch-7.14.0-linux-x86_64.tar.gz 
$ ll
总用量 <span class="token number">650168</span>
drwxr-xr-x. <span class="token number">10</span> chenyn chenyn       <span class="token number">167</span> <span class="token number">8</span>月  <span class="token number">16</span> <span class="token number">11</span>:07 elasticsearch-7.14.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.查看ES解压包中目录结构</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>chenyn@localhost elasticsearch-7.14.0<span class="token punctuation">]</span>$ ll
- bin 		启动ES服务脚本目录
- config  ES配置文件的目录
- data    ES的数据存放目录
- jdk     ES提供需要指定的jdk目录
- lib     ES依赖第三方库的目录
- logs    ES的日志目录
- modules 模块的目录
- plugins 插件目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20210816131801300-1761485322099.png" alt="image-20210816131801300" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 5.启动ES服务</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>chenyn@localhost ~<span class="token punctuation">]</span>$ ./elasticsearch-7.14.0/bin/elasticsearch
加 -d 后台启动
<span class="token punctuation">[</span>chenyn@localhost ~<span class="token punctuation">]</span>$ ./elasticsearch-7.14.0/bin/elasticsearch -d  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20210816132834613-1761485322099.png" alt="image-20210816132834613" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 这个错误时系统jdk版本与es要求jdk版本不一致,es默认需要jdk11以上版本,当前系统使用的jdk8,需要从新安装jdk11才行!
<span class="token list punctuation">-</span> 解决方案:
	1.安装jdk11+ 配置环境变量、
	2.ES包中jdk目录就是es需要jdk,只需要将这个目录配置到ES_JAVA_HOME环境变即可、
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 6.配置环境变量</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">vim</span> /etc/profile
- <span class="token builtin class-name">export</span> <span class="token assign-left variable">ES_JAVA_HOME</span><span class="token operator">=</span>指定为ES安装目录中jdk目录
- <span class="token builtin class-name">source</span> /etc/profile
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20210816135925943-1761485322099.png" alt="image-20210816135925943" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 7.从新启动ES服务</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/img/image-20210816140453458-1761485322100.png" alt="image-20210816140453458" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 8.ES启动默认监听9200端口,访问9200</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">curl</span> http://localhost:9200
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/img/image-20210816143542689-1761485322100.png" alt="image-20210816143542689" loading="lazy"></p>
<h5 id="开启远程访问"><a href="#开启远程访问" class="headerlink" title="开启远程访问"></a>开启远程访问</h5><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.默认ES无法使用主机ip进行远程连接,需要开启远程连接权限</span>
<span class="token list punctuation">-</span> 修改ES安装包中config/elasticsearch.yml配置文件
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">vim</span> elasticsearch.yml
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/img/image-20210816145724047-1761485322100.png" alt="image-20210816145724047" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 2.重新启动ES服务</span>
<span class="token list punctuation">-</span> ./elasticsearch
<span class="token list punctuation">-</span> 启动出现如下错误:
	`bootstrap check failure [1] of <span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> max</span> file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]
	`bootstrap check failure [2] of <span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> max</span> number of threads [3802] for user [chenyn] is too low, increase to at least [4096]
	`bootstrap check failure [3] of <span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> max</span> virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]
	`bootstrap check failure [4] of <span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> the</span> default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20210816150025038-1761485322100.png" alt="image-20210816150025038" loading="lazy"></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.解决错误-1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">vim</span> /etc/security/limits.conf
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 在最后面追加下面内容</span>
<span class="token list punctuation">*</span>               soft    nofile          65536
<span class="token list punctuation">*</span>               hard    nofile          65536
<span class="token list punctuation">*</span>               soft    nproc           4096
<span class="token list punctuation">*</span>               hard    nproc           4096
<span class="token title important"><span class="token punctuation">#</span> 退出重新登录检测配置是否生效:</span>
ulimit -Hn
ulimit -Sn
ulimit -Hu
ulimit -Su
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.解决错误-2</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#进入limits.d目录下修改配置文件。</span>
$ <span class="token function">vim</span> /etc/security/limits.d/20-nproc.conf
<span class="token comment"># 修改为 </span>
启动ES用户名 soft nproc <span class="token number">4096</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.解决错误-3</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 编辑系统sysctl.conf文件</span>
$ <span class="token function">vim</span> /etc/sysctl.conf
vm.max_map_count<span class="token operator">=</span><span class="token number">655360</span> <span class="token comment">#centos7 系统</span>
vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span> <span class="token comment">#ubuntu 系统</span>
<span class="token comment"># 执行以下命令生效：</span>
$ sysctl -p
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.解决错误-4</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 编辑elasticsearch.yml配置文件   es默认是以集群方式启动 指定初始化节点名称</span>
$ <span class="token function">vim</span> conf/elasticsearch.yml
cluster.initial_master_nodes: <span class="token punctuation">[</span><span class="token string">"node-1"</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 4.重启启动ES服务,并通过浏览器访问</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"localhost.localdomain"</span><span class="token punctuation">,</span>
  <span class="token property">"cluster_name"</span><span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>
  <span class="token property">"cluster_uuid"</span><span class="token operator">:</span> <span class="token string">"OWh3xLYwR-6lZ_fQNhVY3A"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"number"</span><span class="token operator">:</span> <span class="token string">"7.14.0"</span><span class="token punctuation">,</span>
    <span class="token property">"build_flavor"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token property">"build_type"</span><span class="token operator">:</span> <span class="token string">"tar"</span><span class="token punctuation">,</span>
    <span class="token property">"build_hash"</span><span class="token operator">:</span> <span class="token string">"dd5a0a2acaa2045ff9624f3729fc8a6f40835aa1"</span><span class="token punctuation">,</span>
    <span class="token property">"build_date"</span><span class="token operator">:</span> <span class="token string">"2021-07-29T20:49:32.864135063Z"</span><span class="token punctuation">,</span>
    <span class="token property">"build_snapshot"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"lucene_version"</span><span class="token operator">:</span> <span class="token string">"8.9.0"</span><span class="token punctuation">,</span>
    <span class="token property">"minimum_wire_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.8.0"</span><span class="token punctuation">,</span>
    <span class="token property">"minimum_index_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"6.0.0-beta1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"tagline"</span><span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Docker方式安装"><a href="#Docker方式安装" class="headerlink" title="Docker方式安装"></a>Docker方式安装</h3><blockquote>
<p>docker安装是默认开启远程连接的</p>
</blockquote>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.获取镜像</span>
<span class="token list punctuation">-</span> docker pull elasticsearch:7.14.0

<span class="token title important"><span class="token punctuation">#</span> 2.运行es</span>
<span class="token list punctuation">-</span> docker run -d -p 9200:9200 -p 9300:9300  -e "discovery.type=single-node"  elasticsearch:7.14.0

<span class="token title important"><span class="token punctuation">#</span> 3.访问ES</span>
<span class="token list punctuation">-</span> http://10.15.0.5:9200/
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p><code>Kibana Navicat</code>是一个针对<code>Elasticsearch mysql</code>的<code>开源分析及可视化平台</code>，使用Kibana可以<code>查询、查看并与存储在ES索引的数据进行交互操作</code>，使用Kibana能执行高级的<code>数据分析，并能以图表、表格和地图的形式查看数据。</code></p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p>Kibana的安装版本要和ES一致</p>
</blockquote>
<h4 id="传统方式安装-1"><a href="#传统方式安装-1" class="headerlink" title="传统方式安装"></a>传统方式安装</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1. 下载Kibana</span>
<span class="token list punctuation">-</span> https://www.elastic.co/downloads/kibana

<span class="token title important"><span class="token punctuation">#</span> 2. 安装下载的kibana</span>
<span class="token list punctuation">-</span> $ tar -zxvf kibana-7.14.0-linux-x86_64.tar.gz 
  
<span class="token title important"><span class="token punctuation">#</span> 3. 编辑kibana配置文件</span>
<span class="token list punctuation">-</span> $ vim /Kibana 安装目录中 config 目录/kibana/kibana.yml

<span class="token title important"><span class="token punctuation">#</span> 4. 修改如下配置</span>
<span class="token list punctuation">-</span> server.host: "0.0.0.0"                		# 开启kibana远程访问
<span class="token title important"><span class="token punctuation">#######</span> 注：</span>
<span class="token list punctuation">-</span> elasticsearch.hosts: ["http://localhost:9200"]   #ES服务器地址

<span class="token title important"><span class="token punctuation">#</span> 5. 启动kibana</span>
<span class="token list punctuation">-</span> ./bin/kibana

<span class="token title important"><span class="token punctuation">#</span> 6. 访问kibana的web界面  </span>
<span class="token list punctuation">-</span> http://10.15.0.5:5601/   #kibana默认端口为5601    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Docker方式安装-1"><a href="#Docker方式安装-1" class="headerlink" title="Docker方式安装"></a>Docker方式安装</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.获取镜像</span>
<span class="token list punctuation">-</span> docker pull kibana:7.14.0

<span class="token title important"><span class="token punctuation">#</span> 2.运行kibana</span>
<span class="token list punctuation">-</span> docker run -d  --name kibana -p 5601:5601 kibana:7.14.0

<span class="token title important"><span class="token punctuation">#</span> 3.进入容器连接到ES,重启kibana容器,访问</span>
<span class="token list punctuation">-</span> 进入容器：docker exec -it 容器名 bash
<span class="token list punctuation">-</span> cd /config
<span class="token list punctuation">-</span> 修改 kibana.yml  连接ES
<span class="token list punctuation">-</span> http://10.15.0.3:5601

<span class="token title important"><span class="token punctuation">#</span> 以上方法都需每次修改kibana.yml，很麻烦，可以把配置文件提取出来修改，启动命令时加载就行 ↓</span>
<span class="token title important"><span class="token punctuation">#</span> 基于数据卷加载配置文件方式运行</span>
<span class="token list punctuation">-</span> a.从容器复制kibana配置文件出来 
<span class="token list punctuation">-</span> docker cp 容器名:容器内文件名  会把docker内文件复制到当前目录 如：docker cp 4565fg4b544f:/usr/share/kibana/config/kiban.yml
<span class="token list punctuation">-</span> b.修改配置文件为对应ES服务器地址
<span class="token list punctuation">-</span> c.通过数据卷加载配置文件方式启动
  `docker run -d -v /root/kibana.yml:/usr/share/kibana/config/kibana.yml  --name kibana -p 5601:5601 kibana:7.14.0
  
<span class="token title important"><span class="token punctuation">#</span> ----------------------------也可以直接在命令指定 es地址</span>

docker run -d \
  --name kibana \
  -p 5601:5601 \
  --memory="512m" \
  --memory-swap="1g" \
  -e "ELASTICSEARCH_HOSTS=http://120.46.143.152:9200" \
  kibana:7.14.0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Docker-compose方式安装"><a href="#Docker-compose方式安装" class="headerlink" title="Docker_compose方式安装"></a>Docker_compose方式安装</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
  <span class="token key atrule">plugin</span><span class="token punctuation">:</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">es</span><span class="token punctuation">:</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span>
      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"es"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"discovery.type=single-node"</span>
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> config<span class="token punctuation">:</span>/usr/share/elasticsearch/config
      <span class="token punctuation">-</span> plugin<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins

  <span class="token key atrule">kibana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5601:5601"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"es"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./kibana.yml<span class="token punctuation">:</span>/usr/share/kibana/config/kibana.yml
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># kibana配置文件 连接到ES</span>
<span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">"0"</span>
<span class="token key atrule">server.shutdownTimeout</span><span class="token punctuation">:</span> <span class="token string">"5s"</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"http://elasticsearch:9200"</span> <span class="token punctuation">]</span>
<span class="token key atrule">monitoring.ui.container.elasticsearch.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引<Index></h3><p><strong><code>一个索引就是一个拥有几分相似特征的文档的集合</code>**。比如说，你可以有一个商品数据的索引，一个订单数据的索引，还有一个用户数据的索引。</strong><code>一个索引由一个名字来标识</code><strong><code>(必须全部是小写字母的)</code>**，</strong>并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。</p>
<h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射<Mapping></h3><p>**<code>映射是定义一个文档和它所包含的字段如何被存储和索引的过程</code>**。在默认配置下，ES可以根据插入的数据<code>自动地创建mapping，也可以手动创建mapping</code>。 mapping中主要包括字段名、字段类型等 </p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档<Document></h3><p>**<code>文档是索引中存储的一条条数据。一条文档是一个可被索引的最小单元</code>**。ES中的文档采用了轻量级的JSON格式数据来表示。 </p>
<hr>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引<index></h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.创建索引</span>
<span class="token list punctuation">-</span> PUT /索引名 ====> PUT /products
<span class="token list punctuation">-</span> 注意: 
		1.ES中索引健康转态  red(索引不可用) 、yellwo(索引可用,存在风险)、green(健康)
		2.默认ES在创建索引时会为索引创建1个备份索引和一个primary索引
		
<span class="token title important"><span class="token punctuation">#</span> 2.创建索引 进行索引分片配置</span>
<span class="token list punctuation">-</span> PUT /products
&#123;
  "settings": &#123;
    "number_of_shards": 1, #指定主分片的数量
    "number_of_replicas": 0 #指定副本分片的数量
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211020205824120-1761485322100.png" alt="image-20211020205824120" loading="lazy"></p>
<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 查询所有索引</span>
<span class="token list punctuation">-</span> GET /_cat/indices?v
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211020210043010-1761485322100.png" alt="image-20211020210043010" loading="lazy"></p>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 3.删除索引</span>
<span class="token list punctuation">-</span> DELETE /索引名 =====> DELETE /products
<span class="token list punctuation">-</span> DELETE /<span class="token italic"><span class="token punctuation">*</span><span class="token content">     `</span><span class="token punctuation">*</span></span>代表通配符,代表所有索引`
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211020205934645-1761485322100.png" alt="image-20211020205934645" loading="lazy"></p>
<h3 id="映射-1"><a href="#映射-1" class="headerlink" title="映射"></a>映射<mapping></h3><h4 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h4><p><strong>如果创建索引时没创建映射，在插入文档时会自动创建</strong></p>
<p>字符串类型: keyword 关键字 关键词 、text 一段文本</p>
<p>数字类型：integer long  </p>
<p>小数类型：float double</p>
<p>布尔类型：boolean </p>
<p>日期类型：date</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.创建索引&amp;映射</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /products
<span class="token punctuation">&#123;</span> 
  <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"number_of_shards"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"double"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"created_at"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"date"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211020211425811-1761485322100.png" alt="image-20211020211425811" loading="lazy"></p>
<blockquote>
<p>说明: ES中支持字段类型非常丰富，如：text、keyword、integer、long、ip 等。更多参见<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.15/mapping-types.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.15/mapping-types.html</a></p>
</blockquote>
<h4 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.查看某个索引的映射</span>
<span class="token list punctuation">-</span> GET /索引名/_mapping =====> GET /products/_mapping
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211020211531271-1761485322101.png" alt="image-20211020211531271" loading="lazy"></p>
<h3 id="文档-1"><a href="#文档-1" class="headerlink" title="文档"></a>文档<document></h3><h4 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /products/_doc/1 #指定文档id 
&#123;
  "title":"iphone13",
  "price":8999.99,
  "created_at":"2021-09-15",
  "description":"iPhone 13屏幕采用6.1英寸OLED屏幕。"
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /products/_doc/ #自动生成文档id
&#123;
  "title":"iphone14",
  "price":8999.99,
  "created_at":"2021-09-15",
  "description":"iPhone 13屏幕采用6.8英寸OLED屏幕"
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"products"</span><span class="token punctuation">,</span>
  <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
  <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"sjfYnXwBVVbJgt24PlVU"</span><span class="token punctuation">,</span>
  <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json">GET /products/_doc/<span class="token number">1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"products"</span><span class="token punctuation">,</span>
  <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
  <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
  <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"found"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"iphone13"</span><span class="token punctuation">,</span>
    <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">8999.99</span><span class="token punctuation">,</span>
    <span class="token property">"created_at"</span> <span class="token operator">:</span> <span class="token string">"2021-09-15"</span><span class="token punctuation">,</span>
    <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"iPhone 13屏幕采用6.1英寸OLED屏幕"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json">DELETE /products/_doc/<span class="token number">1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"products"</span><span class="token punctuation">,</span>
  <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
  <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
  <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"deleted"</span><span class="token punctuation">,</span>
  <span class="token property">"_shards"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"total"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"successful"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"failed"</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"_seq_no"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"_primary_term"</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">PUT /products/_doc/sjfYnXwBVVbJgt24PlVU
&#123;
  "title":"iphon15"
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>说明: 这种更新方式是先删除原始文档,在将更新文档以新的内容插入。</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /products/_doc/sjfYnXwBVVbJgt24PlVU/_update
&#123;
    "doc" : &#123;
        "title" : "iphon15"
    &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>说明: 这种方式可以将数据原始内容保存,并在此基础上更新。</p>
</blockquote>
<h4 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /products/_doc/_bulk #批量索引两条文档
 	&#123;"index":&#123;"_id":"1"&#125;&#125;
  		&#123;"title":"iphone14","price":8999.99,"created_at":"2021-09-15","description":"iPhone 13屏幕采用6.8英寸OLED屏幕"&#125;
	&#123;"index":&#123;"_id":"2"&#125;&#125;
  		&#123;"title":"iphone15","price":8999.99,"created_at":"2021-09-15","description":"iPhone 15屏幕采用10.8英寸OLED屏幕"&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /products/_doc/_bulk #更新文档同时删除文档
	&#123;"update":&#123;"_id":"1"&#125;&#125;
		&#123;"doc":&#123;"title":"iphone17"&#125;&#125;
	&#123;"delete":&#123;"_id":2&#125;&#125;
	&#123;"index":&#123;&#125;&#125;
		&#123;"title":"iphone19","price":8999.99,"created_at":"2021-09-15","description":"iPhone 19屏幕采用61.8英寸OLED屏幕"&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>说明:批量时不会因为一个失败而全部失败,而是继续执行后续操作,在返回时按照执行的状态返回!</p>
</blockquote>
<hr>
<h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>​    ES中提供了一种强大的检索数据方式,这种检索方式称之为<code>Query DSL</code><Domain Specified Language> ,<code>Query DSL</code>是利用<code>Rest API传递JSON格式的请求体(Request Body)数据</code>与ES进行交互，这种方式的<code>丰富查询语法</code>让ES检索变得<code>更强大，更简洁</code>。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> GET /索引名/_doc/_search &#123;json格式请求体数据&#125;</span>
<span class="token title important"><span class="token punctuation">#</span> GET /索引名/_search &#123;json格式请求体数据&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>测试数据</li>
</ul>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.创建索引 映射</span>
PUT /products/
&#123;
  "mappings": &#123;
    "properties": &#123;
      "title":&#123;
        "type": "keyword"
      &#125;,
      "price":&#123;
        "type": "double"
      &#125;,
      "created_at":&#123;
        "type":"date"
      &#125;,
      "description":&#123;
        "type":"text"
      &#125;
    &#125;
  &#125;
&#125;
<span class="token title important"><span class="token punctuation">#</span> 2.测试数据</span>
PUT /products/_doc/_bulk
&#123;"index":&#123;&#125;&#125;
  &#123;"title":"iphone12 pro","price":8999,"created_at":"2020-10-23","description":"iPhone 12 Pro采用超瓷晶面板和亚光质感玻璃背板，搭配不锈钢边框，有银色、石墨色、金色、海蓝色四种颜色。宽度:71.5毫米，高度:146.7毫米，厚度:7.4毫米，重量：187克"&#125;
&#123;"index":&#123;&#125;&#125;
  &#123;"title":"iphone12","price":4999,"created_at":"2020-10-23","description":"iPhone 12 高度：146.7毫米；宽度：71.5毫米；厚度：7.4毫米；重量：162克（5.73盎司） [5]  。iPhone 12设计采用了离子玻璃，以及7000系列铝金属外壳。"&#125;
&#123;"index":&#123;&#125;&#125;
  &#123;"title":"iphone13","price":6000,"created_at":"2021-09-15","description":"iPhone 13屏幕采用6.1英寸OLED屏幕；高度约146.7毫米，宽度约71.5毫米，厚度约7.65毫米，重量约173克。"&#125;
&#123;"index":&#123;&#125;&#125;
  &#123;"title":"iphone13 pro","price":8999,"created_at":"2021-09-15","description":"iPhone 13Pro搭载A15 Bionic芯片，拥有四种配色，支持5G。有128G、256G、512G、1T可选，售价为999美元起。"&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="常见检索"><a href="#常见检索" class="headerlink" title="常见检索"></a>常见检索</h3><h4 id="查询所有-match-all"><a href="#查询所有-match-all" class="headerlink" title="查询所有[match_all]"></a>查询所有[match_all]</h4><blockquote>
<p><strong>match_all关键字:</strong>  返回索引中的全部文档</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "match_all": &#123;&#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="关键词查询-term"><a href="#关键词查询-term" class="headerlink" title="关键词查询(term)"></a>关键词查询(term)</h4><blockquote>
<p> <strong>term 关键字</strong>: 用来使用<strong>关键词</strong>（keyword）查询，全部匹配 ，如果数据分词，会使用搜索词在分词结果中全部匹配，入股：“我是中国人”–&gt; 我,是，中国，中国人，国人，用“国”字搜索，则搜索不到，用“我”，“中国人”搜索，则能搜索到数据</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
 "query": &#123;
   "term": &#123;
     "price": &#123;
       "value": 4999
     &#125;
   &#125;
 &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>NOTE1:  通过使用term查询得知ES中默认使用分词器为 <strong>标准分词器</strong></p>
<p><code>标准分词器(StandardAnalyzer),标准分词器对于英文单词分词,对于中文单字分词</code>。</p>
</blockquote>
<blockquote>
<p>NOTE2:  <strong>在ES的Mapping Type 中 keyword , date ,integer, long , double , boolean or ip 这些类型不分词，只有text类型分词`。</strong></p>
</blockquote>
<h4 id="范围查询-range"><a href="#范围查询-range" class="headerlink" title="范围查询[range]"></a>范围查询[range]</h4><blockquote>
<p><strong>range 关键字</strong>: 用来指定查询指定范围内的文档</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "range": &#123;
      "price": &#123;
        "gte": 1400,
        "lte": 9999
      &#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="前缀查询-prefix"><a href="#前缀查询-prefix" class="headerlink" title="前缀查询[prefix]"></a>前缀查询[prefix]</h4><blockquote>
<p><strong>prefix 关键字</strong>: 用来检索含有指定前缀的关键词的相关文档</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "prefix": &#123;
      "title": &#123;
        "value": "ipho"
      &#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="通配符查询-wildcard"><a href="#通配符查询-wildcard" class="headerlink" title="通配符查询[wildcard]"></a>通配符查询[wildcard]</h4><blockquote>
<p><strong>wildcard 关键字</strong>: 通配符查询     *<em>? 用来匹配一个任意字符  * 用来匹配多个任意字符*</em></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "wildcard": &#123;
      "description": &#123;
        "value": "iphon*"
      &#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="多id查询-ids"><a href="#多id查询-ids" class="headerlink" title="多id查询[ids]"></a>多id查询[ids]</h4><blockquote>
<p><strong>ids 关键字</strong> : 值为数组类型,用来根据一组id获取多个对应的文档</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "ids": &#123;
      "values": ["verUq3wBOTjuBizqAegi","vurUq3wBOTjuBizqAegk"]
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="模糊查询-fuzzy"><a href="#模糊查询-fuzzy" class="headerlink" title="模糊查询[fuzzy]"></a>模糊查询[fuzzy]</h4><blockquote>
<p><strong>fuzzy 关键字</strong>: 用来模糊查询含有指定关键字的文档</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "fuzzy": &#123;
      "description": "iphooone"
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意: <code>fuzzy 模糊查询  最大模糊错误 必须在0-2之间</code></p>
<ul>
<li><p>搜索关键词长度为 2 不允许存在模糊</p>
</li>
<li><p>搜索关键词长度为3-5 允许一次模糊</p>
</li>
<li><p>搜索关键词长度大于5 允许最大2模糊</p>
</li>
</ul>
</blockquote>
<h4 id="布尔查询-bool"><a href="#布尔查询-bool" class="headerlink" title="布尔查询[bool]"></a>布尔查询[bool]</h4><blockquote>
<p><strong>bool 关键字</strong>: 用来组合多个条件实现复杂查询</p>
<p>​    <strong>must: 相当于&amp;&amp; 同时成立</strong></p>
<p>​    <strong>should: 相当于|| 成立一个就行</strong></p>
<p>​    <strong>must_not: 相当于!  不能满足任何一个</strong></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
      
        &#123;"term": &#123;
          "price": &#123;
            "value": 4999
          &#125;
        &#125;
        &#125;,
        
        
        &#123;
      "ids": &#123;
      "values": ["verUq3wBOTjuBizqAegi","vurUq3wBOTjuBizqAegk"]
        &#125;
        &#125;
  
        
      ]
    &#125;
  &#125;
&#125;

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="多字段查询-multi-match"><a href="#多字段查询-multi-match" class="headerlink" title="多字段查询[multi_match]"></a>多字段查询[multi_match]</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "multi_match": &#123;
      "query": "iphone13 毫",
      "fields": ["title","description"]
    &#125;
  &#125;
&#125;
注意: 字段类型分词,将查询条件分词之后进行查询改字段  如果该字段不分词就会将查询条件作为整体进行查询
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="默认字段分词查询-query-string"><a href="#默认字段分词查询-query-string" class="headerlink" title="默认字段分词查询[query_string]"></a>默认字段分词查询[query_string]</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "query_string": &#123;
      "default_field": "description",
      "query": "屏幕真的非常不错"
    &#125;
  &#125;
&#125;
注意: 查询字段分词就将查询条件分词查询  查询字段不分词将查询条件不分词查询
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="高亮查询-highlight"><a href="#高亮查询-highlight" class="headerlink" title="高亮查询[highlight]"></a>高亮查询[highlight]</h4><blockquote>
<p>es 7中，只有能分词的字段才能高亮</p>
</blockquote>
<blockquote>
<p><strong>highlight 关键字</strong>: 可以让符合条件的文档中的关键词高亮</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "term": &#123;
      "description": &#123;
        "value": "iphone"
      &#125;
    &#125;
  &#125;,
  "highlight": &#123;
    "fields": &#123;
      "*":&#123;&#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>自定义高亮html标签</strong>: 可以在highlight中使用<code>pre_tags</code>和<code>post_tags</code></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "term": &#123;
      "description": &#123;
        "value": "iphone"
      &#125;
    &#125;
  &#125;,
  "highlight": &#123;
    "post_tags": ["&lt;/span>"], 
    "pre_tags": ["&lt;span style='color:red'>"],
    "fields": &#123;
      "*":&#123;&#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>多字段高亮 使用<code>require_field_match</code>开启多个字段高亮</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "term": &#123;
      "description": &#123;
        "value": "iphone"
      &#125;
    &#125;
  &#125;,
  "highlight": &#123;
    "require_field_match": "false",
    "post_tags": ["&lt;/span>"], 
    "pre_tags": ["&lt;span style='color:red'>"],
    "fields": &#123;
      "*":&#123;&#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="返回指定条数-size"><a href="#返回指定条数-size" class="headerlink" title="返回指定条数[size]"></a>返回指定条数[size]</h4><blockquote>
<p><strong>size 关键字</strong>: 指定查询结果中返回指定条数。  <strong>默认返回值10条</strong></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "match_all": &#123;&#125;
  &#125;,
  "size": 5
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="分页查询-form"><a href="#分页查询-form" class="headerlink" title="分页查询[form]"></a>分页查询[form]</h4><blockquote>
<p><strong>from 关键字</strong>: 用来指定起始返回位置，和<strong>size关键字连用可实现分页效果</strong></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "match_all": &#123;&#125;
  &#125;,
  "size": 5,
  "from": 0
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="指定字段排序-sort"><a href="#指定字段排序-sort" class="headerlink" title="指定字段排序[sort]"></a>指定字段排序[sort]</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "match_all": &#123;&#125;
  &#125;,
  "sort": [
    &#123;
      "price": &#123;
        "order": "desc"
      &#125;
    &#125;
  ]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="返回指定字段-source"><a href="#返回指定字段-source" class="headerlink" title="返回指定字段[_source]"></a>返回指定字段[_source]</h4><blockquote>
<p><strong>_source 关键字</strong>: 是一个数组,在数组中用来指定展示那些字段</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /products/_search
&#123;
  "query": &#123;
    "match_all": &#123;&#125;
  &#125;,
  "_source": ["title","description"]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="索引原理"><a href="#索引原理" class="headerlink" title="索引原理"></a>索引原理</h2><h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><p><code>倒排索引（Inverted Index）</code>也叫反向索引，有反向索引必有正向索引。通俗地来讲，<code>正向索引是通过key找value，反向索引则是通过value找key。ES底层在检索时底层使用的就是倒排索引。</code></p>
<h3 id="索引模型"><a href="#索引模型" class="headerlink" title="索引模型"></a>索引模型</h3><p>现有索引和映射如下:</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"products"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"mappings"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"description"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"price"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"float"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>先录入如下数据，有三个字段title、price、description等</p>
<table>
<thead>
<tr>
<th>_id</th>
<th>title</th>
<th>price</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>蓝月亮洗衣液</td>
<td><code>19.9</code></td>
<td>蓝月亮洗衣液<code>很</code>高效</td>
</tr>
<tr>
<td>2</td>
<td>iphone13</td>
<td><code>19.9</code></td>
<td><code>很</code>不错的手机</td>
</tr>
<tr>
<td>3</td>
<td>小浣熊干脆面</td>
<td>1.5</td>
<td>小浣熊<code>很</code>好吃</td>
</tr>
</tbody></table>
<p>在ES中除了text类型分词，其他类型不分词，因此根据不同字段创建索引如下：</p>
<ul>
<li><p><strong>title字段:</strong></p>
<table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody><tr>
<td>蓝月亮洗衣液</td>
<td>1</td>
</tr>
<tr>
<td>iphone13</td>
<td>2</td>
</tr>
<tr>
<td>小浣熊干脆面</td>
<td>3</td>
</tr>
</tbody></table>
</li>
<li><p><strong>price字段</strong></p>
<table>
<thead>
<tr>
<th>term</th>
<th>_id(文档id)</th>
</tr>
</thead>
<tbody><tr>
<td>19.9</td>
<td>[1,2]</td>
</tr>
<tr>
<td>1.5</td>
<td>3</td>
</tr>
</tbody></table>
</li>
<li><p><strong>description字段</strong></p>
<table>
<thead>
<tr>
<th>term</th>
<th>_id</th>
<th>term</th>
<th>_id</th>
<th>term</th>
<th>_id</th>
</tr>
</thead>
<tbody><tr>
<td>蓝</td>
<td>1</td>
<td>不</td>
<td>2</td>
<td>小</td>
<td>3</td>
</tr>
<tr>
<td>月</td>
<td>1</td>
<td>错</td>
<td>2</td>
<td>浣</td>
<td>3</td>
</tr>
<tr>
<td>亮</td>
<td>1</td>
<td>的</td>
<td>2</td>
<td>熊</td>
<td>3</td>
</tr>
<tr>
<td>洗</td>
<td>1</td>
<td>手</td>
<td>2</td>
<td>好</td>
<td>3</td>
</tr>
<tr>
<td>衣</td>
<td>1</td>
<td>机</td>
<td>2</td>
<td>吃</td>
<td>3</td>
</tr>
<tr>
<td>液</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>很</td>
<td>[1:1:9,2:1:6,3:1:6]   <strong>[稳定ID:出现的次数:出现的位置]</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>高</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>效</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong><code>注意: Elasticsearch分别为每个字段都建立了一个倒排索引。因此查询时查询字段的term,就能知道文档ID，就能快速找到文档。</code></strong></p>
<h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><h3 id="Analysis-和-Analyzer"><a href="#Analysis-和-Analyzer" class="headerlink" title="Analysis 和 Analyzer"></a>Analysis 和 Analyzer</h3><p><code>Analysis</code>： 文本分析是把全文本转换一系列单词(term/token)的过程，也叫分词(Analyzer)。<strong>Analysis是通过Analyzer来实现的</strong>。<code>分词就是将文档通过Analyzer分成一个一个的Term(关键词查询),每一个Term都指向包含这个Term的文档</code>。</p>
<h3 id="Analyzer-组成"><a href="#Analyzer-组成" class="headerlink" title="Analyzer 组成"></a>Analyzer 组成</h3><ul>
<li><p>​    注意: 在ES中默认使用标准分词器: StandardAnalyzer 特点: 中文单字分词  单词分词</p>
<p>我是中国人 this is good man—-&gt;  analyzer—-&gt; 我 ， 是，  中，  国  ，人   this  is  good man</p>
</li>
</ul>
<blockquote>
<p>分析器（analyzer）都由三种构件组成的：<code>character filters</code> ， <code>tokenizers</code> ， <code>token filters</code>。</p>
</blockquote>
<ul>
<li><p><code>character filter</code> 字符过滤器</p>
<ul>
<li>在一段文本进行分词之前，先进行预处理，比如说最常见的就是，过滤html标签（<span>hello<span> –&gt; hello），（&amp; –&gt; and）（I&amp;you –&gt; I and you）</li>
</ul>
</li>
<li><p><code>tokenizers</code> 分词器</p>
<ul>
<li>英文分词可以根据空格将单词分开,中文分词比较复杂,可以采用机器学习算法来分词。</li>
</ul>
</li>
<li><p><code>Token filters</code> Token过滤器</p>
<ul>
<li><strong>将切分的单词进行加工</strong>。大小写转换（例将“Quick”转为小写），去掉停用词（例如停用词像“a”、“and”、“the”等等，中文中的比如：”这“，”那“等 会直接去掉 ），加入同义词（例如同义词像“jump”和“leap”，比如中文中的比如：”想念“，会加入”思念“等同义词便于搜索）。</li>
</ul>
</li>
</ul>
<p><code>注意:</code></p>
<ul>
<li>三者顺序:    Character Filters—&gt;Tokenizer—&gt;Token Filter</li>
<li>三者个数：Character Filters（0个或多个） + Tokenizer + Token Filters(0个或多个)</li>
</ul>
<h3 id="内置分词器"><a href="#内置分词器" class="headerlink" title="内置分词器"></a>内置分词器</h3><ul>
<li>Standard Analyzer - 默认分词器，英文按单词词切分，并小写处理</li>
<li>Simple Analyzer - 按照单词切分(符号被过滤), 小写处理</li>
<li>Stop Analyzer - 小写处理，停用词过滤(the,a,is)</li>
<li>Whitespace Analyzer - 按照空格切分，不转小写</li>
<li>Keyword Analyzer - 不分词，直接将输入当作输出</li>
</ul>
<h3 id="内置分词器测试"><a href="#内置分词器测试" class="headerlink" title="内置分词器测试"></a>内置分词器测试</h3><ul>
<li>标准分词器<ul>
<li>特点: 按照单词分词 英文统一转为小写 过滤标点符号  中文单字分词</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /_analyze
&#123;
  "analyzer": "standard",
  "text": "this is a , good Man 中华人民共和国"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#123;
  &quot;tokens&quot; : [
    &#123;
      &quot;token&quot; : &quot;this&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 4,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 0
    &#125;,
    &#123;
      &quot;token&quot; : &quot;is&quot;,
      &quot;start_offset&quot; : 5,
      &quot;end_offset&quot; : 7,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 1
    &#125;,
    &#123;
      &quot;token&quot; : &quot;a&quot;,
      &quot;start_offset&quot; : 8,
      &quot;end_offset&quot; : 9,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 2
    &#125;,
    &#123;
      &quot;token&quot; : &quot;good&quot;,
      &quot;start_offset&quot; : 12,
      &quot;end_offset&quot; : 16,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 3
    &#125;,
    &#123;
      &quot;token&quot; : &quot;man&quot;,
      &quot;start_offset&quot; : 17,
      &quot;end_offset&quot; : 20,
      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,
      &quot;position&quot; : 4
    &#125;,
    &#123;
      &quot;token&quot; : &quot;中&quot;,
      &quot;start_offset&quot; : 21,
      &quot;end_offset&quot; : 22,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 5
    &#125;,
    &#123;
      &quot;token&quot; : &quot;华&quot;,
      &quot;start_offset&quot; : 22,
      &quot;end_offset&quot; : 23,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 6
    &#125;,
    &#123;
      &quot;token&quot; : &quot;人&quot;,
      &quot;start_offset&quot; : 23,
      &quot;end_offset&quot; : 24,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 7
    &#125;,
    &#123;
      &quot;token&quot; : &quot;民&quot;,
      &quot;start_offset&quot; : 24,
      &quot;end_offset&quot; : 25,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 8
    &#125;,
    &#123;
      &quot;token&quot; : &quot;共&quot;,
      &quot;start_offset&quot; : 25,
      &quot;end_offset&quot; : 26,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 9
    &#125;,
    &#123;
      &quot;token&quot; : &quot;和&quot;,
      &quot;start_offset&quot; : 26,
      &quot;end_offset&quot; : 27,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 10
    &#125;,
    &#123;
      &quot;token&quot; : &quot;国&quot;,
      &quot;start_offset&quot; : 27,
      &quot;end_offset&quot; : 28,
      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,
      &quot;position&quot; : 11
    &#125;
  ]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li>Simple 分词器<ul>
<li>特点: 英文按照单词分词 英文统一转为小写 去掉符号 中文按照空格进行分词</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /_analyze
&#123;
  "analyzer": "simple",
  "text": "this is a , good Man 中华人民共和国"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#123;
  &quot;tokens&quot; : [
    &#123;
      &quot;token&quot; : &quot;this&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 4,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 0
    &#125;,
    &#123;
      &quot;token&quot; : &quot;is&quot;,
      &quot;start_offset&quot; : 5,
      &quot;end_offset&quot; : 7,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 1
    &#125;,
    &#123;
      &quot;token&quot; : &quot;a&quot;,
      &quot;start_offset&quot; : 8,
      &quot;end_offset&quot; : 9,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 2
    &#125;,
    &#123;
      &quot;token&quot; : &quot;good&quot;,
      &quot;start_offset&quot; : 12,
      &quot;end_offset&quot; : 16,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 3
    &#125;,
    &#123;
      &quot;token&quot; : &quot;man&quot;,
      &quot;start_offset&quot; : 17,
      &quot;end_offset&quot; : 20,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 4
    &#125;,
    &#123;
      &quot;token&quot; : &quot;中华人民共和国&quot;,
      &quot;start_offset&quot; : 21,
      &quot;end_offset&quot; : 28,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 5
    &#125;
  ]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li>Whitespace 分词器<ul>
<li>特点:  中文 英文 按照空格分词 英文不会转为小写  不去掉标点符号</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /_analyze
&#123;
  "analyzer": "whitespace",
  "text": "this is a , good Man"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#! Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;reference&#x2F;7.14&#x2F;security-minimal-setup.html to enable security.
&#123;
  &quot;tokens&quot; : [
    &#123;
      &quot;token&quot; : &quot;this&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 4,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 0
    &#125;,
    &#123;
      &quot;token&quot; : &quot;is&quot;,
      &quot;start_offset&quot; : 5,
      &quot;end_offset&quot; : 7,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 1
    &#125;,
    &#123;
      &quot;token&quot; : &quot;a&quot;,
      &quot;start_offset&quot; : 8,
      &quot;end_offset&quot; : 9,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 2
    &#125;,
    &#123;
      &quot;token&quot; : &quot;,&quot;,
      &quot;start_offset&quot; : 10,
      &quot;end_offset&quot; : 11,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 3
    &#125;,
    &#123;
      &quot;token&quot; : &quot;good&quot;,
      &quot;start_offset&quot; : 12,
      &quot;end_offset&quot; : 16,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 4
    &#125;,
    &#123;
      &quot;token&quot; : &quot;Man&quot;,
      &quot;start_offset&quot; : 17,
      &quot;end_offset&quot; : 20,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 5
    &#125;
  ]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>keyword <ul>
<li>特点：整体分词</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">POST &#x2F;_analyze
&#123;
  &quot;analyzer&quot;: &quot;keyword&quot;,
  &quot;text&quot;: &quot;this is a , good Man 中华人民共和国&quot;
&#125;



&#123;
  &quot;tokens&quot; : [
    &#123;
      &quot;token&quot; : &quot;this is a , good Man 中华人民共和国&quot;,
      &quot;start_offset&quot; : 0,
      &quot;end_offset&quot; : 28,
      &quot;type&quot; : &quot;word&quot;,
      &quot;position&quot; : 0
    &#125;
  ]
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="创建索引设置分词"><a href="#创建索引设置分词" class="headerlink" title="创建索引设置分词"></a>创建索引设置分词</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json">PUT /索引名
<span class="token punctuation">&#123;</span>
  <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span> <span class="token comment">//显示指定分词器</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="中文分词器"><a href="#中文分词器" class="headerlink" title="中文分词器"></a>中文分词器</h3><p>在ES中支持中文分词器非常多 如 <strong>smartCN</strong>、<strong>IK</strong> 等，推荐的就是 <code>IK分词器</code>。</p>
<h4 id="安装IK"><a href="#安装IK" class="headerlink" title="安装IK"></a>安装IK</h4><p>开源分词器 Ik 的github:<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<ul>
<li><code>注意</code> IK分词器的版本要你安装ES的版本一致</li>
<li><code>注意</code> Docker 容器运行 ES 安装插件目录为 <strong>/usr/share/elasticsearch/plugins</strong></li>
</ul>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1. 下载对应版本</span>
<span class="token list punctuation">-</span> [es@linux ~]$ wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.14.0/elasticsearch-analysis-ik-7.14.0.zip

<span class="token title important"><span class="token punctuation">#</span> 2. 解压</span>
<span class="token list punctuation">-</span> [es@linux ~]$ unzip elasticsearch-analysis-ik-6.2.4.zip #先使用yum install -y unzip

<span class="token title important"><span class="token punctuation">#</span> 3. 移动到es安装目录的plugins目录中</span>
<span class="token list punctuation">-</span> [es@linux <span class="token strike"><span class="token punctuation">~</span><span class="token content">]$ ls elasticsearch-6.2.4/plugins/
	[es@linux </span><span class="token punctuation">~</span></span>]$ mv elasticsearch elasticsearch-6.2.4/plugins/
	[es@linux <span class="token strike"><span class="token punctuation">~</span><span class="token content">]$ ls elasticsearch-6.2.4/plugins/
	 	elasticsearch
	[es@linux </span><span class="token punctuation">~</span></span>]$ ls elasticsearch-6.2.4/plugins/elasticsearch/
		commons-codec-1.9.jar    config                               httpclient-4.5.2.jar  		plugin-descriptor.properties
		commons-logging-1.2.jar  elasticsearch-analysis-ik-6.2.4.jar  httpcore-4.4.4.jar
		
<span class="token title important"><span class="token punctuation">#</span> 4. 重启es生效</span>

<span class="token title important"><span class="token punctuation">#</span> 5. 本地安装ik配置目录为  </span>
<span class="token list punctuation">-</span> es安装目录中/plugins/analysis-ik/config/IKAnalyzer.cfg.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="IK使用"><a href="#IK使用" class="headerlink" title="IK使用"></a>IK使用</h4><p>IK有两种颗粒度的拆分：</p>
<ul>
<li><p><code>ik_smart</code>: 会做最粗粒度的拆分</p>
</li>
<li><p><code>ik_max_word</code>: 会将文本做最细粒度的拆分</p>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /_analyze
&#123;
  "analyzer": "ik_smart",
  "text": "中华人民共和国国歌"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211024212944413-1761485322102.png" alt="image-20211024212944413" loading="lazy"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /_analyze
&#123;
  "analyzer": "ik_max_word",
  "text": "中华人民"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/img/image-20211024213133835-1761485322102.png" alt="image-20211024213133835" loading="lazy"></p>
<h4 id="扩展词、停用词配置"><a href="#扩展词、停用词配置" class="headerlink" title="扩展词、停用词配置"></a>扩展词、停用词配置</h4><p>IK支持自定义<code>扩展词典</code>和<code>停用词典</code></p>
<ul>
<li>**<code>扩展词典</code>**就是有些词并不是关键词,但是也希望被ES用来作为检索的关键词,可以将这些词加入扩展词典。</li>
<li>**<code>停用词典</code>**就是有些词是关键词,但是出于业务场景不想使用这些关键词被检索到，可以将这些词放入停用词典。</li>
</ul>
<p>定义扩展词典和停用词典可以修改IK分词器中<code>config</code>目录中<code>IKAnalyzer.cfg.xml</code>这个文件。</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 修改vim IKAnalyzer.cfg.xml

<span class="token code keyword">    &lt;?xml version="1.0" encoding="UTF-8"?>
    &lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
    &lt;properties>
        &lt;comment>IK Analyzer 扩展配置&lt;/comment>
        </span><span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --></span>
<span class="token code keyword">        &lt;entry key="ext_dict">ext_dict.dic&lt;/entry>
         </span><span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--></span>
<span class="token code keyword">        &lt;entry key="ext_stopwords">ext_stopword.dic&lt;/entry>
    &lt;/properties></span>

<span class="token list punctuation">2.</span> 在ik分词器目录下config目录中创建ext_dict.dic文件 注：文件一行只能放一个词  编码一定要为UTF-8才能生效
	vim ext_dict.dic 加入扩展词即可

<span class="token list punctuation">3.</span> 在ik分词器目录下config目录中创建ext_stopword.dic文件 
	vim ext_stopword.dic 加入停用词即可

4.重启es生效<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>注意:</code> <strong>词典的编码必须为UTF-8，否则无法生效!</strong></p>
</blockquote>
<p>一、核心结论</p>
<ul>
<li>✅ 扩展词是“增强识别能力”，不是“无条件追加”。</li>
<li>✅ 分词过程是基于<strong>文本内容匹配词典</strong>的结果，<strong>不会</strong>将扩展词典中所有词追加到每个文档的分词结果中。</li>
</ul>
<p>二、扩展词（Ext Dictionary）</p>
<p>🔹 作用</p>
<ul>
<li>向 IK 分词器的词典中添加新的词汇，使其能够识别默认词典未收录的专业术语、新词等（如：“大模型”、“AIGC”、“Transformer”）。</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">大模型
机器语言
深度学习
AIGC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>🔹 工作机制</p>
<ul>
<li>✅ <strong>匹配机制</strong>：只有当输入文本中出现该词时，才会被识别并输出。</li>
<li>❌ <strong>非追加机制</strong>：不会把扩展词典中的词全部加入到每个文档的分词结果中。</li>
</ul>
<p>示例：</p>
<ul>
<li><p>扩展词典包含：“机器学习”</p>
</li>
<li><p>文本：</p>
<pre class="line-numbers language-none"><code class="language-none">我正在学习机器学习<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>分词结果（可能）：<code>我</code>、<code>正在</code>、<code>学习</code>、<code>机器语言</code>  而不是 <code>我</code>、<code>正在</code>、<code>学习</code>、<code>机器</code>、<code>语言</code></li>
</ul>
</li>
<li><p>文本：</p>
<pre class="line-numbers language-none"><code class="language-none">我喜欢自然语言处理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>分词结果中<strong>不会出现</strong>“机器学习”</li>
</ul>
</li>
</ul>
<blockquote>
<p>✅ 结论：扩展词 = 提高识别能力，<strong>按需匹配</strong>。</p>
</blockquote>
<p>三、停用词（Stopwords Dictionary）</p>
<p>🔹 作用</p>
<ul>
<li>过滤掉不重要或干扰性的词汇（如：“的”、“了”、“而已”），减少噪音，提升检索效率。</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">的
了
而已
正在<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>🔹 工作机制</p>
<ul>
<li>匹配到停用词 → <strong>从分词结果中移除</strong></li>
</ul>
<p>示例：</p>
<ul>
<li>停用词：“正在”</li>
<li>文本：<code>我正在学习机器学习</code></li>
<li>分词结果（过滤后）：<code>我</code>、<code>学习</code>、<code>机器学习</code></li>
</ul>
<hr>
<h2 id="过滤查询-Filter-Query"><a href="#过滤查询-Filter-Query" class="headerlink" title="过滤查询 Filter Query"></a>过滤查询 Filter Query</h2><h3 id="过滤查询"><a href="#过滤查询" class="headerlink" title="过滤查询"></a>过滤查询</h3><p>过滤查询<filter query>，其实准确来说，ES中的查询操作分为2种: <code>查询(query)</code>和<code>过滤(filter)</code>。查询即是之前提到的<code>query查询</code>，它 (查询)默认会计算每个返回文档的得分，然后根据得分排序。而<code>过滤(filter)</code>只会筛选出符合的文档，并不计算 得分，而且它可以缓存文档 。所以，单从性能考虑，过滤比查询更快。 换句话说**<code>过滤适合在大范围筛选数据，而查询则适合精确匹配数据。一般应用时， 应先使用过滤操作过滤数据， 然后使用查询匹配数据。</code>** </p>
<p><img src="/img/image-20211101113527794-1761485322102.png" alt="image-20211101113527794" loading="lazy"></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /ems/emp/_search
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"match_all": &#123;&#125;&#125; //查询条件
      ],
      "filter": &#123;....&#125; //过滤条件
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>注意:</code><ul>
<li><strong>在执行 filter  和  query  时,先执行  filter  在执行 query</strong></li>
<li><strong>Elasticsearch会自动缓存经常使用的过滤器，以加快性能。</strong></li>
</ul>
</li>
</ul>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><blockquote>
<p>常见过滤类型有: term 、 terms 、ranage、exists、ids等filter。</p>
</blockquote>
<h4 id="term-、-terms-Filter"><a href="#term-、-terms-Filter" class="headerlink" title="term 、 terms Filter"></a>term 、 terms Filter</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /ems/emp/_search   # 使用term过滤
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"term": &#123;
          "name": &#123;
            "value": "小黑"
          &#125;
        &#125;&#125;
      ],
      "filter": &#123;
        "term": &#123;
          "content":"框架"
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
GET /dangdang/book/_search  #使用terms过滤
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"term": &#123;
          "name": &#123;
            "value": "中国"
          &#125;
        &#125;&#125;
      ],
      "filter": &#123;
        "terms": &#123;
          "content":[
              "科技",
              "声音"
            ]
        &#125;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ranage-filter"><a href="#ranage-filter" class="headerlink" title="ranage filter"></a>ranage filter</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /ems/emp/_search
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"term": &#123;
          "name": &#123;
            "value": "中国"
          &#125;
        &#125;&#125;
      ],
      "filter": &#123;
        "range": &#123;
          "age": &#123;
            "gte": 7,
            "lte": 20
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="exists-filter"><a href="#exists-filter" class="headerlink" title="exists filter"></a>exists filter</h4><blockquote>
<p><strong>过滤存在指定字段,获取字段不为空的索引记录使用</strong></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /ems/emp/_search
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"term": &#123;
          "name": &#123;
            "value": "中国"
          &#125;
        &#125;&#125;
      ],
      "filter": &#123;
        "exists": &#123;
          "field":"aaa"
        &#125;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ids-filter"><a href="#ids-filter" class="headerlink" title="ids filter"></a>ids filter</h4><blockquote>
<p><strong>过滤含有指定字段的索引记录</strong></p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /ems/emp/_search
&#123;
  "query": &#123;
    "bool": &#123;
      "must": [
        &#123;"term": &#123;
          "name": &#123;
            "value": "中国"
          &#125;
        &#125;&#125;
      ],
      "filter": &#123;
        "ids": &#123;
          "values": ["1","2","3"]
        &#125;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="整合应用"><a href="#整合应用" class="headerlink" title="整合应用"></a>整合应用</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestClientConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractElasticsearchConfiguration</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">elasticsearchClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ClientConfiguration</span> clientConfiguration <span class="token operator">=</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connectedTo</span><span class="token punctuation">(</span><span class="token string">"172.16.91.10:9200"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">RestClients</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>clientConfiguration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="客户端对象"><a href="#客户端对象" class="headerlink" title="客户端对象"></a>客户端对象</h3><ul>
<li>ElasticsearchOperations </li>
<li>RestHighLevelClient <strong>推荐</strong></li>
</ul>
<h4 id="ElasticsearchOperations"><a href="#ElasticsearchOperations" class="headerlink" title="ElasticsearchOperations"></a>ElasticsearchOperations</h4><ul>
<li>特点: 始终使用面向对象方式操作 ES<ul>
<li>索引: 用来存放相似文档集合</li>
<li>映射: 用来决定放入文档的每个字段以什么样方式录入到 ES 中 字段类型 分词器..</li>
<li>文档: 可以被索引最小单元  json 数据格式</li>
</ul>
</li>
</ul>
<h5 id="相关注解"><a href="#相关注解" class="headerlink" title="相关注解"></a>相关注解</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">"products"</span><span class="token punctuation">,</span> createIndex <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>
		<span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType</span><span class="token punctuation">.</span><span class="token class-name">Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType</span><span class="token punctuation">.</span><span class="token class-name">Float</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType</span><span class="token punctuation">.</span><span class="token class-name">Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
  	<span class="token comment">//get set ...</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//1. @Document(indexName = "products", createIndex = true) 用在类上 作用:代表一个对象为一个文档</span>
		<span class="token operator">--</span> indexName属性<span class="token operator">:</span> 创建索引的名称
    <span class="token operator">--</span> createIndex属性<span class="token operator">:</span> 是否创建索引
<span class="token comment">//2. @Id 用在属性上  作用:将对象id字段与ES中文档的_id对应</span>
<span class="token comment">//3. @Field(type = FieldType.Keyword) 用在属性上 作用:用来描述属性在ES中存储类型以及分词情况</span>
    <span class="token operator">--</span> type<span class="token operator">:</span> 用来指定字段类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="索引文档"><a href="#索引文档" class="headerlink" title="索引文档"></a>索引文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//存在id指定id  不存在id自动生成id</span>
  product<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"怡宝矿泉水"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">129.11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">"我们喜欢喝矿泉水...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elasticsearchOperations<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="删除文档-1"><a href="#删除文档-1" class="headerlink" title="删除文档"></a>删除文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> delete <span class="token operator">=</span> elasticsearchOperations<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="查询文档-1"><a href="#查询文档-1" class="headerlink" title="查询文档"></a>查询文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Product</span> product <span class="token operator">=</span> elasticsearchOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="更新文档-1"><a href="#更新文档-1" class="headerlink" title="更新文档"></a>更新文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"怡宝矿泉水"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">129.11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">"我们喜欢喝矿泉水,你们喜欢吗...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elasticsearchOperations<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不存在添加,存在更新</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="删除所有"><a href="#删除所有" class="headerlink" title="删除所有"></a>删除所有</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  elasticsearchOperations<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> productSearchHits <span class="token operator">=</span> elasticsearchOperations<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  productSearchHits<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>productSearchHit <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id: "</span> <span class="token operator">+</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"score: "</span> <span class="token operator">+</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Product</span> product <span class="token operator">=</span> productSearchHit<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"product: "</span> <span class="token operator">+</span> product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="RestHighLevelClient"><a href="#RestHighLevelClient" class="headerlink" title="RestHighLevelClient"></a>RestHighLevelClient</h3><p><code>RestHighLevelClient</code> 是 <strong>Elasticsearch Java High Level REST Client</strong>（高级REST客户端）中的一个核心类，用于在 Java 应用程序中与 Elasticsearch 集群进行交互。</p>
<blockquote>
<p>⚠️ <strong>重要提示</strong>：从 <strong>Elasticsearch 7.15.0 开始，<code>RestHighLevelClient</code> 已被弃用</strong>，并在 <strong>Elasticsearch 8.0+ 中被移除</strong>。官方推荐使用新的 <strong>Java API Client</strong>。</p>
</blockquote>
<p>但如果你仍在维护基于 7.x 版本的项目，理解 <code>RestHighLevelClient</code> 仍然非常必要。</p>
<p>📚 RestHighLevelClient 简介</p>
<ul>
<li><p><strong>作用</strong>：提供面向高层操作的 API，封装了底层 HTTP 请求，支持常见的 ES 操作（索引、搜索、更新、删除等）。</p>
</li>
<li><p><strong>依赖版本</strong>：适用于 Elasticsearch 6.0 到 7.17.x</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;
    &lt;version&gt;7.17.14&lt;&#x2F;version&gt; &lt;!-- 应与 ES 集群版本一致 --&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="创建索引映射"><a href="#创建索引映射" class="headerlink" title="创建索引映射"></a>创建索引映射</h5></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCreateIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
       <span class="token class-name">CreateIndexRequest</span> createIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       createIndexRequest<span class="token punctuation">.</span><span class="token function">mapping</span><span class="token punctuation">(</span><span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"    \"properties\": &#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"      \"title\":&#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"        \"type\": \"keyword\"\n"</span> <span class="token operator">+</span>
               <span class="token string">"      &#125;,\n"</span> <span class="token operator">+</span>
               <span class="token string">"      \"price\":&#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"        \"type\": \"double\"\n"</span> <span class="token operator">+</span>
               <span class="token string">"      &#125;,\n"</span> <span class="token operator">+</span>
               <span class="token string">"      \"created_at\":&#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"        \"type\": \"date\"\n"</span> <span class="token operator">+</span>
               <span class="token string">"      &#125;,\n"</span> <span class="token operator">+</span>
               <span class="token string">"      \"description\":&#123;\n"</span> <span class="token operator">+</span>
               <span class="token string">"        \"type\": \"text\"\n"</span> <span class="token operator">+</span>
               <span class="token string">"      &#125;\n"</span> <span class="token operator">+</span>
               <span class="token string">"    &#125;\n"</span> <span class="token operator">+</span>
               <span class="token string">"  &#125;\n"</span> <span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">CreateIndexResponse</span> createIndexResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIndexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>createIndexResponse<span class="token punctuation">.</span><span class="token function">isAcknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       restHighLevelClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="索引文档-1"><a href="#索引文档-1" class="headerlink" title="索引文档"></a>索引文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token string">"&#123;\n"</span> <span class="token operator">+</span>
                      <span class="token string">"          \"id\" : 1,\n"</span> <span class="token operator">+</span>
                      <span class="token string">"          \"title\" : \"蓝月亮\",\n"</span> <span class="token operator">+</span>
                      <span class="token string">"          \"price\" : 123.23,\n"</span> <span class="token operator">+</span>
                      <span class="token string">"          \"description\" : \"这个洗衣液非常不错哦！\"\n"</span> <span class="token operator">+</span>
                      <span class="token string">"        &#125;"</span><span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">IndexResponse</span> index <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="更新文档-2"><a href="#更新文档-2" class="headerlink" title="更新文档"></a>更新文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">UpdateRequest</span> updateRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">,</span><span class="token string">"qJ0R9XwBD3J1IW494-Om"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  updateRequest<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">"&#123;\"title\":\"好月亮\"&#125;"</span><span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">UpdateResponse</span> update <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>updateRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="删除文档-2"><a href="#删除文档-2" class="headerlink" title="删除文档"></a>删除文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">DeleteRequest</span> deleteRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">DeleteResponse</span> delete <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>delete<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="基于-id-查询文档"><a href="#基于-id-查询文档" class="headerlink" title="基于 id 查询文档"></a>基于 id 查询文档</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">GetRequest</span> getRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">GetResponse</span> getResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>getRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>getResponse<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="查询所有-1"><a href="#查询所有-1" class="headerlink" title="查询所有"></a>查询所有</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//System.out.println(searchResponse.getHits().getTotalHits().value);</span>
  <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="综合查询"><a href="#综合查询" class="headerlink" title="综合查询"></a>综合查询</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sourceBuilder
    <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">,</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>DESC<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"title"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requireFieldMatch</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">"&lt;span style='color:red;'>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">"&lt;/span>"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">,</span><span class="token string">"错"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总条数: "</span><span class="token operator">+</span>searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">HighlightField</span><span class="token punctuation">></span></span> highlightFields <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    highlightFields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"key: "</span><span class="token operator">+</span>k <span class="token operator">+</span> <span class="token string">" value: "</span><span class="token operator">+</span>v<span class="token punctuation">.</span><span class="token function">fragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><p>聚合：<strong>英文为Aggregation，是es除搜索功能外提供的针对es数据做统计分析的功能</strong>。聚合有助于根据搜索查询提供聚合数据。聚合查询是数据库中重要的功能特性，ES作为搜索引擎兼数据库，同样提供了强大的聚合分析能力。它基于查询条件来对数据进行分桶、计算的方法。有点类似于 SQL 中的 group by 再加一些函数方法的操作。</p>
<blockquote>
<p><code>注意事项：text类型是不支持聚合的。</code></p>
</blockquote>
<h3 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"># 创建索引 index 和映射 mapping
PUT /fruit
<span class="token punctuation">&#123;</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"double"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
# 放入测试数据
PUT /fruit/_bulk
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"面包"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">19.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"小面包非常好吃"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"旺仔牛奶"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">29.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"非常好喝"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"日本豆"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">19.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"日本豆非常好吃"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小馒头"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">19.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"小馒头非常好吃"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"大辣片"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">39.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"大辣片非常好吃"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"透心凉"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">9.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"透心凉非常好喝"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"小浣熊"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">19.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"童年的味道"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"海苔"</span><span class="token punctuation">,</span><span class="token property">"price"</span> <span class="token operator">:</span> <span class="token number">19.9</span><span class="token punctuation">,</span><span class="token property">"description"</span> <span class="token operator">:</span> <span class="token string">"海的味道"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><h4 id="根据某个字段分组"><a href="#根据某个字段分组" class="headerlink" title="根据某个字段分组"></a>根据某个字段分组</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"># 根据某个字段进行分组 统计数量
GET /fruit/_search
&#123;
  "query": &#123;
    "term": &#123;
      "description": &#123;
        "value": "好吃"
      &#125;
    &#125;
  &#125;, 
  "aggs": &#123;
    "price_group": &#123;
      "terms": &#123;
        "field": "price"
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="求最大值"><a href="#求最大值" class="headerlink" title="求最大值"></a>求最大值</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"># 求最大值 
GET /fruit/_search
&#123;
  "aggs": &#123;
    "price_max": &#123;
      "max": &#123;
        "field": "price"
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="求最小值"><a href="#求最小值" class="headerlink" title="求最小值"></a>求最小值</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"># 求最小值
GET /fruit/_search
&#123;
  "aggs": &#123;
    "price_min": &#123;
      "min": &#123;
        "field": "price"
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="求平均值"><a href="#求平均值" class="headerlink" title="求平均值"></a>求平均值</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"># 求平均值
GET /fruit/_search
&#123;
  "aggs": &#123;
    "price_agv": &#123;
      "avg": &#123;
        "field": "price"
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="求和"><a href="#求和" class="headerlink" title="求和"></a>求和</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"># 求和
GET /fruit/_search
&#123;
  "aggs": &#123;
    "price_sum": &#123;
      "sum": &#123;
        "field": "price"
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="整合应用-1"><a href="#整合应用-1" class="headerlink" title="整合应用"></a>整合应用</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 求不同价格的数量</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAggsPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">"group_price"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ParsedDoubleTerms</span> terms <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"group_price"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Terms</span><span class="token punctuation">.</span><span class="token class-name">Bucket</span><span class="token punctuation">></span></span> buckets <span class="token operator">=</span> terms<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">.</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> buckets<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bucket<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 求不同名称的数量</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAggsTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">"group_title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ParsedStringTerms</span> terms <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"group_title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Terms</span><span class="token punctuation">.</span><span class="token class-name">Bucket</span><span class="token punctuation">></span></span> buckets <span class="token operator">=</span> terms<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">.</span><span class="token class-name">Bucket</span> bucket <span class="token operator">:</span> buckets<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bucket<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token operator">+</span> bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 求和</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAggsSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"fruit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">"sum_price"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ParsedSum</span> parsedSum <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sum_price"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parsedSum<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="集群-Cluster"><a href="#集群-Cluster" class="headerlink" title="集群 Cluster"></a>集群 Cluster</h2><h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><h4 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群<cluster></h4><p>一个集群就是由一个或多个节点组织在一起，<code>它们共同持有你整个的数据，并一起提供索引和搜索功能</code>。一个集群由一个唯一的名字标识，这个名字默认就是<code>elasticsearch</code>。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群。</p>
<h4 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点<node></h4><p>一个节点是你集群中的一个服务器，作为集群的一部分，它存储你的数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。</p>
<h4 id="索引-2"><a href="#索引-2" class="headerlink" title="索引"></a>索引<Index></h4><p>一组相似文档的集合</p>
<h4 id="映射-2"><a href="#映射-2" class="headerlink" title="映射"></a>映射<Mapping></h4><p>用来定义索引存储文档的结构如：字段、类型等。</p>
<h4 id="文档-2"><a href="#文档-2" class="headerlink" title="文档"></a>文档<Document></h4><p>索引中一条记录,可以被索引的最小单元</p>
<h4 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片<shards></h4><p>Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置 到集群中的任何节点上。</p>
<h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制<replicas></h4><p>Index的分片中一份或多份副本。</p>
<h3 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h3><h4 id="集群规划"><a href="#集群规划" class="headerlink" title="集群规划"></a>集群规划</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.准备3个ES节点和一个kibana 节点  ES 9200 9300 </span>
<span class="token list punctuation">-</span> web: 9201 tcp:9301  node-1  elasticsearch.yml   
<span class="token list punctuation">-</span> web: 9202 tcp:9302  node-2  elasticsearch.yml
<span class="token list punctuation">-</span> web: 9203 tcp:9303  node-3  elasticsearch.yml
<span class="token list punctuation">-</span> kibana: 5602<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>注意<ul>
<li>所有节点集群名称必须一致     cluster.name</li>
<li>每个节点必须有一个唯一名字 node.name</li>
<li>开启每个节点远程连接  network.host: 0.0.0.0</li>
<li>指定使用 IP地址进行集群节点通信 network.publish_host:</li>
<li>修改 web 端口 tcp 端口 http.port:  transport.tcp.port</li>
<li>指定集群中所有节点通信列表 discovery.seed_hosts: node-1 node-2 node-3 相同</li>
<li>允许集群初始化 master 节点节点数: cluster.initial_master_nodes: [“node-1”, “node-2”,”node-3”]</li>
<li>集群最少几个节点可用 gateway.recover_after_nodes: 2</li>
<li>开启每个节点跨域访问http.cors.enabled: true http.cors.allow-origin: “*”</li>
</ul>
</li>
</ul>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> node-1 配置文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 指定集群名称 3个节点必须一致</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>cluster
<span class="token comment"># 指定节点名称 每个节点名字唯一</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token comment"># 开放远程链接</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token comment"># 指定使用发布地址进行集群间通信</span>
<span class="token key atrule">network.publish_host</span><span class="token punctuation">:</span> 192.168.124.3
<span class="token comment"># 指定 web 端口</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9201</span>
<span class="token comment"># 指定 tcp 端口</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9301</span>
<span class="token comment"># 指定所有节点的 tcp 通信</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"192.168.124.3:9301"</span><span class="token punctuation">,</span> <span class="token string">"192.168.124.3:9302"</span><span class="token punctuation">,</span><span class="token string">"192.168.124.3:9303"</span><span class="token punctuation">]</span>
<span class="token comment"># 指定可以初始化集群的节点名称</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"node-1"</span><span class="token punctuation">,</span> <span class="token string">"node-2"</span><span class="token punctuation">,</span><span class="token string">"node-3"</span><span class="token punctuation">]</span>
<span class="token comment"># 集群最少几个几点可用</span>
<span class="token key atrule">gateway.recover_after_nodes</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token comment"># 解决跨域问题</span>
<span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> node-2 配置文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 指定集群名称 3个节点必须一致</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>cluster
<span class="token comment"># 指定节点名称 每个节点名字唯一</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">2</span>
<span class="token comment"># 开放远程链接</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token comment"># 指定使用发布地址进行集群间通信</span>
<span class="token key atrule">network.publish_host</span><span class="token punctuation">:</span> 192.168.124.3
<span class="token comment"># 指定 web 端口</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9202</span>
<span class="token comment"># 指定 tcp 端口</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9302</span>
<span class="token comment"># 指定所有节点的 tcp 通信</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"192.168.124.3:9301"</span><span class="token punctuation">,</span> <span class="token string">"192.168.124.3:9302"</span><span class="token punctuation">,</span><span class="token string">"192.168.124.3:9303"</span><span class="token punctuation">]</span>
<span class="token comment"># 指定可以初始化集群的节点名称</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"node-1"</span><span class="token punctuation">,</span> <span class="token string">"node-2"</span><span class="token punctuation">,</span><span class="token string">"node-3"</span><span class="token punctuation">]</span>
<span class="token comment"># 集群最少几个几点可用</span>
<span class="token key atrule">gateway.recover_after_nodes</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token comment"># 解决跨域问题</span>
<span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> node-3 配置文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 指定集群名称 3个节点必须一致</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>cluster
<span class="token comment"># 指定节点名称 每个节点名字唯一</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">2</span>
<span class="token comment"># 开放远程链接</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token comment"># 指定使用发布地址进行集群间通信</span>
<span class="token key atrule">network.publish_host</span><span class="token punctuation">:</span> 192.168.124.3
<span class="token comment"># 指定 web 端口</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9202</span>
<span class="token comment"># 指定 tcp 端口</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9302</span>
<span class="token comment"># 指定所有节点的 tcp 通信</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"192.168.124.3:9301"</span><span class="token punctuation">,</span> <span class="token string">"192.168.124.3:9302"</span><span class="token punctuation">,</span><span class="token string">"192.168.124.3:9303"</span><span class="token punctuation">]</span>
<span class="token comment"># 指定可以初始化集群的节点名称</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"node-1"</span><span class="token punctuation">,</span> <span class="token string">"node-2"</span><span class="token punctuation">,</span><span class="token string">"node-3"</span><span class="token punctuation">]</span>
<span class="token comment"># 集群最少几个几点可用</span>
<span class="token key atrule">gateway.recover_after_nodes</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token comment"># 解决跨域问题</span>
<span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编写-compose-文件"><a href="#编写-compose-文件" class="headerlink" title="编写 compose 文件"></a>编写 compose 文件</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">escluster</span><span class="token punctuation">:</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">es01</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9201:9201"</span>
      <span class="token punctuation">-</span> <span class="token string">"9301:9301"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"escluster"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>1/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>1/config/elasticsearch.yml<span class="token punctuation">:</span>/usr/share/elasticsearch/config/elasticsearch.yml
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>1/plugins/ik<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins/ik
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>

  <span class="token key atrule">es02</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9202:9202"</span>
      <span class="token punctuation">-</span> <span class="token string">"9302:9302"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"escluster"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>2/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>2/config/elasticsearch.yml<span class="token punctuation">:</span>/usr/share/elasticsearch/config/elasticsearch.yml
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>2/plugins/ik<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins/ik
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>

  <span class="token key atrule">es03</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9203:9203"</span>
      <span class="token punctuation">-</span> <span class="token string">"9303:9303"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"escluster"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>3/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>3/config/elasticsearch.yml<span class="token punctuation">:</span>/usr/share/elasticsearch/config/elasticsearch.yml
      <span class="token punctuation">-</span> ./node<span class="token punctuation">-</span>3/plugins/ik<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins/ik
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>

  <span class="token key atrule">kibana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.14.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5602:5601"</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"escluster"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./kibana.yml<span class="token punctuation">:</span>/usr/share/kibana/config/kibana.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="kibana-配置文件"><a href="#kibana-配置文件" class="headerlink" title="kibana 配置文件"></a>kibana 配置文件</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># kibana配置文件 连接到ES</span>
<span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">"0"</span>
<span class="token key atrule">server.shutdownTimeout</span><span class="token punctuation">:</span> <span class="token string">"5s"</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"http://192.168.124.3:9201"</span> <span class="token punctuation">]</span> <span class="token comment">#链接任意节点即可</span>
<span class="token key atrule">monitoring.ui.container.elasticsearch.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="查看集群状态"></a>查看集群状态</h4><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//10.102.115.3:9200/_cat/health?v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<hr>
<h3 id="安装head插件"><a href="#安装head插件" class="headerlink" title="安装head插件"></a>安装head插件</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 访问github网站
	搜索: elasticsearch-head 插件
	
<span class="token list punctuation">2.</span> 安装git
	yum install git
	
<span class="token list punctuation">3.</span> 将elasticsearch-head下载到本地
	git clone git://github.com/mobz/elasticsearch-head.git

<span class="token list punctuation">4.</span> 安装nodejs
	<span class="token title important"><span class="token punctuation">#</span>注意: 没有wget的请先安装yum install -y wget</span>
	wget http://cdn.npm.taobao.org/dist/node/latest-v8.x/node-v8.1.2-linux-x64.tar.xz

<span class="token list punctuation">5.</span> 解压缩nodejs
	xz -d node-v10.15.3-linux-arm64.tar.xz
	tar -xvf node-v10.15.3-linux-arm64.tar

<span class="token list punctuation">6.</span> 配置环境变量
	mv node-v10.15.3-linux-arm64 nodejs
	mv nodejs /usr/nodejs
	vim /etc/profile
		export NODE_HOME=/usr/nodejs
		export PATH=$PATH:$JAVA_HOME/bin:$NODE_HOME/bin

<span class="token list punctuation">7.</span>	进入elasticsearch-head的目录
	npm config set registry https://registry.npm.taobao.org
	npm install
	npm run start


<span class="token list punctuation">8.</span>  启动访问head插件 默认端口9100
	http://ip:9100  查看集群状态<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">给个饭钱？</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/J2Sv6rVeLtAPiHx.jpg"><img loading="lazy" src="https://i.loli.net/2020/12/23/J2Sv6rVeLtAPiHx.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/4rBXF1deMD6KyN8.png"><img loading="lazy" src="https://i.loli.net/2020/12/23/4rBXF1deMD6KyN8.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/XvirFV3o6GyRMZU.png"><img loading="lazy" src="https://i.loli.net/2020/12/23/XvirFV3o6GyRMZU.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Sovzn</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://sovzn.github.io/2025/10/26/ElasticSearch-7-14/" title="ElasticSearch-7.14">http://sovzn.github.io/2025/10/26/ElasticSearch-7-14/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2025/11/16/Nginx/" rel="prev" title="Nginx"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Nginx</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2025/02/27/MongoDB/" rel="next" title="MongoDB"><span class="post-nav-text">MongoDB</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+ElasticSearch-7.14">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2026 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Sovzn</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-04-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>