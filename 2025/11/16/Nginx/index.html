<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="Sovzn"><meta name="copyright" content="Sovzn"><meta name="generator" content="Hexo 5.3.0"><meta name="theme" content="hexo-theme-yun"><title>Nginx | å¤§å¸ˆå…„</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#6200ee"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"sovzn.github.io","root":"/","title":"å¤§å¸ˆå…„çš„å°ç ´ç«™","version":"1.3.0","mode":"auto","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="æ³¨æ„ï¼š æ­¤æ–‡æ¡£å¯¹åº”çš„ Nginx ç‰ˆæœ¬ä¸º 1.24.0ã€‚  æ¦‚è¿°Nginxopen in new window æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ã€‚ ç»å¸¸ç”¨äºï¼š  åå‘ä»£ç†ï¼Œå°†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œå¤„ç†(åå‘ä»£ç†ï¼šæœåŠ¡ç«¯ï¼Œæ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯) è´Ÿè½½å‡è¡¡ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†é…åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤„ç† Web æœåŠ¡å™¨ï¼Œå¤„ç†é™æ€æ–‡ä»¶  éƒ¨ç½²éƒ¨ç½² Nginx æœ‰ä»¥ä¸‹">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx">
<meta property="og:url" content="http://sovzn.github.io/2025/11/16/Nginx/index.html">
<meta property="og:site_name" content="å¤§å¸ˆå…„">
<meta property="og:description" content="æ³¨æ„ï¼š æ­¤æ–‡æ¡£å¯¹åº”çš„ Nginx ç‰ˆæœ¬ä¸º 1.24.0ã€‚  æ¦‚è¿°Nginxopen in new window æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ã€‚ ç»å¸¸ç”¨äºï¼š  åå‘ä»£ç†ï¼Œå°†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œå¤„ç†(åå‘ä»£ç†ï¼šæœåŠ¡ç«¯ï¼Œæ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯) è´Ÿè½½å‡è¡¡ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†é…åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤„ç† Web æœåŠ¡å™¨ï¼Œå¤„ç†é™æ€æ–‡ä»¶  éƒ¨ç½²éƒ¨ç½² Nginx æœ‰ä»¥ä¸‹">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://minio.stonecoding.net/picgo/202309181015821.png">
<meta property="og:image" content="https://minio.stonecoding.net/picgo/202309181709255.png">
<meta property="og:image" content="http://sovzn.github.io/img/202309191313689.png">
<meta property="article:published_time" content="2025-11-16T08:45:59.000Z">
<meta property="article:modified_time" content="2025-11-16T09:58:55.730Z">
<meta property="article:author" content="Sovzn">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://minio.stonecoding.net/picgo/202309181015821.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Sovzn"><img width="96" loading="lazy" src="/Yun.png" alt="Sovzn"><span class="site-author-status" title="æ°¸è¿œç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å³å°†å‘ç”Ÿ">ğŸ˜Š</span></a><div class="site-author-name"><a href="/about/">Sovzn</a></div><a class="site-name" href="/about/site.html">å¤§å¸ˆå…„</a><sub class="site-subtitle"></sub><div class="site-desciption">æˆ‘åªæ‹¥æœ‰ä½ çš„æœˆå…‰,æˆ‘è¦æŠŠå®ƒå½“ä½œéª„é˜³ã€‚</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">90</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">30</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">20</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="å¾®åš" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="è±†ç“£" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="çŸ¥ä¹" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="å“”å“©å“”å“©" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/null" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#YUM-%E9%83%A8%E7%BD%B2"><span class="toc-number">2.1.</span> <span class="toc-text">YUM éƒ¨ç½²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2"><span class="toc-number">2.2.</span> <span class="toc-text">æœ¬åœ°éƒ¨ç½²</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#systemctl"><span class="toc-number">3.1.</span> <span class="toc-text">systemctl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx"><span class="toc-number">3.2.</span> <span class="toc-text">nginx</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">è¿›ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">5.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">7.1.</span> <span class="toc-text">ç½‘ç»œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp-nodelay"><span class="toc-number">7.1.1.</span> <span class="toc-text">tcp_nodelay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp-nopush"><span class="toc-number">7.1.2.</span> <span class="toc-text">tcp_nopush</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#client-max-body-size"><span class="toc-number">7.1.3.</span> <span class="toc-text">client_max_body_size</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.2.</span> <span class="toc-text">å‹ç¼©</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip"><span class="toc-number">7.2.1.</span> <span class="toc-text">gzip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-buffers"><span class="toc-number">7.2.2.</span> <span class="toc-text">gzip_buffers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-comp-level"><span class="toc-number">7.2.3.</span> <span class="toc-text">gzip_comp_level</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-disable"><span class="toc-number">7.2.4.</span> <span class="toc-text">gzip_disable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-http-version"><span class="toc-number">7.2.5.</span> <span class="toc-text">gzip_http_version</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-min-length"><span class="toc-number">7.2.6.</span> <span class="toc-text">gzip_min_length</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-proxied"><span class="toc-number">7.2.7.</span> <span class="toc-text">gzip_proxied</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-types"><span class="toc-number">7.2.8.</span> <span class="toc-text">gzip_types</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip-vary"><span class="toc-number">7.2.9.</span> <span class="toc-text">gzip_vary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98"><span class="toc-number">7.3.</span> <span class="toc-text">å®¢æˆ·ç«¯ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#expires"><span class="toc-number">7.3.1.</span> <span class="toc-text">expires</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#add-header"><span class="toc-number">7.3.2.</span> <span class="toc-text">add_header</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F"><span class="toc-number">7.4.</span> <span class="toc-text">è·¨åŸŸ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%9B%97%E9%93%BE"><span class="toc-number">7.5.</span> <span class="toc-text">é˜²ç›—é“¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#valid-referers"><span class="toc-number">7.5.1.</span> <span class="toc-text">[valid_referers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%86%99"><span class="toc-number">7.6.</span> <span class="toc-text">é‡å†™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#set"><span class="toc-number">7.6.1.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#if"><span class="toc-number">7.6.2.</span> <span class="toc-text">if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#break"><span class="toc-number">7.6.3.</span> <span class="toc-text">break</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#return"><span class="toc-number">7.6.4.</span> <span class="toc-text">return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rewrite"><span class="toc-number">7.6.5.</span> <span class="toc-text">rewrite</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC"><span class="toc-number">7.6.5.1.</span> <span class="toc-text">åŸŸåè·³è½¬</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E9%95%9C%E5%83%8F"><span class="toc-number">7.6.5.2.</span> <span class="toc-text">åŸŸåé•œåƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E5%9F%9F%E5%90%8D"><span class="toc-number">7.6.5.3.</span> <span class="toc-text">ç‹¬ç«‹åŸŸå</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E7%9B%AE%E5%BD%95"><span class="toc-number">7.6.5.4.</span> <span class="toc-text">åˆå¹¶ç›®å½•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B2%E7%9B%97%E9%93%BE-1"><span class="toc-number">7.6.5.5.</span> <span class="toc-text">é˜²ç›—é“¾</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E9%A6%96%E9%A1%B5"><span class="toc-number">7.6.5.6.</span> <span class="toc-text">è·³è½¬é¦–é¡µ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rewrite-log"><span class="toc-number">7.6.6.</span> <span class="toc-text">rewrite_log</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">7.7.</span> <span class="toc-text">åå‘ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-pass"><span class="toc-number">7.7.1.</span> <span class="toc-text">proxy_pass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-set-header"><span class="toc-number">7.7.2.</span> <span class="toc-text">proxy_set_header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-redirect"><span class="toc-number">7.7.3.</span> <span class="toc-text">proxy_redirect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-buffering"><span class="toc-number">7.7.4.</span> <span class="toc-text">proxy_buffering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-buffer-size"><span class="toc-number">7.7.5.</span> <span class="toc-text">proxy_buffer_size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-buffers"><span class="toc-number">7.7.6.</span> <span class="toc-text">proxy_buffers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-busy-buffers-size"><span class="toc-number">7.7.7.</span> <span class="toc-text">proxy_busy_buffers_size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-temp-path"><span class="toc-number">7.7.8.</span> <span class="toc-text">proxy_temp_path</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-temp-file-write-size"><span class="toc-number">7.7.9.</span> <span class="toc-text">proxy_temp_file_write_size</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">7.8.</span> <span class="toc-text">å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl"><span class="toc-number">7.8.1.</span> <span class="toc-text">ssl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-certificate"><span class="toc-number">7.8.2.</span> <span class="toc-text">ssl_certificate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-certificate-key"><span class="toc-number">7.8.3.</span> <span class="toc-text">ssl_certificate_key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-session-cache"><span class="toc-number">7.8.4.</span> <span class="toc-text">ssl_session_cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-session-timeout"><span class="toc-number">7.8.5.</span> <span class="toc-text">ssl_session_timeout</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-ciphers"><span class="toc-number">7.8.6.</span> <span class="toc-text">ssl_ciphers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ssl-prefer-server-ciphers"><span class="toc-number">7.8.7.</span> <span class="toc-text">ssl_prefer_server_ciphers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenSSL"><span class="toc-number">7.8.8.</span> <span class="toc-text">OpenSSL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number">7.9.</span> <span class="toc-text">ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-path"><span class="toc-number">7.9.1.</span> <span class="toc-text">proxy_cache_path</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache"><span class="toc-number">7.9.2.</span> <span class="toc-text">proxy_cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-key"><span class="toc-number">7.9.3.</span> <span class="toc-text">proxy_cache_key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-valid"><span class="toc-number">7.9.4.</span> <span class="toc-text">proxy_cache_valid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-min-uses"><span class="toc-number">7.9.5.</span> <span class="toc-text">proxy_cache_min_uses</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-methods"><span class="toc-number">7.9.6.</span> <span class="toc-text">proxy_cache_methods</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-no-cache"><span class="toc-number">7.9.7.</span> <span class="toc-text">proxy_no_cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-cache-bypass"><span class="toc-number">7.9.8.</span> <span class="toc-text">proxy_cache_bypass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.9.9.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E7%AB%99%E7%82%B9"><span class="toc-number">7.10.</span> <span class="toc-text">ä¸‹è½½ç«™ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#autoindex"><span class="toc-number">7.10.1.</span> <span class="toc-text">autoindex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#autoindex-format"><span class="toc-number">7.10.2.</span> <span class="toc-text">autoindex_format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#autoindex-exact-size"><span class="toc-number">7.10.3.</span> <span class="toc-text">autoindex_exact_size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#autoindex-localtime"><span class="toc-number">7.10.4.</span> <span class="toc-text">autoindex_localtime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">7.10.5.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81"><span class="toc-number">7.11.</span> <span class="toc-text">è®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#auth-basic"><span class="toc-number">7.11.1.</span> <span class="toc-text">auth_basic</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#auth-basic-user-file"><span class="toc-number">7.11.2.</span> <span class="toc-text">auth_basic_user_file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">7.11.3.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">8.</span> <span class="toc-text">è´Ÿè½½å‡è¡¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E5%B1%82"><span class="toc-number">8.1.</span> <span class="toc-text">ä¸ƒå±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#upstream"><span class="toc-number">8.1.1.</span> <span class="toc-text">upstream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server"><span class="toc-number">8.1.2.</span> <span class="toc-text">server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#random"><span class="toc-number">8.1.3.</span> <span class="toc-text">random</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#least-conn"><span class="toc-number">8.1.4.</span> <span class="toc-text">least_conn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ip-hash"><span class="toc-number">8.1.5.</span> <span class="toc-text">ip_hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hash"><span class="toc-number">8.1.6.</span> <span class="toc-text">hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">8.1.7.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%B1%82"><span class="toc-number">8.2.</span> <span class="toc-text">å››å±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#stream"><span class="toc-number">8.2.1.</span> <span class="toc-text">stream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-1"><span class="toc-number">8.2.2.</span> <span class="toc-text">server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listen"><span class="toc-number">8.2.3.</span> <span class="toc-text">listen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-pass-1"><span class="toc-number">8.2.4.</span> <span class="toc-text">proxy_pass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upstream-1"><span class="toc-number">8.2.5.</span> <span class="toc-text">upstream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-2"><span class="toc-number">8.2.6.</span> <span class="toc-text">server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="toc-number">8.2.7.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://Sovzn.github.io/2025/11/16/Nginx/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Sovzn"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="å¤§å¸ˆå…„"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Nginx</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2025-11-16 16:45:59" itemprop="dateCreated datePublished" datetime="2025-11-16T16:45:59+08:00">2025-11-16</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/Web/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Web</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/Web/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Web</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><blockquote>
<p>æ³¨æ„ï¼š</p>
<p>æ­¤æ–‡æ¡£å¯¹åº”çš„ Nginx ç‰ˆæœ¬ä¸º 1.24.0ã€‚</p>
</blockquote>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><a target="_blank" rel="noopener" href="https://nginx.org/">Nginxopen in new window</a> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ã€‚</p>
<p>ç»å¸¸ç”¨äºï¼š</p>
<ul>
<li>åå‘ä»£ç†ï¼Œå°†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œå¤„ç†(åå‘ä»£ç†ï¼šæœåŠ¡ç«¯ï¼Œæ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯)</li>
<li>è´Ÿè½½å‡è¡¡ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†é…åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤„ç†</li>
<li>Web æœåŠ¡å™¨ï¼Œå¤„ç†é™æ€æ–‡ä»¶</li>
</ul>
<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>éƒ¨ç½² Nginx æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>YUM éƒ¨ç½²ï¼šä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘</li>
<li>æœ¬åœ°éƒ¨ç½²ï¼šä¸»æœºä¸èƒ½è®¿é—®å¤–ç½‘</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>æ“ä½œç³»ç»Ÿå»ºè®®å…ˆå…³é—­é˜²ç«å¢™å’Œ SELinuxã€‚</p>
</blockquote>
<h3 id="YUM-éƒ¨ç½²"><a href="#YUM-éƒ¨ç½²" class="headerlink" title="YUM éƒ¨ç½²"></a>YUM éƒ¨ç½²</h3><p>å¦‚æœä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘ï¼Œç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Nginxï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span>
Retrieving http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
warning: /var/tmp/rpm-tmp.yfH9Ko: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY
Preparing<span class="token punctuation">..</span>.                          <span class="token comment">################################# [100%]</span>
Updating / installing<span class="token punctuation">..</span>.
   <span class="token number">1</span>:nginx-release-centos-7-0.el7.ngx <span class="token comment">################################# [100%]</span>

<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># yum -y install nginx</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: ftp.sjtu.edu.cn
 * updates: ftp.sjtu.edu.cn
base                                                                                                       <span class="token operator">|</span> <span class="token number">3.6</span> kB  00:00:00     
extras                                                                                                     <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00     
nginx                                                                                                      <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00     
updates                                                                                                    <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00     
nginx/x86_64/primary_db                                                                                    <span class="token operator">|</span>  <span class="token number">85</span> kB  00:00:04     
Resolving Dependencies
--<span class="token operator">></span> Running transaction check
---<span class="token operator">></span> Package nginx.x86_64 <span class="token number">1</span>:1.24.0-1.el7.ngx will be installed
--<span class="token operator">></span> Processing Dependency: libpcre2-8.so.0<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>64bit<span class="token punctuation">)</span> <span class="token keyword">for</span> package: <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64
--<span class="token operator">></span> Running transaction check
---<span class="token operator">></span> Package pcre2.x86_64 <span class="token number">0</span>:10.23-2.el7 will be installed
--<span class="token operator">></span> Finished Dependency Resolution

Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package                    Arch                        Version                                  Repository                  Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 nginx                      x86_64                      <span class="token number">1</span>:1.24.0-1.el7.ngx                       nginx                      <span class="token number">804</span> k
Installing <span class="token keyword">for</span> dependencies:
 pcre2                      x86_64                      <span class="token number">10.23</span>-2.el7                              base                       <span class="token number">201</span> k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">1</span> Package <span class="token punctuation">(</span>+1 Dependent package<span class="token punctuation">)</span>

Total download size: <span class="token number">1.0</span> M
Installed size: <span class="token number">3.3</span> M
Downloading packages:
<span class="token punctuation">(</span><span class="token number">1</span>/2<span class="token punctuation">)</span>: pcre2-10.23-2.el7.x86_64.rpm                                                                        <span class="token operator">|</span> <span class="token number">201</span> kB  00:00:01     
<span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>: nginx-1.24.0-1.el7.ngx.x86_64.rpm                                                                   <span class="token operator">|</span> <span class="token number">804</span> kB  00:00:09     
----------------------------------------------------------------------------------------------------------------------------------
Total                                                                                             <span class="token number">104</span> kB/s <span class="token operator">|</span> <span class="token number">1.0</span> MB  00:00:09     
Running transaction check
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded
Running transaction
Warning: RPMDB altered outside of yum.
  Installing <span class="token builtin class-name">:</span> pcre2-10.23-2.el7.x86_64                                                                                       <span class="token number">1</span>/2 
  Installing <span class="token builtin class-name">:</span> <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64                                                                                <span class="token number">2</span>/2 
----------------------------------------------------------------------

Thanks <span class="token keyword">for</span> using nginx<span class="token operator">!</span>

Please <span class="token function">find</span> the official documentation <span class="token keyword">for</span> nginx here:
* https://nginx.org/en/docs/

Please subscribe to nginx-announce mailing list to get
the <span class="token function">most</span> important news about nginx:
* https://nginx.org/en/support.html

Commercial subscriptions <span class="token keyword">for</span> nginx are available on:
* https://nginx.com/products/

----------------------------------------------------------------------
  Verifying  <span class="token builtin class-name">:</span> pcre2-10.23-2.el7.x86_64                                                                                       <span class="token number">1</span>/2 
  Verifying  <span class="token builtin class-name">:</span> <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64                                                                                <span class="token number">2</span>/2 

Installed:
  nginx.x86_64 <span class="token number">1</span>:1.24.0-1.el7.ngx                                                                                                 

Dependency Installed:
  pcre2.x86_64 <span class="token number">0</span>:10.23-2.el7                                                                                                      

Complete<span class="token operator">!</span>

<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.24.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æœ¬åœ°éƒ¨ç½²"><a href="#æœ¬åœ°éƒ¨ç½²" class="headerlink" title="æœ¬åœ°éƒ¨ç½²"></a>æœ¬åœ°éƒ¨ç½²</h3><p>å¦‚æœä¸»æœºä¸èƒ½è®¿é—®å¤–ç½‘ï¼Œéœ€è¦å…ˆåœ¨<a target="_blank" rel="noopener" href="http://nginx.org/packages/centos/7/x86_64/RPMS/">å®˜ç½‘open in new window</a>ä¸‹è½½ Nginx å®‰è£…åŒ…ï¼Œä¸Šä¼ åˆ°ä¸»æœºåå†å®‰è£…ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># ll nginx-1.24.0-1.el7.ngx.x86_64.rpm </span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">823020</span> Sep <span class="token number">11</span> <span class="token number">10</span>:48 nginx-1.24.0-1.el7.ngx.x86_64.rpm

<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># yum -y localinstall nginx-1.24.0-1.el7.ngx.x86_64.rpm</span>
Loaded plugins: fastestmirror
Examining nginx-1.24.0-1.el7.ngx.x86_64.rpm: <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64
Marking nginx-1.24.0-1.el7.ngx.x86_64.rpm to be installed
Resolving Dependencies
--<span class="token operator">></span> Running transaction check
---<span class="token operator">></span> Package nginx.x86_64 <span class="token number">1</span>:1.24.0-1.el7.ngx will be installed
--<span class="token operator">></span> Processing Dependency: libpcre2-8.so.0<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>64bit<span class="token punctuation">)</span> <span class="token keyword">for</span> package: <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: ftp.sjtu.edu.cn
 * updates: ftp.sjtu.edu.cn
--<span class="token operator">></span> Running transaction check
---<span class="token operator">></span> Package pcre2.x86_64 <span class="token number">0</span>:10.23-2.el7 will be installed
--<span class="token operator">></span> Finished Dependency Resolution

Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package              Arch                  Version                           Repository                                     Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 nginx                x86_64                <span class="token number">1</span>:1.24.0-1.el7.ngx                /nginx-1.24.0-1.el7.ngx.x86_64                <span class="token number">2.8</span> M
Installing <span class="token keyword">for</span> dependencies:
 pcre2                x86_64                <span class="token number">10.23</span>-2.el7                       base                                          <span class="token number">201</span> k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">1</span> Package <span class="token punctuation">(</span>+1 Dependent package<span class="token punctuation">)</span>

Total size: <span class="token number">3.0</span> M
Total download size: <span class="token number">201</span> k
Installed size: <span class="token number">3.3</span> M
Downloading packages:
pcre2-10.23-2.el7.x86_64.rpm                                                                               <span class="token operator">|</span> <span class="token number">201</span> kB  00:00:00     
Running transaction check
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded
Running transaction
  Installing <span class="token builtin class-name">:</span> pcre2-10.23-2.el7.x86_64                                                                                       <span class="token number">1</span>/2 
  Installing <span class="token builtin class-name">:</span> <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64                                                                                <span class="token number">2</span>/2 
----------------------------------------------------------------------

Thanks <span class="token keyword">for</span> using nginx<span class="token operator">!</span>

Please <span class="token function">find</span> the official documentation <span class="token keyword">for</span> nginx here:
* https://nginx.org/en/docs/

Please subscribe to nginx-announce mailing list to get
the <span class="token function">most</span> important news about nginx:
* https://nginx.org/en/support.html

Commercial subscriptions <span class="token keyword">for</span> nginx are available on:
* https://nginx.com/products/

----------------------------------------------------------------------
  Verifying  <span class="token builtin class-name">:</span> pcre2-10.23-2.el7.x86_64                                                                                       <span class="token number">1</span>/2 
  Verifying  <span class="token builtin class-name">:</span> <span class="token number">1</span>:nginx-1.24.0-1.el7.ngx.x86_64                                                                                <span class="token number">2</span>/2 

Installed:
  nginx.x86_64 <span class="token number">1</span>:1.24.0-1.el7.ngx                                                                                                 

Dependency Installed:
  pcre2.x86_64 <span class="token number">0</span>:10.23-2.el7                                                                                                      

Complete<span class="token operator">!</span>

<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -v</span>
nginx version: nginx/1.24.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h2><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç®¡ç† Nginxï¼š</p>
<ul>
<li><code>ststemclt</code></li>
<li><code>nginx</code></li>
</ul>
<h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>éƒ¨ç½²å®Œæˆåï¼ŒNginx ä¼šæ³¨å†Œä¸ºæœåŠ¡ï¼Œä½¿ç”¨ <code>systemctl</code> å‘½ä»¤æ¥è¿›è¡Œç®¡ç†ã€‚</p>
<p>å¯åŠ¨ Nginx æœåŠ¡ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl start nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é…ç½®å¼€æœºå¯åŠ¨ Nginx æœåŠ¡ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable nginx</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æŸ¥çœ‹ Nginx æœåŠ¡çŠ¶æ€ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl status nginx</span>
â— nginx.service - nginx - high performance web server
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/nginx.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Mon <span class="token number">2023</span>-09-11 <span class="token number">11</span>:04:15 CST<span class="token punctuation">;</span> 1min 7s ago
     Docs: http://nginx.org/en/docs/
 Main PID: <span class="token number">2104</span> <span class="token punctuation">(</span>nginx<span class="token punctuation">)</span>
   CGroup: /system.slice/nginx.service
           â”œâ”€2104 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
           â””â”€2105 nginx: worker process

Sep <span class="token number">11</span> <span class="token number">11</span>:04:15 stone systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting nginx - high performance web server<span class="token punctuation">..</span>.
Sep <span class="token number">11</span> <span class="token number">11</span>:04:15 stone systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Can't <span class="token function">open</span> PID <span class="token function">file</span> /var/run/nginx.pid <span class="token punctuation">(</span>yet?<span class="token punctuation">)</span> after start: No such <span class="token function">file</span> or directory
Sep <span class="token number">11</span> <span class="token number">11</span>:04:15 stone systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started nginx - high performance web server.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡è½½ Nginx é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl reload nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…³é—­ Nginx æœåŠ¡ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é‡å¯ Nginx æœåŠ¡ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart nginx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><p>é™¤äº†ä½¿ç”¨ <code>systemclt</code> å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>nginx</code> å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -h</span>
nginx version: nginx/1.24.0
Usage: nginx <span class="token punctuation">[</span>-?hvVtTq<span class="token punctuation">]</span> <span class="token punctuation">[</span>-s signal<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p prefix<span class="token punctuation">]</span>
             <span class="token punctuation">[</span>-e filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-c filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-g directives<span class="token punctuation">]</span>

Options:
  -?,-h         <span class="token builtin class-name">:</span> this <span class="token builtin class-name">help</span>
  -v            <span class="token builtin class-name">:</span> show version and <span class="token builtin class-name">exit</span>
  -V            <span class="token builtin class-name">:</span> show version and configure options <span class="token keyword">then</span> <span class="token builtin class-name">exit</span>
  -t            <span class="token builtin class-name">:</span> <span class="token builtin class-name">test</span> configuration and <span class="token builtin class-name">exit</span>
  -T            <span class="token builtin class-name">:</span> <span class="token builtin class-name">test</span> configuration, dump it and <span class="token builtin class-name">exit</span>
  -q            <span class="token builtin class-name">:</span> suppress non-error messages during configuration testing
  -s signal     <span class="token builtin class-name">:</span> send signal to a master process: stop, quit, reopen, reload
  -p prefix     <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> prefix path <span class="token punctuation">(</span>default: /etc/nginx/<span class="token punctuation">)</span>
  -e filename   <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> error log <span class="token function">file</span> <span class="token punctuation">(</span>default: /var/log/nginx/error.log<span class="token punctuation">)</span>
  -c filename   <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> configuration <span class="token function">file</span> <span class="token punctuation">(</span>default: /etc/nginx/nginx.conf<span class="token punctuation">)</span>
  -g directives <span class="token builtin class-name">:</span> <span class="token builtin class-name">set</span> global directives out of configuration <span class="token function">file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¸¸ç”¨é€‰é¡¹æœ‰ï¼š</p>
<ul>
<li><code>-s signal</code>ï¼šå‘é€ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼ŒåŒ…æ‹¬ï¼š<ul>
<li><code>stop</code>ï¼šå‘é€ SIGTERM ä¿¡å·ï¼Œè¡¨ç¤ºå¿«é€Ÿå…³é—­ Nginx</li>
<li><code>quit</code>ï¼šå‘é€ SIGQUIT ä¿¡å·ï¼Œè¡¨ç¤ºä¼˜é›…å…³é—­ Nginx</li>
<li><code>reopen</code>ï¼šå‘é€ SIGUSR1 ä¿¡å·ï¼Œè¡¨ç¤ºé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</li>
<li><code>reload</code>ï¼šå‘é€ SIGHUP ä¿¡å·ï¼Œè¡¨ç¤ºé‡è½½é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨æ–°é…ç½®æ–‡ä»¶å¯åŠ¨æ–°çš„å·¥ä½œè¿›ç¨‹ï¼Œä¼˜é›…å…³é—­è€çš„å·¥ä½œè¿›ç¨‹</li>
</ul>
</li>
<li><code>-t</code>ï¼šæµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</li>
<li><code>-c</code>ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ä¸º <code>/etc/nginx/nginx.conf</code></li>
</ul>
<p>é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æŸ¥çœ‹é…ç½®ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -V</span>
nginx version: nginx/1.24.0
built by gcc <span class="token number">4.8</span>.5 <span class="token number">20150623</span> <span class="token punctuation">(</span>Red Hat <span class="token number">4.8</span>.5-44<span class="token punctuation">)</span> <span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> 
built with OpenSSL <span class="token number">1.0</span>.2k-fips  <span class="token number">26</span> Jan <span class="token number">2017</span>
TLS SNI support enabled
configure arguments: --prefix<span class="token operator">=</span>/etc/nginx --sbin-path<span class="token operator">=</span>/usr/sbin/nginx --modules-path<span class="token operator">=</span>/usr/lib64/nginx/modules --conf-path<span class="token operator">=</span>/etc/nginx/nginx.conf --error-log-path<span class="token operator">=</span>/var/log/nginx/error.log --http-log-path<span class="token operator">=</span>/var/log/nginx/access.log --pid-path<span class="token operator">=</span>/var/run/nginx.pid --lock-path<span class="token operator">=</span>/var/run/nginx.lock --http-client-body-temp-path<span class="token operator">=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span class="token operator">=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span class="token operator">=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span class="token operator">=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span class="token operator">=</span>/var/cache/nginx/scgi_temp --user<span class="token operator">=</span>nginx --group<span class="token operator">=</span>nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt<span class="token operator">=</span><span class="token string">'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC'</span> --with-ld-opt<span class="token operator">=</span><span class="token string">'-Wl,-z,relro -Wl,-z,now -pie'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>æŸ¥çœ‹ Nginx å¯¹åº”çš„è¿›ç¨‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep nginx | grep -v grep</span>
root       <span class="token number">2174</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">11</span>:11 ?        00:00:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
nginx      <span class="token number">2175</span>   <span class="token number">2174</span>  <span class="token number">0</span> <span class="token number">11</span>:11 ?        00:00:00 nginx: worker process<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ° Nginx çš„è¿›ç¨‹åŒ…æ‹¬ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ï¼š</p>
<ul>
<li>ä¸»è¿›ç¨‹ï¼ˆmaster processï¼‰ï¼šåœ¨ Nginx å¯åŠ¨æ—¶è¿è¡Œï¼Œä¸»è¦è´Ÿè´£è¯»å–é…ç½®æ–‡ä»¶å¹¶éªŒè¯å…¶æœ‰æ•ˆæ€§å’Œæ­£ç¡®æ€§ã€å»ºç«‹å’Œå…³é—­ Socketã€ç”Ÿæˆã€ç®¡ç†å’Œç»“æŸå·¥ä½œè¿›ç¨‹ã€æ¥æ”¶å¤–ç•ŒæŒ‡ä»¤ï¼Œå¦‚é‡å¯ã€é‡è½½ä»¥åŠé€€å‡ºæœåŠ¡å™¨ç­‰æŒ‡ä»¤ã€å®ç°å¹³æ»‘é‡å¯å’Œåº”ç”¨æ–°é…ç½®ã€å¼€å¯æ—¥å¿—æ–‡ä»¶ã€è·å–æ–‡ä»¶æè¿°ç¬¦ä»¥åŠç¼–è¯‘å’Œå¤„ç† Perl è„šæœ¬ç­‰åŠŸèƒ½ã€‚ä¸»è¿›ç¨‹ä»¥ <code>root</code> ç”¨æˆ·èº«ä»½è¿è¡Œã€‚</li>
<li>å·¥ä½œè¿›ç¨‹ï¼ˆworker processï¼‰ï¼šç”±ä¸»è¿›ç¨‹ç”Ÿæˆï¼Œæ•°é‡å¯ä»¥é€šè¿‡ Nginx é…ç½®æ–‡ä»¶æŒ‡å®šï¼Œæ­£å¸¸æƒ…å†µä¸‹ç”Ÿå­˜äºä¸»è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚å·¥ä½œè¿›ç¨‹ä¸»è¦è´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¿›è¡Œäº‹ä»¶å¤„ç†å’Œ I/O æ“ä½œç­‰ã€‚</li>
</ul>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>Nginx çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># rpm -ql nginx</span>
/etc/logrotate.d/nginx
/etc/nginx
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/fastcgi_params
/etc/nginx/mime.types
/etc/nginx/modules
/etc/nginx/nginx.conf
/etc/nginx/scgi_params
/etc/nginx/uwsgi_params
/usr/lib/systemd/system/nginx-debug.service
/usr/lib/systemd/system/nginx.service
/usr/lib64/nginx
/usr/lib64/nginx/modules
/usr/libexec/initscripts/legacy-actions/nginx
/usr/libexec/initscripts/legacy-actions/nginx/check-reload
/usr/libexec/initscripts/legacy-actions/nginx/upgrade
/usr/sbin/nginx
/usr/sbin/nginx-debug
/usr/share/doc/nginx-1.24.0
/usr/share/doc/nginx-1.24.0/COPYRIGHT
/usr/share/man/man8/nginx.8.gz
/usr/share/nginx
/usr/share/nginx/html
/usr/share/nginx/html/50x.html
/usr/share/nginx/html/index.html
/var/cache/nginx
/var/log/nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><p><code>/etc/logrotate.d/nginx</code>ï¼šæ—¥å¿—è½®è½¬é…ç½®æ–‡ä»¶</p>
</li>
<li><pre><code>/etc/nginx
<pre class="line-numbers language-none"><code class="language-none">
  ï¼šé…ç½®ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š

  - &#96;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf&#96;ï¼šä¸»é…ç½®æ–‡ä»¶ï¼Œä¼šè¯»å– &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#96; ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶
  - &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#96;ï¼šå­é…ç½®ç›®å½•
  - &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf&#96;ï¼šé»˜è®¤é…ç½®

- &#96;&#x2F;etc&#x2F;nginx&#x2F;mime.types&#96;ï¼šæ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»

- &#96;&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service&#96;ï¼šNginx æœåŠ¡æ–‡ä»¶

- &#96;&#x2F;usr&#x2F;sbin&#x2F;nginx&#96;ï¼šNginx å¯æ‰§è¡Œæ–‡ä»¶

- &#96;&#96;&#96;
  &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
ï¼šé™æ€é¡µé¢ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š

- `/usr/share/nginx/html/50x.html`ï¼šé»˜è®¤é”™è¯¯é¡µ
- `/usr/share/nginx/html/index.html`ï¼šé»˜è®¤é¦–é¡µ</code></pre>
</li>
<li><p><code>/var/log/nginx</code>ï¼šæ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•</p>
</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>Nginx çš„é»˜è®¤é…ç½®æ–‡ä»¶ä¸º <code>/etc/nginx/nginx.conf</code>ï¼ŒåŒ…æ‹¬å…¨å±€å—ï¼Œ<code>events</code> å—åŠ <code>http</code> å—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">user</span>  nginx<span class="token punctuation">;</span>
<span class="token keyword">worker_processes</span>  auto<span class="token punctuation">;</span>

<span class="token keyword">error_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log notice<span class="token punctuation">;</span>
<span class="token keyword">pid</span>        <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>nginx<span class="token punctuation">.</span><span class="token keyword">pid</span><span class="token punctuation">;</span>


<span class="token keyword">events</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">http</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">include</span>       <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    <span class="token keyword">log_format</span>  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>
                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>
                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>

    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>

    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>

    <span class="token keyword">include</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¨å±€å—é…ç½®å…¨å±€æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>user</code>ï¼šæŒ‡å®šå¯åŠ¨å·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·ï¼Œè¿™é‡Œä¸º <code>nginx</code>ï¼Œé»˜è®¤ä¸º <code>nobody</code></li>
<li><code>worker_processes</code>ï¼šæŒ‡å®šå·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œè¿™é‡Œä¸º <code>auto</code>ï¼Œè¡¨ç¤ºå·¥ä½œè¿›ç¨‹æ•°é‡ä¸ CPU æ•°é‡ç›¸åŒ</li>
<li><code>error_log</code>ï¼šæŒ‡å®šé”™è¯¯æ—¥å¿—å’Œæ—¥å¿—çº§åˆ«ï¼Œè¿™é‡Œä¸º <code>/var/log/nginx/error.log</code> å’Œ <code>notice</code></li>
<li><code>pid</code>ï¼šæŒ‡å®š PID æ–‡ä»¶ï¼Œé»˜è®¤ä¸º <code>/var/run/nginx.pid</code></li>
</ul>
<p><code>events</code> å—é…ç½®ä¸ç½‘ç»œè¿æ¥ç›¸å…³æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>worker_connections</code>ï¼šæŒ‡å®šæ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œè¿™é‡Œä¸º <code>1024</code>ï¼Œä¸èƒ½è¶…è¿‡å†…æ ¸å‚æ•° <code>fs.file-max</code> å’Œèµ„æºé™åˆ¶ <code>nofile</code> çš„å€¼</li>
</ul>
<p><code>http</code> å—é…ç½®ä¸ç½‘ç»œè¯·æ±‚ç›¸å…³æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><pre><code>include
<pre class="line-numbers language-none"><code class="language-none">
  ï¼šå¼•å…¥çš„å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæœ‰ï¼š

  - &#96;&#x2F;etc&#x2F;nginx&#x2F;mime.types&#96;ï¼šæ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»
  - &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf&#96;ï¼šåœ¨ &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;&#96; ç›®å½•ä¸‹æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«å¤šä¸ª &#96;server&#96; å—

- &#96;default_type&#96;ï¼šé»˜è®¤ MIME ç±»å‹ï¼Œè¿™é‡Œä¸º &#96;application&#x2F;octet-stream&#96;ï¼Œè¡¨ç¤ºå·²äºŒè¿›åˆ¶æµçš„æ–¹å¼ä¸‹è½½æ–‡ä»¶ï¼Œè¦å°†æ–‡ä»¶å†…å®¹æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥è®¾ç½®ä¸º &#96;text&#x2F;plain&#96;ã€‚è¿˜å¯ä»¥é…ç½®åœ¨ &#96;server&#96; å—å’Œ &#96;location&#96; å—ä¸­

- &#96;log_format&#96;ï¼šæ—¥å¿—æ ¼å¼ï¼Œè¿™é‡Œä¸º &#96;main&#96;ï¼Œå…¶åçš„å˜é‡å«ä¹‰å‚è€ƒ [setopen in new window](https:&#x2F;&#x2F;stonecoding.net&#x2F;system&#x2F;nginx&#x2F;nginx.html#set)

- &#96;access_log&#96;ï¼šè®¿é—®æ—¥å¿—åŠæ—¥å¿—æ ¼å¼ï¼Œè¿™é‡Œä¸º &#96;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log&#96; å’Œ &#96;main&#96;

- &#96;sendfile&#96;ï¼šæ˜¯å¦å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œè¿™é‡Œä¸º &#96;on&#96;ï¼Œç”¨äºæ–‡ä»¶æœåŠ¡å™¨

- &#96;keepalive_timeout&#96;ï¼šé•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œè¿™é‡Œä¸º &#96;65&#96; ç§’

**åœ¨ &#96;http&#96; å—ä¸­å¼•å…¥çš„é…ç½®æ–‡ä»¶ &#96;&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf &#96;åŒ…å« &#96;server&#96; å—åŠå…¶ä¸‹çš„ &#96;location&#96; å—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š**



&#96;&#96;&#96;nginx
server &#123;
    listen       80;
    server_name  localhost;

    #access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;host.access.log  main;

    location &#x2F; &#123;
        root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;
        index  index.html index.htm;
    &#125;

    #error_page  404              &#x2F;404.html;

    # redirect server error pages to the static page &#x2F;50x.html
    #
    error_page   500 502 503 504  &#x2F;50x.html;
    location &#x3D; &#x2F;50x.html &#123;
        root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;
    &#125;

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ &#123;
    #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;
    #&#125;

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ &#123;
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #&#125;

    # deny access to .htaccess files, if Apache&#39;s document root
    # concurs with nginx&#39;s one
    #
    #location ~ &#x2F;\.ht &#123;
    #    deny  all;
    #&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
`server` å—é…ç½®è™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥é…ç½®ç›¸åŒç›‘å¬ç«¯å£ï¼ˆæ¯”å¦‚ 80ï¼‰å’Œä¸åŒåŸŸåçš„å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚åŒ…æ‹¬ï¼š</code></pre>
</li>
<li><p><code>listen</code>ï¼šç›‘å¬ç«¯å£ï¼Œåé¢å¯ä»¥åŠ ä¸Š <code>default_server</code> å±æ€§æ¥æŒ‡å®šè¯¥ <code>server</code> ä¸ºé»˜è®¤åŒ¹é…çš„è™šæ‹Ÿä¸»æœºï¼Œç”¨äºå¤„ç†æ²¡æœ‰åŒ¹é…åˆ° <code>server_name:listen</code> çš„è¯·æ±‚ï¼Œå¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ª <code>server</code> ä½œä¸ºé»˜è®¤åŒ¹é…çš„è™šæ‹Ÿä¸»æœºã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>listen 80</code></li>
<li><code>listen 8080 default_server</code></li>
</ul>
</li>
<li><p><code>server_name</code>ï¼šè™šæ‹Ÿä¸»æœºåã€‚å¯ä»¥æ˜¯ IP åœ°å€ã€ä¸»æœºåã€åŸŸåã€‚å¯ä»¥å¤šä¸ªï¼Œä»¥ç©ºæ ¼åˆ†éš”ã€‚å¯ä»¥ç²¾ç¡®åŒ¹é…ã€é€šé…ç¬¦åŒ¹é…ï¼ˆ<code>*</code>ï¼Œåªèƒ½å‡ºç°åœ¨åŸŸåé¦–å°¾ï¼Œä¸èƒ½å‡ºç°åœ¨åŸŸåä¸­é—´ï¼‰æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆä»¥ <code>~</code> ä¸ºæ­£åˆ™å¼€å§‹æ ‡è®°ï¼Œåé¢ä¸èƒ½åŠ ç©ºæ ¼ã€‚å¯ä»¥ä½¿ç”¨æ‹¬å·åŒ…è£¹ï¼Œåç»­ä½¿ç”¨ <code>$1</code>ï¼Œ<code>$2</code> ç­‰å–å€¼ï¼‰ã€‚åŒ¹é…é¡ºåºä¸ºå…ˆç²¾ç¡®åŒ¹é…ï¼Œå†å‰é€šé…ç¬¦åŒ¹é…ï¼Œå†åé€šé…ç¬¦åŒ¹é…ï¼Œå†æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œæœ€åé»˜è®¤åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>server_name localhost</code></li>
<li><code>server_name stonecoding.net minio.stonecoding.net</code></li>
<li><code>server_name *.stonecoding.net</code></li>
<li><code>server_name www.stonecoding.*</code></li>
<li><code>server_name ~^www\.(\w+)\.com$</code></li>
</ul>
</li>
<li><p><code>error_page</code>ï¼šæŒ‡å®šé”™è¯¯é¡µé¢ï¼Œå¯ä»¥</p>
<ul>
<li>æŒ‡å®šè·³è½¬åœ°å€ï¼š<code>error_page 404 https://stonecoding.net</code></li>
<li>æŒ‡å®šé‡å®šå‘åœ°å€ï¼š<code>error_page 500 502 503 504 /50x.html</code></li>
<li>ä½¿ç”¨ <code>@</code> æŒ‡å®šå¯¹åº”çš„ <code>location</code> å—ï¼š<code>error_page 404 @jump_to_error</code></li>
<li>ä½¿ç”¨ <code>=[response]</code> æ›´æ”¹å“åº”ç ï¼š<code>error_page 404 =200 /50x.html</code></li>
</ul>
</li>
</ul>
<p><code>location</code> å—æŒ‡å®šä¸è¯·æ±‚èµ„æºç›¸åŒ¹é…çš„è·¯å¾„ï¼Œè¯­æ³•ä¸º <code>location [ = | ~ | ~* | ^~ | @ ] uri &#123; ... &#125;</code>ï¼š</p>
<ul>
<li><code>location /abc</code>ï¼šåŒ¹é…ä»¥ <code>abc</code> å¼€å¤´çš„è¯·æ±‚ï¼Œæ¯”å¦‚ <code>server_name:listen/abc</code> æˆ–è€… <code>server_name:listen/abcd</code></li>
<li><code>location =/abc</code>ï¼šç²¾ç¡®åŒ¹é… <code>abc</code> è¯·æ±‚ï¼Œä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ <code>server_name:listen/abc</code>ï¼Œ <code>server_name:listen/abc?username=tom</code></li>
<li><code>location ~^/abc\w$</code>ï¼šåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”åŒºåˆ†å¤§å°å†™ï¼Œæ¯”å¦‚ <code>server_name:listen/abc1</code></li>
<li><code>location ~*^/abc\w$</code>ï¼šåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œæ¯”å¦‚ <code>server_name:listen/ABc1</code></li>
<li><code>location ^~/abc</code>ï¼šä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŠŸèƒ½å’Œä¸åŠ ç¬¦å·çš„ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå¦‚æœåŒ¹é…ï¼Œé‚£ä¹ˆå°±åœæ­¢æœç´¢</li>
</ul>
<p><code>location</code> å—åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>root</code>ï¼šè¯·æ±‚èµ„æºçš„æ ¹ç›®å½•ï¼Œæœ€ç»ˆè¯·æ±‚çš„è·¯å¾„å°±æ˜¯ <code>root</code> + <code>location</code></li>
<li><code>index</code>ï¼šé»˜è®¤é¦–é¡µ</li>
</ul>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä¸€ä¸ª <code>http</code> å—å¯ä»¥åŒ…å«å¤šä¸ª <code>server</code> å—ï¼Œä¸€ä¸ª <code>server</code> å—å¯ä»¥åŒ…å«å¤šä¸ª <code>location</code> å—ã€‚</li>
<li>å¯¹äºå¯ä»¥åœ¨å¤šä¸ªå—ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œå°èŒƒå›´çš„æŒ‡ä»¤ä¼˜å…ˆã€‚ä¾‹å¦‚ <code>access_log</code> æŒ‡ä»¤å¯ä»¥åœ¨ <code>http</code> å—ï¼Œ<code>server</code> å—å’Œ <code>location</code> å—ä½¿ç”¨ï¼Œå¦‚æœéƒ½æœ‰é…ç½®ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨çš„æ˜¯ <code>location</code> å—ã€‚</li>
</ul>
<p>ä½¿ç”¨é»˜è®¤çš„é…ç½®æ–‡ä»¶å¯åŠ¨ Nginxï¼Œä½œä¸ºä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œè®¿é—®ä¸Šé¢ <code>server</code> å—ä¸­é…ç½®çš„è™šæ‹Ÿä¸»æœºåå’Œç«¯å£ ï¼Œè¿”å› <code>/usr/share/nginx/html/index.html</code> æ–‡ä»¶å†…å®¹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl localhost:80</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>title<span class="token operator">></span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">&lt;</span>style<span class="token operator">></span>
html <span class="token punctuation">&#123;</span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
body <span class="token punctuation">&#123;</span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span>/style<span class="token operator">></span>
<span class="token operator">&lt;</span>/head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>></span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span>
<span class="token operator">&lt;</span>p<span class="token operator">></span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">></span>

<span class="token operator">&lt;</span>p<span class="token operator">></span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">></span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">></span>.<span class="token operator">&lt;</span>br/<span class="token operator">></span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">></span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">></span>.<span class="token operator">&lt;</span>/p<span class="token operator">></span>

<span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span>em<span class="token operator">></span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">></span><span class="token operator">&lt;</span>/p<span class="token operator">></span>
<span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h2><p>é™¤äº†åœ¨ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­é»˜è®¤ä½¿ç”¨çš„æŒ‡ä»¤å¤–ï¼ŒNginx è¿˜æœ‰éå¸¸å¤šçš„å†…ç½®æŒ‡ä»¤ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„æŒ‡ä»¤ã€‚</p>
<h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><p>ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥æé«˜ç½‘ç»œæ€§èƒ½ï¼Œæ¥è‡ªäº <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_core_module.html">ngx_http_core_moduleopen in new window</a> æ¨¡å—ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx">tcp_nodeplay on<span class="token punctuation">;</span>
<span class="token keyword">tcp_nopush</span> on<span class="token punctuation">;</span>
<span class="token keyword">client_max_body_size</span> <span class="token number">10</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="tcp-nodelay"><a href="#tcp-nodelay" class="headerlink" title="tcp_nodelay"></a>tcp_nodelay</h4><p>ä½¿ç”¨ <code>tcp_nodelay</code> æŒ‡ä»¤æé«˜ç½‘ç»œåŒ…ä¼ è¾“å®æ—¶æ€§ï¼Œå¿…é¡»åœ¨è¿æ¥ä¸º keep-alive çŠ¶æ€æ‰èƒ½å¯ç”¨ã€‚</p>
<p>| Syntax:  | <code>tcp_nodelay on</code> | <code>off;</code>    |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>tcp_nodelay on;</code>            |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code> |</p>
<h4 id="tcp-nopush"><a href="#tcp-nopush" class="headerlink" title="tcp_nopush"></a>tcp_nopush</h4><p>ä½¿ç”¨ <code>tcp_nopush</code> æŒ‡ä»¤æå‡ç½‘ç»œåŒ…ä¼ è¾“æ•ˆç‡ï¼Œå¿…é¡»åœ¨ä½¿ç”¨ <code>sendfile</code> æ—¶æ‰ä¼šå¯ç”¨ã€‚</p>
<p>| Syntax:  | <code>tcp_nopush on</code> | <code>off;</code>     |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>tcp_nopush off;</code>            |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code> |</p>
<h4 id="client-max-body-size"><a href="#client-max-body-size" class="headerlink" title="client_max_body_size"></a>client_max_body_size</h4><p>ä½¿ç”¨ <code>client_max_body_size</code> æŒ‡ä»¤æŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚ä½“æœ€å¤§å€¼ï¼Œç”¨äºé™åˆ¶ä¸Šä¼ ä¸‹è½½æ–‡ä»¶çš„å¤§å°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>client_max_body_size size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>client_max_body_size 1m;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h3 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html">ngx_http_gzip_moduleopen in new window</a> æ¨¡å—ä¸‹çš„å‹ç¼©æŒ‡ä»¤æ¥å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ï¼ŒèŠ‚çº¦å¸¦å®½ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">gzip</span> on<span class="token punctuation">;</span>
<span class="token keyword">gzip_comp_level</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token keyword">gzip_min_length</span> <span class="token number">1</span>k<span class="token punctuation">;</span>
<span class="token keyword">gzip_types</span> text<span class="token operator">/</span>plain text<span class="token operator">/</span>css application<span class="token operator">/</span>json application<span class="token operator">/</span>javascript application<span class="token operator">/</span>xml<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h4><p>ä½¿ç”¨ <code>gzip</code> æŒ‡ä»¤å¼€å¯æˆ–è€…å…³é—­å‹ç¼©ã€‚</p>
<p>| Syntax:  | <code>gzip on</code> | <code>off;</code>                             |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>gzip off;</code>                                    |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>, <code>if in location</code> |</p>
<h4 id="gzip-buffers"><a href="#gzip-buffers" class="headerlink" title="gzip_buffers"></a>gzip_buffers</h4><p>ä½¿ç”¨ <code>gzip_buffers</code> æŒ‡ä»¤è®¾ç½®å¤„ç†å‹ç¼©çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°ã€‚ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>gzip_buffers number size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>gzip_buffers 32 4k</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="gzip-comp-level"><a href="#gzip-comp-level" class="headerlink" title="gzip_comp_level"></a>gzip_comp_level</h4><p>ä½¿ç”¨ <code>gzip_comp_level</code> æŒ‡ä»¤æŒ‡å®šå‹ç¼©çº§åˆ«ã€‚èŒƒå›´ä¸º 1 åˆ° 9ï¼Œé»˜è®¤ä¸º 1ï¼Œå‹ç¼©ç‡ä½ï¼Œæ•ˆç‡é«˜ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>gzip_comp_level level;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>gzip_comp_level 1;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="gzip-disable"><a href="#gzip-disable" class="headerlink" title="gzip_disable"></a>gzip_disable</h4><p>ä½¿ç”¨ <code>gzip_disable</code> æŒ‡ä»¤ä¸ºæŒ‡å®šçš„å®¢æˆ·ç«¯è¯·æ±‚å…³é—­å‹ç¼©ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>gzip_disable regex ...;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>æ ¹æ®è¯·æ±‚å¤´ <code>User-Agent</code> æ¥è®¾ç½®ï¼Œæ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>ä¾‹å¦‚ä¸ºä¸æ”¯æŒå‹ç¼©çš„ IE 6 åŠä»¥ä¸‹ç‰ˆæœ¬æµè§ˆå™¨å…³é—­å‹ç¼©ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">gzip_disable</span> <span class="token string">"MSIE [1-6]\."</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="gzip-http-version"><a href="#gzip-http-version" class="headerlink" title="gzip_http_version"></a>gzip_http_version</h4><p>ä½¿ç”¨ <code>gzip_http_version</code> æŒ‡ä»¤æŒ‡å®šå¯ä»¥ä½¿ç”¨å‹ç¼©çš„æœ€å° HTTP ç‰ˆæœ¬ã€‚ä½¿ç”¨é»˜è®¤å³å¯ã€‚</p>
<p>| Syntax:  | <code>gzip_http_version 1.0</code> | <code>1.1;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>gzip_http_version 1.1;</code>         |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>     |</p>
<h4 id="gzip-min-length"><a href="#gzip-min-length" class="headerlink" title="gzip_min_length"></a>gzip_min_length</h4><p>ä½¿ç”¨ <code>gzip_min_length</code> æŒ‡ä»¤æŒ‡å®šå¯ä»¥è¢«å‹ç¼©çš„å“åº”çš„æœ€å°é•¿åº¦ã€‚å»ºè®®è®¾ç½®ä¸º 1K æˆ–ä»¥ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>gzip_min_length length;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>gzip_min_length 20;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>æ ¹æ®å“åº”å¤´ <code>Content-Length</code> æ¥å†³å®šã€‚</p>
<h4 id="gzip-proxied"><a href="#gzip-proxied" class="headerlink" title="gzip_proxied"></a>gzip_proxied</h4><p>ä½¿ç”¨ <code>gzip_proxied</code> æŒ‡ä»¤è®¾ç½®æ˜¯å¦å¯¹æœåŠ¡ç«¯è¿”å›çš„ç»“æœè¿›è¡Œå‹ç¼©ã€‚</p>
<p>| Syntax:  | <code>gzip_proxied off</code> | <code>expired</code> | <code>no-cache</code> | <code>no-store</code> | <code>private</code> | <code>no_last_modified</code> | <code>no_etag</code> | <code>auth</code> | <code>any ...;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | <code>gzip_proxied off;</code>                                          |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>                                 |</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>off</code>ï¼šå¯¹æ‰€æœ‰ä»£ç†è¯·æ±‚ç¦ç”¨å‹ç¼©ã€‚</li>
<li><code>expired</code>ï¼šå¦‚æœå“åº”å¤´åŒ…å« <code>Expires</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>no-cache</code>ï¼šå¦‚æœå“åº”å¤´åŒ…å« <code>Cache-Control:no-cache</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>no-store</code>ï¼šå¦‚æœå“åº”å¤´åŒ…å« <code>Cache-Control:no-store</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>private</code>ï¼šå¦‚æœå“åº”å¤´åŒ…å« <code>Cache-Control:private</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>no_last_modified</code>ï¼šå¦‚æœå“åº”å¤´ä¸åŒ…å« <code>Last-Modified</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>no_etag</code>ï¼šå¦‚æœå“åº”å¤´ä¸åŒ…å« <code>ETag</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>auth</code>ï¼šå¦‚æœè¯·æ±‚å¤´åŒ…å« <code>Authorization</code>ï¼Œåˆ™å¯ç”¨å‹ç¼©</li>
<li><code>any</code>ï¼šå¯¹æ‰€æœ‰ä»£ç†è¯·æ±‚å¯ç”¨å‹ç¼©ã€‚</li>
</ul>
<h4 id="gzip-types"><a href="#gzip-types" class="headerlink" title="gzip_types"></a>gzip_types</h4><p>ä½¿ç”¨ <code>gzip_types</code> æŒ‡ä»¤æŒ‡å®šé™¤ <code>text/html</code> å¤–å¯ä»¥è¢«å‹ç¼©çš„ MIME ç±»å‹ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>gzip_types mime-type ...;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>gzip_types text/html;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>ä½¿ç”¨ <code>*</code> åŒ¹é…æ‰€æœ‰ç±»å‹ï¼Œ<code>text/html</code> ç±»å‹çš„å“åº”å§‹ç»ˆè¢«å‹ç¼©ã€‚</p>
<h4 id="gzip-vary"><a href="#gzip-vary" class="headerlink" title="gzip_vary"></a>gzip_vary</h4><p>ä½¿ç”¨ <code>gzip_vary</code> æŒ‡ä»¤æŒ‡å®šåœ¨ä½¿ç”¨ <code>gzip</code>ï¼Œ<code>gzip_static</code> æˆ–è€… <code>gunzip</code> æ—¶æ˜¯å¦å¢åŠ  <code>Vary: Accept-Encoding</code> å“åº”å¤´ã€‚</p>
<p>| Syntax:  | <code>gzip_vary on</code> | <code>off;</code>      |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>gzip_vary off;</code>             |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code> |</p>
<h3 id="å®¢æˆ·ç«¯ç¼“å­˜"><a href="#å®¢æˆ·ç«¯ç¼“å­˜" class="headerlink" title="å®¢æˆ·ç«¯ç¼“å­˜"></a>å®¢æˆ·ç«¯ç¼“å­˜</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_headers_module.html">ngx_http_headers_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤é…ç½®å®¢æˆ·ç«¯ç¼“å­˜ã€‚</p>
<h4 id="expires"><a href="#expires" class="headerlink" title="expires"></a>expires</h4><p>ä½¿ç”¨ <code>expires</code> æŒ‡ä»¤é€šè¿‡è®¾ç½®å“åº”å¤´çš„ <code>Expires</code> å’Œ <code>Cache-Control</code> æ¥æ§åˆ¶é¡µé¢ç¼“å­˜è¿‡æœŸæ—¶é—´ã€‚</p>
<p>| Syntax:  | <code>expires [modified] time;</code> <code>expires epoch</code> | <code>max</code> | <code>off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>expires off;</code>                                              |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>, <code>if in location</code>              |</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>time</code>ï¼šæŒ‡å®šç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä»å½“å‰æ—¶é—´å¼€å§‹è®¡ç®—ï¼Œå¦‚æœä½¿ç”¨ <code>modified</code>ï¼Œåˆ™ä»æ–‡ä»¶ä¿®æ”¹æ—¶é—´å¼€å§‹è®¡ç®—ã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™ <code>Cache-Control</code> ä¸º <code>no-cache</code>ï¼Œå¦åˆ™ <code>Cache-Control</code> ä¸º <code>max-age=time</code> ã€‚è¿˜å¯ä»¥åœ¨å‰é¢åŠ ä¸Š <code>@</code> è¡¨ç¤ºä¸€å¤©çš„æŸä¸ªæ—¶é—´ç‚¹ã€‚å¯ä»¥ä½¿ç”¨çš„æ—¶é—´å•ä½å¦‚ä¸‹ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>Unit</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>ms</td>
<td>milliseconds</td>
</tr>
<tr>
<td>s</td>
<td>seconds</td>
</tr>
<tr>
<td>m</td>
<td>minutes</td>
</tr>
<tr>
<td>h</td>
<td>hours</td>
</tr>
<tr>
<td>d</td>
<td>days</td>
</tr>
<tr>
<td>w</td>
<td>weeks</td>
</tr>
<tr>
<td>M</td>
<td>months, 30 days</td>
</tr>
<tr>
<td>y</td>
<td>years, 365 days</td>
</tr>
</tbody></table>
<ul>
<li><code>epoch</code>ï¼šè®¾ç½® <code>Expires</code> ä¸º <code>Thu, 01 Jan 1970 00:00:01 GMT</code>ï¼Œ<code>Cache-Control</code> ä¸º <code>no-cache</code></li>
<li><code>max</code>ï¼šè®¾ç½® <code>Expires</code> ä¸º <code>Thu, 31 Dec 2037 23:55:55 GMT</code>ï¼Œ<code>Cache-Control</code> ä¸º 10 å¹´</li>
<li><code>off</code>ï¼šä¸ä¼šè®¾ç½®å“åº”å¤´çš„ <code>Expires</code> å’Œ <code>Cache-Control</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">expires</span>    <span class="token number">24</span>h<span class="token punctuation">;</span>
<span class="token keyword">expires</span>    modified <span class="token operator">+</span><span class="token number">24</span>h<span class="token punctuation">;</span>
<span class="token keyword">expires</span>    @<span class="token number">15</span>h30m<span class="token punctuation">;</span>
<span class="token keyword">expires</span>    <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">expires</span>    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">expires</span>    epoch<span class="token punctuation">;</span>
<span class="token keyword">expires</span>    max<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="add-header"><a href="#add-header" class="headerlink" title="add_header"></a>add_header</h4><p>ä½¿ç”¨ <code>add_header</code> æŒ‡ä»¤è‡ªå®šä¹‰å“åº”å¤´å®ç°å®¢æˆ·ç«¯ç¼“å­˜çš„æ§åˆ¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>add_header name value [always];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code>, <code>if in location</code></td>
</tr>
</tbody></table>
<p><code>Cache-Control</code> å¯ä»¥è®¾ç½®ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>must-revalidate</code></td>
<td>ç¼“å­˜å¿…é¡»åœ¨ä½¿ç”¨ä¹‹å‰éªŒè¯æ—§èµ„æºçš„çŠ¶æ€</td>
</tr>
<tr>
<td><code>no-cache</code></td>
<td>åœ¨ç¼“å­˜å‰è¦å‘æœåŠ¡å™¨ç¡®è®¤èµ„æºæ˜¯å¦è¢«æ›´æ”¹</td>
</tr>
<tr>
<td><code>no-store</code></td>
<td>ç»å¯¹ç¦æ­¢ç¼“å­˜</td>
</tr>
<tr>
<td><code>no-transform</code></td>
<td>ä»£ç†ä¸å¾—å¯¹èµ„æºè¿›è¡Œè½¬æ¢æˆ–è½¬å˜</td>
</tr>
<tr>
<td><code>public</code></td>
<td>å¯ä»¥è¢«ä»»ä½•å¯¹è±¡ç¼“å­˜</td>
</tr>
<tr>
<td><code>private</code></td>
<td>åªèƒ½è¢«å•ä¸ªç”¨æˆ·ç¼“å­˜ï¼Œä¸èƒ½ä½œä¸ºå…±äº«ç¼“å­˜</td>
</tr>
<tr>
<td><code>proxy-revalidate</code></td>
<td>è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤</td>
</tr>
<tr>
<td><code>max-age=</code></td>
<td>ä»¥ç§’ä¸ºå•ä½çš„ç¼“å­˜æ—¶é—´ï¼Œä¼šè¦†ç›– <code>Expires</code></td>
</tr>
<tr>
<td><code>s-maxage=</code></td>
<td>ä»¥ç§’ä¸ºå•ä½çš„ç¼“å­˜æ—¶é—´ï¼Œä»…é€‚ç”¨äºå…±äº«ç¼“å­˜ï¼Œä¼šè¦†ç›– <code>Expires</code> å’Œ <code>max-age</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">add_header</span> Cache<span class="token operator">-</span>Control private<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h3><p>å¦‚æœä¸¤ä¸ªç½‘å€çš„åè®®ï¼ŒåŸŸåæˆ–è€…ç«¯å£ä¸åŒï¼Œåˆ™å°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚</p>
<p>ä½¿ç”¨ <code>add_header</code> æŒ‡ä»¤æ·»åŠ ä»¥ä¸‹å“åº”å¤´ä»¥è§£å†³è·¨åŸŸé—®é¢˜ï¼š</p>
<ul>
<li><code>Access-Control-Allow-Origin</code>ï¼šå…è®¸è·¨åŸŸè®¿é—®çš„æºåœ°å€ä¿¡æ¯ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>*</code> è¡¨ç¤ºæ‰€æœ‰æºã€‚è¯­æ³•ä¸º <code>Access-Control-Allow-Origin:  | *</code>ã€‚</li>
<li><code>Access-Control-Allow-Methods</code>ï¼šå…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹å¼ï¼Œè¯­æ³•ä¸º <code>Access-Control-Allow-Methods: [, ]*</code>ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">add_header</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span><span class="token keyword">Allow</span><span class="token operator">-</span>Origin <span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token keyword">add_header</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span><span class="token keyword">Allow</span><span class="token operator">-</span>Methods GET<span class="token punctuation">,</span>POST<span class="token punctuation">,</span>PUT<span class="token punctuation">,</span>DELETE<span class="token punctuation">,</span>OPTIONS<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é˜²ç›—é“¾"><a href="#é˜²ç›—é“¾" class="headerlink" title="é˜²ç›—é“¾"></a>é˜²ç›—é“¾</h3><p>ä¸ºé˜²æ­¢å…¶ä»–ç½‘ç«™ç›—ç”¨è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_referer_module.html">ngx_http_referer_moduleopen in new window</a> æ¨¡å—ä¸‹çš„ <code>valid_referers</code> æŒ‡ä»¤æ¥é˜²æ­¢ç›—é“¾ã€‚</p>
<h4 id="valid-referers"><a href="#valid-referers" class="headerlink" title="[valid_referers"></a>[valid_referers</h4><p>ä½¿ç”¨ <code>valid_referers</code> æŒ‡å®šè®¾ç½®å…è®¸è®¿é—®çš„å®¢æˆ·ç«¯åœ°å€ã€‚</p>
<p>| Syntax:  | <code>valid_referers none</code> | <code>blocked</code> | <code>server_names</code> | <code>string ...;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | â€”                                                            |<br>| Context: | <code>server</code>, <code>location</code>                                         |</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>none</code>ï¼šè¯·æ±‚å¤´æ²¡æœ‰ <code>Referer</code> ä¿¡æ¯ã€‚</li>
<li><code>blocked</code>ï¼šè¯·æ±‚å¤´ä¸­æœ‰ <code>Referer</code>ï¼Œä½†å…¶å€¼å·²è¢«é˜²ç«å¢™æˆ–è€…ä»£ç†æœåŠ¡å™¨åˆ é™¤ï¼Œå¦‚ä¸ä»¥ <code>http://</code> æˆ–è€… <code>https://</code> å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</li>
<li><code>server_names</code>ï¼šè¯·æ±‚å¤´çš„ <code>Referer</code> ä¸ºè®¾ç½®çš„åŸŸåæˆ–è€… IP ä¹‹ä¸€ã€‚</li>
<li><code>string</code>ï¼šæ”¯æŒ <code>*</code> å’Œæ­£åˆ™è¡¨è¾¾å¼çš„åŸŸåå­—ç¬¦ä¸²ï¼Œ<code>*</code> åªèƒ½ä½äºé¦–ä½ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä»¥ <code>~</code> å¼€å¤´ã€‚</li>
</ul>
<p>å¦‚æœè¯·æ±‚å¤´çš„ <code>Referer</code> ä¸ <code>valid_referers</code> åŒ¹é…æ—¶ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œä¼šå°† <code>$invalid_referer</code> å˜é‡è®¾ç½®ä¸º 0ï¼Œå¦åˆ™è®¾ç½®ä¸º 1ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>images <span class="token punctuation">&#123;</span>
    <span class="token keyword">valid_referers</span> none blocked www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">*</span><span class="token punctuation">.</span>example<span class="token punctuation">.</span>com example<span class="token punctuation">.</span><span class="token operator">*</span>  www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>org<span class="token operator">/</span>galleries<span class="token operator">/</span>  <span class="token operator">~</span>\<span class="token punctuation">.</span>google\<span class="token punctuation">.</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é‡å†™"><a href="#é‡å†™" class="headerlink" title="é‡å†™"></a>é‡å†™</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html">ngx_http_rewrite_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç° URL é‡å†™ã€‚</p>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p>ä½¿ç”¨ <code>set</code> æŒ‡ä»¤è®¾ç½®å˜é‡åŠå…¶å€¼ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>set $variable value;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code>, <code>location</code>, <code>if</code></td>
</tr>
</tbody></table>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>$variable</code>ï¼šå˜é‡åï¼Œä»¥ <code>$</code> å¼€å¤´ï¼Œä¸èƒ½ä¸ Nginx é¢„è®¾çš„å…¨å±€å˜é‡åŒåã€‚</li>
<li><code>value</code>ï¼šå˜é‡å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å…¶ä»–å˜é‡æˆ–è€…å®ƒä»¬çš„ç»„åˆã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">set</span> <span class="token variable">$name</span> STONE<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¸¸ç”¨å…¨å±€å˜é‡æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>å˜é‡</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>$args</td>
<td>å˜é‡ä¸­å­˜æ”¾äº†è¯·æ±‚ URL ä¸­çš„å‚æ•°ã€‚æ¯”å¦‚ <code>http://192.168.200.133:8080?arg1=value1&amp;args2=value2</code> ä¸­çš„ <code>arg1=value1&amp;arg2=value2</code>ï¼ŒåŠŸèƒ½å’Œ <code>$query_string</code> ä¸€æ ·</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡çš„ä»£ç†ä¿¡æ¯ï¼ˆå¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè®°å½•çš„æ˜¯æµè§ˆå™¨çš„ç›¸å…³ç‰ˆæœ¬ä¿¡æ¯ï¼‰</td>
</tr>
<tr>
<td>$host</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯è®¿é—®æœåŠ¡å™¨çš„ IPåœ°å€</td>
</tr>
<tr>
<td>$document_uri</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è®¿é—®åœ°å€çš„ URIã€‚æ¯”å¦‚ <code>http://192.168.200.133/server?id=10&amp;name=zhangsan</code> ä¸­çš„ <code>/server</code>ï¼ŒåŠŸèƒ½å’Œ <code>$uri</code> ä¸€æ ·</td>
</tr>
<tr>
<td>$document_root</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è¯·æ±‚å¯¹åº” <code>location</code> çš„ <code>root</code> å€¼ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘ Nginx è‡ªå¸¦ html ç›®å½•æ‰€åœ¨ä½ç½®</td>
</tr>
<tr>
<td>$content_length</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„ <code>Content-Length</code> çš„å€¼</td>
</tr>
<tr>
<td>$content_type</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„ <code>Content-Type</code> çš„å€¼</td>
</tr>
<tr>
<td>$http_cookie</td>
<td>å˜é‡å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„ Cookie ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ <code>add_header Set-Cookie &#39;cookieName=cookieValue&#39;</code> æ¥æ·»åŠ  Cookie æ•°æ®</td>
</tr>
<tr>
<td>$limit_rate</td>
<td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯ Nginx æœåŠ¡å™¨å¯¹ç½‘ç»œè¿æ¥é€Ÿç‡çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ Nginx é…ç½®ä¸­å¯¹ <code>limit_rate</code> æŒ‡ä»¤è®¾ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯ 0ï¼Œä¸é™åˆ¶</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>å˜é‡ä¸­å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„ IP åœ°å€</td>
</tr>
<tr>
<td>$remote_port</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å·</td>
</tr>
<tr>
<td>$remote_user</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„ç”¨æˆ·åï¼Œéœ€è¦æœ‰è®¤è¯æ¨¡å—æ‰èƒ½è·å–</td>
</tr>
<tr>
<td>$scheme</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†è®¿é—®åè®®</td>
</tr>
<tr>
<td>$server_addr</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†æœåŠ¡ç«¯çš„åœ°å€</td>
</tr>
<tr>
<td>$server_name</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨çš„åç§°</td>
</tr>
<tr>
<td>$server_port</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·</td>
</tr>
<tr>
<td>$server_protocol</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åè®®çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ HTTP/1.1</td>
</tr>
<tr>
<td>$request_body_file</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å‘ç»™åç«¯æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶èµ„æºçš„åç§°</td>
</tr>
<tr>
<td>$request_method</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚ GETï¼ŒPOST ç­‰</td>
</tr>
<tr>
<td>$request_filename</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„å</td>
</tr>
<tr>
<td>$request_uri</td>
<td>å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„ URIï¼Œå¹¶ä¸”æºå¸¦è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚ <code>http://192.168.200.133/server?id=10&amp;name=zhangsan</code> ä¸­çš„ <code>/server?id=10&amp;name=zhangsan</code></td>
</tr>
</tbody></table>
<h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><p>ä½¿ç”¨ <code>if</code> æŒ‡ä»¤è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>if (condition) &#123; ... &#125;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p><code>condition</code> ä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œå¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>å˜é‡åï¼Œå¦‚æœå˜é‡å€¼ä¸ºç©ºå­—ç¬¦ä¸²æˆ–è€… 0 åˆ™è¿”å› <code>false</code>ã€‚</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä½¿ç”¨ <code>=</code> å’Œ <code>!=</code> æ“ä½œç¬¦æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²ï¼Œæ»¡è¶³æ¡ä»¶è¿”å› <code>true</code>ï¼Œä¸æ»¡è¶³è¿”å› <code>false</code>ï¼Œå­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·ã€‚</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> POST<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token number">405</span> error<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸€èˆ¬ä¸éœ€è¦åŠ å¼•å·ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å« <code>&#125;</code> æˆ–è€… <code>;</code> æ—¶ï¼Œéœ€è¦åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·ã€‚åŒ…æ‹¬ï¼š<ul>
<li><code>~</code>ï¼šåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ã€‚</li>
<li><code>~*</code>ï¼šåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ã€‚</li>
<li><code>!~</code>ï¼šåå‘åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ã€‚</li>
<li><code>!~*</code>ï¼šåå‘åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ã€‚</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> <span class="token operator">~</span> MSIE<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> IE
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä½¿ç”¨ <code>-f</code> å’Œ <code>!-f</code> æ“ä½œç¬¦åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>f <span class="token variable">$request_filename</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&lt;h1>file not find&lt;/h1>'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä½¿ç”¨ <code>-d</code> å’Œ <code>!-d</code> æ“ä½œç¬¦åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</li>
<li>ä½¿ç”¨ <code>-e</code> å’Œ <code>!-e</code> æ“ä½œç¬¦åˆ¤æ–­æ–‡ä»¶ï¼Œç›®å½•æˆ–è€…ç¬¦å·é“¾æ¥æ˜¯å¦å­˜åœ¨ã€‚</li>
<li>ä½¿ç”¨ <code>-x</code> å’Œ <code>!-x</code> æ“ä½œç¬¦åˆ¤æ–­å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
</ul>
<h4 id="break"><a href="#break" class="headerlink" title="break"></a>break</h4><p>ä½¿ç”¨ <code>break</code> æŒ‡ä»¤åœæ­¢å¤„ç†å½“å‰ä½œç”¨åŸŸæŒ‡ä»¤ï¼Œå¹¶å°†è¯·æ±‚çš„ URI åœ¨æœ¬ <code>location</code> è¿›è¡Œé‡å®šå‘è®¿é—®å¤„ç†ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>break;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code>, <code>location</code>, <code>if</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>testbreak <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">set</span> <span class="token variable">$username</span> STONE<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">set</span> <span class="token variable">$username</span> TOM<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">set</span> <span class="token variable">$username</span> JERRY<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">add_header</span> username <span class="token variable">$username</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token variable">$username</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œéœ€è¦åœ¨ <code>root</code> æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»º <code>testbreak</code> ç›®å½•ï¼Œå¹¶åœ¨ <code>testbreak</code> ç›®å½•ä¸‹åˆ›å»º <code>index.html</code> æ–‡ä»¶ã€‚</p>
<h4 id="return"><a href="#return" class="headerlink" title="return"></a>return</h4><p>ä½¿ç”¨ <code>return</code> æŒ‡ä»¤å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>return code [text];</code> <code>return code URL;</code> <code>return URL;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code>, <code>location</code>, <code>if</code></td>
</tr>
</tbody></table>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>code</code>ï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„ HTTP å“åº”çŠ¶æ€ç </li>
<li><code>text</code>ï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å†…å®¹ï¼Œå¯ä»¥æ˜¯å˜é‡</li>
<li><code>URL</code>ï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„ URL åœ°å€</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>testreturn<span class="token operator">/</span>graph<span class="token punctuation">.</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>testreturn <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> application<span class="token operator">/</span>json<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'&#123;id:1,name:stone&#125;'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>testreturn <span class="token punctuation">&#123;</span>
    <span class="token comment">#return https://www.baidu.com;</span>
    <span class="token keyword">return</span> <span class="token number">302</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h4><p>ä½¿ç”¨ <code>rewrite</code> æŒ‡ä»¤ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é‡å†™è¯·æ±‚ URIã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>rewrite regex replacement [flag];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code>, <code>location</code>, <code>if</code></td>
</tr>
</tbody></table>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>regex</code>ï¼šåŒ¹é… URI çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>
<li><code>replacement</code>ï¼šç”¨äºæ›¿æ¢åŒ¹é…æˆåŠŸçš„ URIã€‚å¦‚æœä»¥ <code>http://</code>ï¼Œ<code>https://</code> æˆ–è€… <code>$scheme</code> å¼€å¤´ï¼Œåˆ™ç›´æ¥è¿”å›é‡å†™åçš„ URI ç»™å®¢æˆ·ç«¯ã€‚</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span>url\w<span class="token operator">*</span>$ <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">location</span> <span class="token operator">/</span>test <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> test_success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">location</span> <span class="token operator">/</span>demo <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> demo_success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p><code>flag</code>ï¼šå¤„ç†è¡Œä¸ºæ ‡å¿—ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>last</code>ï¼šé‡å†™å®Œæˆåç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„ <code>location</code> URI è§„åˆ™ã€‚</li>
</ul>
</li>
</ul>
  <pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> last<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> last<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">location</span> <span class="token operator">/</span>test <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> test_success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">location</span> <span class="token operator">/</span>demo <span class="token punctuation">&#123;</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> demo_success<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>break</code>ï¼šé‡å†™å®Œæˆåç»ˆæ­¢ï¼Œåœ¨å½“å‰ <code>location&#123;&#125;</code> ä¸­æŸ¥æ‰¾é‡å†™åçš„ URI ã€‚</li>
</ul>
  <pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token comment">#å¦‚æœè®¿é—® URI ä¸º /rewrite/testabcï¼Œåˆ™ä¼šè¢«é‡å†™ä¸º /testï¼Œåˆ™ä¼šæŸ¥æ‰¾æ–‡ä»¶ /usr/share/nginx/html/test/index.html</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>redirect</code>ï¼šè¿”å› 302 ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºä¸ºé‡å®šå‘çš„åœ°å€ã€‚ç”¨äº <code>replacement</code> ä¸ä»¥ <code>http://</code>ï¼Œ<code>https://</code> æˆ–è€… <code>$scheme</code> å¼€å¤´ã€‚</li>
</ul>
  <pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> redirect<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> redirect<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>permanent</code>ï¼šè¿”å› 301 æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºä¸ºé‡å®šå‘çš„åœ°å€ã€‚ç”¨äº <code>replacement</code> ä¸ä»¥ <code>http://</code>ï¼Œ<code>https://</code> æˆ–è€… <code>$scheme</code> å¼€å¤´ã€‚é»˜è®¤å€¼ã€‚</li>
</ul>
  <pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> permanent<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯¹äº <code>break</code> å’Œ <code>last</code>ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“ <code>rewrite</code> åœ¨ <code>location&#123;&#125;</code> å¤–æ—¶ï¼Œé‡åˆ° <code>break</code> æˆ– <code>last</code> åï¼Œå…¶åç»­çš„ <code>rewrite</code> æŒ‡ä»¤ä¸å†æ‰§è¡Œã€‚ä½†å¦‚æœåç»­æœ‰åŒ¹é…çš„ <code>location&#123;&#125;</code> çš„è¯ï¼Œè¿˜ä¼šæ‰§è¡Œ <code>location&#123;&#125;</code> é‡Œé¢çš„æŒ‡ä»¤ã€‚</li>
<li>å½“ <code>rewrite</code> åœ¨ <code>location&#123;&#125;</code> é‡Œæ—¶ï¼Œé‡åˆ° <code>break</code> åï¼Œæœ¬ <code>location&#123;&#125;</code> ä¸å…¶ä»– <code>location&#123;&#125;</code> çš„æ‰€æœ‰ <code>rewrite</code> æŒ‡ä»¤éƒ½ä¸å†æ‰§è¡Œã€‚</li>
<li>å½“ <code>rewrite</code> åœ¨ <code>location&#123;&#125;</code> é‡Œæ—¶ï¼Œé‡åˆ° <code>last</code> åï¼Œæœ¬ <code>location&#123;&#125;</code> çš„ <code>rewrite</code> æŒ‡ä»¤éƒ½ä¸å†æ‰§è¡Œï¼Œä½†é‡å†™åçš„ URL å†æ¬¡ä»å¤´å¼€å§‹åŒ¹é…å„ä¸ª <code>location&#123;&#125;</code> ï¼Œå“ªä¸ªåŒ¹é…æ‰§è¡Œå“ªä¸ªã€‚</li>
</ul>
<h5 id="åŸŸåè·³è½¬"><a href="#åŸŸåè·³è½¬" class="headerlink" title="åŸŸåè·³è½¬"></a>åŸŸåè·³è½¬</h5><p>åœ¨æœåŠ¡å™¨é…ç½®å¦‚ä¸‹åŸŸåè§£æï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token number">192.168</span>.92.128   stone
<span class="token number">192.168</span>.92.128   www.stonecoding.net
<span class="token number">192.168</span>.92.128   www.stonecoding.com
<span class="token number">192.168</span>.92.128   www.stonecoding.cn
<span class="token number">192.168</span>.92.128   www.stonecoding.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¢åŠ é…ç½®æ–‡ä»¶ <code>/etc/nginx/conf.d/stonecoding.conf </code>ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">'Welcome to stonecoding'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ£€æµ‹é…ç½®æ–‡ä»¶å¹¶é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®æµ‹è¯•:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl www.stonecoding.net</span>
Welcome to stonecoding<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨ <code>rewrite</code> å°†è®¿é—® <a target="_blank" rel="noopener" href="http://www.stonecoding.com/">www.stonecoding.comopen in new window</a> è¯·æ±‚è·³è½¬åˆ° <a target="_blank" rel="noopener" href="https://stonecoding.net/">https://stonecoding.netopen in new window</a></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
	<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®æµ‹è¯•ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl -L www.stonecoding.com</span>
Welcome to stonecoding<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨ <code>rewrite</code> å¤šä¸ªåŸŸåè·³è½¬ï¼Œå¹¶åœ¨è·³è½¬æ—¶æºå¸¦è¯·æ±‚çš„ URI</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>cn www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>org<span class="token punctuation">;</span>
	<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>stonecoding<span class="token punctuation">.</span>net$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®æµ‹è¯•ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl -L www.stonecoding.cn</span>
Welcome to stonecoding
<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl -L www.stonecoding.org</span>
Welcome to stonecoding
<span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl -L www.stonecoding.org/abc</span>
Welcome to stonecoding<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„æµè§ˆå™¨è®¿é—®ï¼Œåˆ™ä¼šå‘ç°åœ°å€å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<h5 id="åŸŸåé•œåƒ"><a href="#åŸŸåé•œåƒ" class="headerlink" title="åŸŸåé•œåƒ"></a>åŸŸåé•œåƒ</h5><p>ä½¿ç”¨ <code>rewrite</code> ä¸ºå­ç›®å½•ä¸‹çš„èµ„æºè¿›è¡ŒåŸŸåè·³è½¬ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>cn www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>org<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">user</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net$<span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®¿é—®æµ‹è¯•ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@stone ~<span class="token punctuation">]</span><span class="token comment"># curl -L www.stonecoding.org/user/abc</span>
Welcome to stonecoding<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="ç‹¬ç«‹åŸŸå"><a href="#ç‹¬ç«‹åŸŸå" class="headerlink" title="ç‹¬ç«‹åŸŸå"></a>ç‹¬ç«‹åŸŸå</h5><p>ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™æœ‰æœç´¢æ¨¡å—ã€è¯¦æƒ…æ¨¡å—ã€è´­ç‰©è½¦æ¨¡å—ç­‰ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹çš„åŸŸåã€‚</p>
<p>éœ€æ±‚ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">http:&#x2F;&#x2F;search.stonecoding.net:81  è®¿é—®å•†å“æœç´¢æ¨¡å—
http:&#x2F;&#x2F;item.stonecoding.net:82	  è®¿é—®å•†å“è¯¦æƒ…æ¨¡å—
http:&#x2F;&#x2F;cart.stonecoding.net:83	  è®¿é—®å•†å“è´­ç‰©è½¦æ¨¡å—<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">81</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> search<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
	<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token operator">/</span>search$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">82</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> item<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
	<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token operator">/</span>item$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">83</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> cart<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
	<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token operator">/</span>cart$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="åˆå¹¶ç›®å½•"><a href="#åˆå¹¶ç›®å½•" class="headerlink" title="åˆå¹¶ç›®å½•"></a>åˆå¹¶ç›®å½•</h5><p>å‡è®¾ç½‘ç«™ä¸­æœ‰ä¸€ä¸ªèµ„æºæ–‡ä»¶çš„è®¿é—®è·¯å¾„ä¸º <code>/server/11/22/33/44/20.html</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶å­˜åœ¨äºç¬¬ 5 çº§ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®è¯¥èµ„æºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„URLåœ°å€å°±è¦å†™æˆ <code>http://www.web.name/server/11/22/33/44/20.html</code>,</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">root</span> html<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ ·çš„åœ°å€æ˜¯éå¸¸ä¸åˆ©äº SEO æœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸å¥½è®°ã€‚ä½¿ç”¨ <code>rewrite</code> è¿›è¡Œå¦‚ä¸‹é…ç½®:</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">server</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">.</span>html$ <span class="token operator">/</span><span class="token keyword">server</span><span class="token operator">/</span>$<span class="token number">1</span><span class="token operator">/</span>$<span class="token number">2</span><span class="token operator">/</span>$<span class="token number">3</span><span class="token operator">/</span>$<span class="token number">4</span><span class="token operator">/</span>$<span class="token number">5.</span>html last<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¤æ—¶å®¢æˆ·ç«¯åªéœ€è¦è¾“å…¥ <code>http://www.web.name/server-11-22-33-44-20.html</code> å°±å¯ä»¥è®¿é—®åˆ°é¡µé¢äº†ã€‚</p>
<h5 id="é˜²ç›—é“¾-1"><a href="#é˜²ç›—é“¾-1" class="headerlink" title="é˜²ç›—é“¾"></a>é˜²ç›—é“¾</h5><p>ä½¿ç”¨ <code>rewrite</code> å¯ä»¥å°†ç›—é“¾è¯·æ±‚è½¬å‘åˆ°è‡ªå®šä¹‰çš„ä¸€å¼ å›¾ç‰‡å’Œé¡µé¢ï¼Œç»™ç”¨æˆ·æ¯”è¾ƒå¥½çš„æç¤ºä¿¡æ¯ã€‚</p>
<p>æ ¹æ®æ–‡ä»¶ç±»å‹å®ç°é˜²ç›—é“¾ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
	locatin <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">+</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>swf<span class="token operator">|</span><span class="token keyword">flv</span><span class="token operator">|</span>rar<span class="token operator">|</span>zip<span class="token punctuation">)</span>$<span class="token punctuation">&#123;</span>
		<span class="token keyword">valid_referers</span> none blocked server_names <span class="token operator">*</span><span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token operator">/</span>images<span class="token operator">/</span>forbidden<span class="token punctuation">.</span>png<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ ¹æ®ç›®å½•å®ç°é˜²ç›—é“¾ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span>file<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">root</span> <span class="token operator">/</span><span class="token keyword">server</span><span class="token operator">/</span>file<span class="token operator">/</span><span class="token punctuation">;</span>
		<span class="token keyword">valid_referers</span> none blocked server_names <span class="token operator">*</span><span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>web<span class="token punctuation">.</span>com<span class="token operator">/</span>images<span class="token operator">/</span>forbidden<span class="token punctuation">.</span>png<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="è·³è½¬é¦–é¡µ"><a href="#è·³è½¬é¦–é¡µ" class="headerlink" title="è·³è½¬é¦–é¡µ"></a>è·³è½¬é¦–é¡µ</h5><p>ä½¿ç”¨ <code>rewrite</code> å°† 404 è·³è½¬åˆ°é¦–é¡µã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">root</span>   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
        <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	
	<span class="token keyword">error_page</span> <span class="token number">404</span> @jump_to_index<span class="token punctuation">;</span>

    <span class="token keyword">location</span> @jump_to_index <span class="token punctuation">&#123;</span>
        <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">*</span>$ <span class="token operator">/</span> permanent<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="rewrite-log"><a href="#rewrite-log" class="headerlink" title="rewrite_log"></a>rewrite_log</h4><p>ä½¿ç”¨ <code>rewrite_log</code> æŒ‡ä»¤æŒ‡å®šæ˜¯å¦å°†é‡å†™ç›¸å…³æ—¥å¿—ä»¥ <code>notice</code> çº§åˆ«å†™å…¥åˆ° <code>error_log</code> æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p>
<p>| Syntax:  | <code>rewrite_log on</code> | <code>off;</code>          |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>rewrite_log off;</code>                 |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>, <code>if</code> |</p>
<p>å¦‚æœè¦åœ¨ <code>error_log</code> æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­çœ‹åˆ°é‡å†™æ—¥å¿—ï¼Œç¡®ä¿ <code>error_log</code> çš„æ—¥å¿—çº§åˆ«ä¸º <code>notice</code>ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">rewrite</span> <span class="token punctuation">&#123;</span>
    rewrite_log on<span class="token punctuation">;</span>
    <span class="token keyword">error_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log notice<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> permanent<span class="token punctuation">;</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token keyword">rewrite</span><span class="token operator">/</span><span class="token punctuation">(</span>demo<span class="token punctuation">)</span>\w<span class="token operator">*</span>$ $<span class="token number">1</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h3><p>åå‘ä»£ç†æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—äº’è”ç½‘ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™äº’è”ç½‘ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ã€‚å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œåå‘ä»£ç†æœåŠ¡å™¨å°±ç›¸å½“äºç›®æ ‡æœåŠ¡å™¨ï¼Œå³ç›´æ¥è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨å°±å¯ä»¥è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºã€‚è¿™ç§æœºåˆ¶ä½¿å¾—ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç›®æ ‡æœåŠ¡å™¨çš„åœ°å€ï¼Œä¹Ÿæ— é¡»åœ¨ç”¨æˆ·ç«¯åšä»»ä½•è®¾å®šã€‚</p>
<p><img src="https://minio.stonecoding.net/picgo/202309181015821.png" alt="image-20230918101558657" loading="lazy"></p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">ngx_http_proxy_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç°åå‘ä»£ç†ã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>app<span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>Ip <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>
    <span class="token keyword">proxy_buffering</span> on<span class="token punctuation">;</span>
    <span class="token keyword">proxy_buffer_size</span> <span class="token number">4</span> <span class="token number">32</span>k<span class="token punctuation">;</span>
    <span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">64</span>k<span class="token punctuation">;</span>
    <span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64</span>k<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h4><p>ä½¿ç”¨ <code>proxy_pass</code> æŒ‡ä»¤æŒ‡å®šæœåŠ¡ç«¯åœ°å€ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_pass URL;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>location</code>, <code>if in location</code>, <code>limit_except</code></td>
</tr>
</tbody></table>
<p>å®‰è£…é…ç½®ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œåˆ†åˆ«ä¸ºä»£ç†ç«¯å’ŒæœåŠ¡ç«¯ï¼š</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>HostName</th>
<th>IP</th>
<th>Role</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>proxy</td>
<td>192.168.92.128</td>
<td>Proxy</td>
</tr>
<tr>
<td>2</td>
<td>server</td>
<td>192.168.92.128</td>
<td>Server</td>
</tr>
</tbody></table>
<p>åœ¨ä»£ç†ç«¯å’ŒæœåŠ¡ç«¯éƒ½å®‰è£… Nginxã€‚</p>
<p>ä¿®æ”¹ä»£ç†ç«¯ <code>/usr/share/nginx/html/index.html</code> æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># mv /usr/share/nginx/html/index.html /usr/share/nginx/html/index.html.bak</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># echo "I am proxy" > /usr/share/nginx/html/index.html</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># curl 192.168.92.128</span>
I am proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹æœåŠ¡ç«¯ <code>/usr/share/nginx/html/index.html</code> æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># mv /usr/share/nginx/html/index.html /usr/share/nginx/html/index.html.bak</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># echo "I am server" > /usr/share/nginx/html/index.html</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># curl 192.168.92.129</span>
I am server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ä»£ç†ç«¯å¢åŠ é…ç½® <code>/etc/nginx/conf.d/proxy.conf</code>ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">proxy</span><span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»£ç†ç«¯é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åè®¿é—®ä»£ç†ç«¯ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># curl proxy</span>
I am server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å·²ç»å°†è¯·æ±‚è½¬å‘ç»™äº†æœåŠ¡ç«¯ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li><p>å¦‚æœ <code>location</code> æŒ‡ä»¤æŒ‡å®šçš„ URI ä¸º <code>/</code>ï¼Œåˆ™ <code>proxy_pass</code> æŒ‡ä»¤æŒ‡å®šçš„ URL æœ€ååŠ ä¸åŠ  <code>/</code>ï¼Œæ•ˆæœä¸€æ ·ã€‚</p>
</li>
<li><p>å¦‚æœ</p>
</li>
</ul>
  <pre class="line-numbers language-none"><code class="language-none">location<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>  æŒ‡ä»¤æŒ‡å®šçš„ URI ä¸ä¸º</p>
  <pre class="line-numbers language-none"><code class="language-none">&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  ï¼Œä¾‹å¦‚</p>
  <pre class="line-numbers language-none"><code class="language-none">&#x2F;server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>  ï¼š</p>
<ul>
<li><code>proxy_pass</code> æŒ‡ä»¤æŒ‡å®šçš„ URL æœ€åä¸åŠ  <code>/</code>ï¼Œä¾‹å¦‚ <code>http://192.168.92.129</code>ï¼Œåˆ™è¯·æ±‚å°†ä¼šè¢«è½¬å‘åˆ° URL/URIï¼Œå³ <code>http://192.168.92.129/server/index.html</code>ã€‚</li>
<li><code>proxy_pass</code> æŒ‡ä»¤æŒ‡å®šçš„ URL æœ€ååŠ ä¸Š <code>/</code>ï¼Œä¾‹å¦‚ <code>http://192.168.92.129/</code>ï¼Œåˆ™è¯·æ±‚å°†ä¼šè¢«è½¬å‘åˆ° URLï¼Œå³ <code>http://192.168.92.129/index.html</code>ã€‚</li>
</ul>
<h4 id="proxy-set-header"><a href="#proxy-set-header" class="headerlink" title="proxy_set_header"></a>proxy_set_header</h4><p>ä½¿ç”¨ <code>proxy_set_header</code> æŒ‡ä»¤åœ¨ä»£ç†ç«¯è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå†å‘ç»™æœåŠ¡ç«¯ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_set_header field value;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_set_header Host $proxy_host;</code> <code>proxy_set_header Connection close;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>åœ¨ä»£ç†ç«¯å¢åŠ é…ç½® <code>/etc/nginx/conf.d/proxy.conf</code> å¹¶é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">proxy</span><span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>    
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> username STONE<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨æœåŠ¡ç«¯å¢åŠ é…ç½® <code>/etc/nginx/conf.d/server.conf</code> å¹¶é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span>  <span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">server</span><span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">200</span> <span class="token variable">$http_username</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åè®¿é—®ä»£ç†ç«¯ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># curl proxy/server</span>
STONE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="proxy-redirect"><a href="#proxy-redirect" class="headerlink" title="proxy_redirect"></a>proxy_redirect</h4><p>ä½¿ç”¨ <code>proxy_redirect</code> æŒ‡ä»¤é‡ç½®å“åº”å¤´ä¿¡æ¯ä¸­çš„ <code>Location</code> å’Œ <code>Refresh</code> çš„å€¼ï¼Œå³å¯¹å‘é€ç»™å®¢æˆ·ç«¯çš„ URL è¿›è¡Œä¿®æ”¹ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_redirect default;</code> <code>proxy_redirect off;</code> <code>proxy_redirect redirect replacement;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_redirect default;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>å…¶ä¸­ <code>default</code> è¡¨ç¤ºå°† <code>proxy_pass</code> å˜é‡ä½œä¸º <code>redirect</code>ï¼Œå°† <code>location</code> çš„ URI ä½œä¸º <code>replacement</code>ã€‚ä¾‹å¦‚ä»¥ä¸‹ä¸¤ä¸ªé…ç½®ç­‰ä»·ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>one<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">proxy_pass</span>     <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">upstream</span><span class="token punctuation">:</span>port<span class="token operator">/</span>two<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_redirect</span> default<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>one<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">proxy_pass</span>     <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">upstream</span><span class="token punctuation">:</span>port<span class="token operator">/</span>two<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_redirect</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">upstream</span><span class="token punctuation">:</span>port<span class="token operator">/</span>two<span class="token operator">/</span> <span class="token operator">/</span>one<span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>redirect</code> å’Œ <code>replacement</code> å¯ä»¥ä½¿ç”¨å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_redirect</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token punctuation">:</span><span class="token variable">$server_port</span><span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_redirect</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$proxy_host</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span> <span class="token operator">/</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>redirect</code> å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œ<code>replacement</code> å¯ä»¥å¼•ç”¨ ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_redirect</span> <span class="token operator">~</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\d<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token punctuation">)</span>$ $<span class="token number">1</span>$<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_redirect</span> <span class="token operator">~</span><span class="token operator">*</span><span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token punctuation">)</span>$      <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>$<span class="token number">1.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>$<span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="proxy-buffering"><a href="#proxy-buffering" class="headerlink" title="proxy_buffering"></a>proxy_buffering</h4><p>ä½¿ç”¨ <code>proxy_buffering</code> æŒ‡ä»¤å¼€å¯æˆ–å…³é—­ä»£ç†ç«¯ç¼“å†²ã€‚</p>
<p>| Syntax:  | <code>proxy_buffering on</code> | <code>off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>proxy_buffering on;</code>         |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>  |</p>
<p>å¼€å¯ç¼“å†²åï¼ŒNginx æ¥æ”¶æœåŠ¡ç«¯å“åº”ï¼Œå¹¶ä¿å­˜åˆ°ç”±æŒ‡ä»¤ <code>proxy_buffer_size</code> å’Œ <code>proxy_buffers</code> è®¾ç½®çš„ç¼“å†²åŒºã€‚</p>
<h4 id="proxy-buffer-size"><a href="#proxy-buffer-size" class="headerlink" title="proxy_buffer_size"></a>proxy_buffer_size</h4><p>ä½¿ç”¨ <code>proxy_buffer_size</code> æŒ‡ä»¤è®¾ç½®ä»æœåŠ¡ç«¯è·å–çš„ç¬¬ä¸€éƒ¨åˆ†å“åº”æ•°æ®çš„å¤§å°ï¼Œé»˜è®¤ä¸ºä¸€ä¸ªå†…å­˜é¡µå¤§å°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_buffer_size size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_buffer_size 4k</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-buffers"><a href="#proxy-buffers" class="headerlink" title="proxy_buffers"></a>proxy_buffers</h4><p>ä½¿ç”¨ <code>proxy_buffers</code> æŒ‡ä»¤æŒ‡å®šç”¨äºå•ä¸ªè¿æ¥è¯»å–æœåŠ¡ç«¯å“åº”çš„ç¼“å­˜åŒºä¸ªæ•°å’Œå¤§å°ï¼Œå•ä¸ªå¤§å°é»˜è®¤ä¸ºä¸€ä¸ªå†…å­˜é¡µã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_buffers number size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_buffers 8 4k</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-busy-buffers-size"><a href="#proxy-busy-buffers-size" class="headerlink" title="proxy_busy_buffers_size"></a>proxy_busy_buffers_size</h4><p>ä½¿ç”¨ <code>proxy_busy_buffers_size</code> æŒ‡ä»¤é™åˆ¶åŒæ—¶å¤„äº BUSY çŠ¶æ€çš„ç¼“å†²æ€»å¤§å°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_busy_buffers_size size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_busy_buffers_size 8k</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-temp-path"><a href="#proxy-temp-path" class="headerlink" title="proxy_temp_path"></a>proxy_temp_path</h4><p>ä½¿ç”¨ <code>proxy_temp_path</code> æŒ‡ä»¤æŒ‡å®šå½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œå­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_temp_path path [level1 [level2 [level3]]];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_temp_path proxy_temp;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-temp-file-write-size"><a href="#proxy-temp-file-write-size" class="headerlink" title="proxy_temp_file_write_size"></a>proxy_temp_file_write_size</h4><p>ä½¿ç”¨ <code>proxy_temp_file_write_size</code> æŒ‡ä»¤é™åˆ¶ä¸€æ¬¡å†™å…¥ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®å¤§å°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_temp_file_write_size size;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_temp_file_write_size 8k</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h3 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html">ngx_http_ssl_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤æä¾› HTTPS æ”¯æŒã€‚</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span>              <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>
    <span class="token keyword">keepalive_timeout</span>   <span class="token number">70</span><span class="token punctuation">;</span>

    <span class="token keyword">ssl_protocols</span>       TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span> TLSv1<span class="token punctuation">.</span><span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">ssl_ciphers</span>         AES128<span class="token operator">-</span>SHA<span class="token punctuation">:</span>AES256<span class="token operator">-</span>SHA<span class="token punctuation">:</span>RC4<span class="token operator">-</span>SHA<span class="token punctuation">:</span>DES<span class="token operator">-</span>CBC3<span class="token operator">-</span>SHA<span class="token punctuation">:</span>RC4<span class="token operator">-</span>MD5<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate</span>     <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>cert<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>cert<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
    <span class="token keyword">ssl_session_cache</span>   shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">10</span>m<span class="token punctuation">;</span>
    <span class="token keyword">ssl_session_timeout</span> <span class="token number">10</span>m<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h4><p>ä½¿ç”¨ <code>ssl</code> æŒ‡ä»¤å¼€å¯ HTTPSã€‚</p>
<p>| Syntax:  | <code>ssl on</code> | <code>off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>ssl off;</code>        |<br>| Context: | <code>http</code>, <code>server</code>  |</p>
<p>è¯¥æŒ‡ä»¤å°†åœ¨ 1.25.1 ç‰ˆæœ¬è¢«ç§»é™¤ï¼Œä½¿ç”¨ <code>listen 443 ssl;</code> æ›¿ä»£ã€‚</p>
<h4 id="ssl-certificate"><a href="#ssl-certificate" class="headerlink" title="ssl_certificate"></a>ssl_certificate</h4><p>ä½¿ç”¨ <code>ssl_certificate</code> æŒ‡ä»¤æŒ‡å®š PEM æ ¼å¼çš„è¯ä¹¦æ–‡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>ssl_certificate file;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code></td>
</tr>
</tbody></table>
<h4 id="ssl-certificate-key"><a href="#ssl-certificate-key" class="headerlink" title="ssl_certificate_key"></a>ssl_certificate_key</h4><p>ä½¿ç”¨ <code>ssl_certificate_key</code> æŒ‡ä»¤æŒ‡å®š PEM æ ¼å¼çš„å¯†é’¥æ–‡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>ssl_certificate_key file;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code></td>
</tr>
</tbody></table>
<h4 id="ssl-session-cache"><a href="#ssl-session-cache" class="headerlink" title="ssl_session_cache"></a>ssl_session_cache</h4><p>ä½¿ç”¨ <code>ssl_session_cache</code> æŒ‡ä»¤æŒ‡å®šç”¨äº SSL çš„ä¼šè¯ç¼“å­˜ã€‚</p>
<p>| Syntax:  | <code>ssl_session_cache off</code> | <code>none</code> | <code>[builtin[:size]] [shared:name:size];</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | <code>ssl_session_cache none;</code>                                    |<br>| Context: | <code>http</code>, <code>server</code>                                             |</p>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>off</code>ï¼šç¦ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯ä¸å¾—é‡å¤ä½¿ç”¨ä¼šè¯ã€‚</li>
<li><code>none</code>ï¼šç¦æ­¢ä½¿ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¼šè¯å‚æ•°ã€‚</li>
<li><code>builtin</code>ï¼šå†…ç½® OpenSSL ç¼“å­˜ï¼Œä»…åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­ä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>size</code>ï¼Œåˆ™ä¸º 20480 ä¸ªä¼šè¯ï¼Œä½¿ç”¨è¯¥ç±»å‹ä¼šè¯ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡ã€‚</li>
<li><code>shared</code>ï¼šæ‰€æœ‰å·¥ä½œè¿›ç¨‹å…±äº«ç¼“å­˜ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®š <code>size</code>ï¼Œ1 MBå¯ä»¥å­˜å‚¨ 4000 ä¼šè¯ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">ssl_session_cache</span> shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">10</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="ssl-session-timeout"><a href="#ssl-session-timeout" class="headerlink" title="ssl_session_timeout"></a>ssl_session_timeout</h4><p>ä½¿ç”¨ <code>ssl_session_timeout</code> æŒ‡ä»¤æŒ‡å®šå®¢æˆ·ç«¯èƒ½å¤Ÿé‡å¤ä½¿ç”¨å‚¨å­˜åœ¨ç¼“å­˜ä¸­çš„ä¼šè¯å‚æ•°çš„è¶…æ—¶æ—¶é—´ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>ssl_session_timeout time;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>ssl_session_timeout 5m;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code></td>
</tr>
</tbody></table>
<h4 id="ssl-ciphers"><a href="#ssl-ciphers" class="headerlink" title="ssl_ciphers"></a>ssl_ciphers</h4><p>ä½¿ç”¨ <code>ssl_ciphers</code> æŒ‡ä»¤æŒ‡å®š OpenSSL æ”¯æŒçš„åŠ å¯†ç®—æ³•ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>ssl_ciphers ciphers;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>ssl_ciphers HIGH:!aNULL:!MD5;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code></td>
</tr>
</tbody></table>
<h4 id="ssl-prefer-server-ciphers"><a href="#ssl-prefer-server-ciphers" class="headerlink" title="ssl_prefer_server_ciphers"></a>ssl_prefer_server_ciphers</h4><p>ä½¿ç”¨ <code>ssl_prefer_server_ciphers</code> æŒ‡ä»¤æŒ‡å®šæ˜¯å¦æœåŠ¡å™¨å¯†ç ä¼˜å…ˆå®¢æˆ·ç«¯å¯†ç ã€‚</p>
<p>| Syntax:  | <code>ssl_prefer_server_ciphers on</code> | <code>off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | <code>ssl_prefer_server_ciphers off;</code>        |<br>| Context: | <code>http</code>, <code>server</code>                        |</p>
<h4 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h4><p>å®‰è£… OpenSSL å¹¶ç”Ÿæˆè¯ä¹¦ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># yum install openssl</span>

<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># openssl version</span>
OpenSSL <span class="token number">1.0</span>.2k-fips  <span class="token number">26</span> Jan <span class="token number">2017</span>

<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out proxy-privkey.pem 2048</span>
Generating RSA private key, <span class="token number">2048</span> bit long modulus
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++
e is <span class="token number">65537</span> <span class="token punctuation">(</span>0x10001<span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># openssl req -new -key proxy-privkey.pem -out proxy-cert.csr</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class="token string">'.'</span>, the field will be left blank.
-----
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>XX<span class="token punctuation">]</span>:cn
State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:cq
Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default City<span class="token punctuation">]</span>:bb
Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default Company Ltd<span class="token punctuation">]</span>:stone 
Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:it
Common Name <span class="token punctuation">(</span>eg, your name or your server<span class="token string">'s hostname) []:proxy.stonecoding.net
Email Address []:stone@stonecoding.net

Please enter the following '</span>extra<span class="token string">' attributes
to be sent with your certificate request
A challenge password []:123456
An optional company name []:stone

[root@proxy ~]# openssl req -new -x509 -key proxy-privkey.pem -out proxy-cacert.pem -days 109500
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '</span><span class="token builtin class-name">.</span><span class="token string">', the field will be left blank.
-----
Country Name (2 letter code) [XX]:cn
State or Province Name (full name) []:cq
Locality Name (eg, city) [Default City]:bb
Organization Name (eg, company) [Default Company Ltd]:stone
Organizational Unit Name (eg, section) []:it
Common Name (eg, your name or your server'</span>s <span class="token function">hostname</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:proxy.stonecoding.net
Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:stone@stonecoding.net

<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># ll proxy-*</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1383</span> Sep <span class="token number">18</span> <span class="token number">16</span>:52 proxy-cacert.pem
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1094</span> Sep <span class="token number">18</span> <span class="token number">16</span>:52 proxy-cert.csr
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1679</span> Sep <span class="token number">18</span> <span class="token number">16</span>:51 proxy-privkey.pem
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># cp proxy-privkey.pem /etc/nginx/proxy-privkey.pem</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># cp proxy-cacert.pem /etc/nginx/proxy-cert.pem</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨ç”Ÿæˆçš„è¯ä¹¦ä¸ºé…ç½®æ–‡ä»¶ <code>/etc/nginx/conf.d/proxy.conf</code> å¢åŠ  SSLï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">proxy</span><span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate</span> <span class="token keyword">proxy</span><span class="token operator">-</span>cert<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> <span class="token keyword">proxy</span><span class="token operator">-</span>privkey<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_session_timeout</span> <span class="token number">5</span>m<span class="token punctuation">;</span>
    <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">ssl_ciphers</span> ECDHE<span class="token operator">-</span>RSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">:</span><span class="token operator">!</span>RC4<span class="token punctuation">:</span><span class="token operator">!</span>DHE<span class="token punctuation">;</span>
    <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>    
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> username STONE<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®¢æˆ·ç«¯é…ç½®åŸŸåè§£æåä½¿ç”¨æµè§ˆå™¨è®¿é—® HTTPSï¼š</p>
<p><img src="https://minio.stonecoding.net/picgo/202309181709255.png" alt="image-20230918170910096" loading="lazy"></p>
<p>ç”±äºæ˜¯è‡ªç­¾å‘çš„è¯ä¹¦ï¼Œæ•…åœ°å€æ å¤„ä¼šæœ‰å®‰å…¨è­¦å‘Šã€‚å¯ä»¥åœ¨é˜¿é‡Œäº‘æˆ–å…¶ä»–æœºæ„ç”³è¯·ç»è¿‡ç¬¬ä¸‰æ–¹ç­¾å‘è¯ä¹¦ã€‚</p>
<p>ä½¿ç”¨ <code>rewrite</code> å°†è®¿é—® HTTP çš„æµé‡é‡å®šå‘åˆ° HTTPSï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">proxy</span><span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token keyword">proxy</span><span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net$<span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token keyword">proxy</span><span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate</span> <span class="token keyword">proxy</span><span class="token operator">-</span>cert<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> <span class="token keyword">proxy</span><span class="token operator">-</span>privkey<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_session_timeout</span> <span class="token number">5</span>m<span class="token punctuation">;</span>
    <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">ssl_ciphers</span> ECDHE<span class="token operator">-</span>RSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">:</span><span class="token operator">!</span>RC4<span class="token punctuation">:</span><span class="token operator">!</span>DHE<span class="token punctuation">;</span>
    <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> username STONE<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‡è½½é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># nginx -s reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®¢æˆ·ç«¯ä½¿ç”¨æµè§ˆå™¨è®¿é—® HTTP æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ° HTTPSã€‚</p>
<h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">ngx_http_proxy_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç° Nginx ç¼“å­˜ã€‚</p>
<h4 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h4><p>ä½¿ç”¨ <code>proxy_cache_path</code> æŒ‡ä»¤è®¾ç½®ç¼“å­˜ç›®å½•åŠå…¶ä»–å‚æ•°ã€‚</p>
<p>| Syntax:  | <code>proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [min_free=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | â€”                                                            |<br>| Context: | <code>http</code>                                                       |</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>path</code>ï¼šæŒ‡å®šç¼“å­˜ç›®å½•ã€‚ä¾‹å¦‚ï¼š<code>/data/nginx/cache</code></li>
<li><code>levels</code>ï¼šæŒ‡å®šç¼“å­˜ç›®å½•ä¸‹çš„ç›®å½•å±‚çº§åŠç›®å½•åç§°é•¿åº¦ã€‚ä¾‹å¦‚ï¼š<code>levels=1:2</code>ï¼Œè¡¨ç¤ºç›®å½•å±‚çº§ä¸º 2 å±‚ï¼Œç¬¬ä¸€å±‚çš„ç›®å½•åç§°ä¸ºç¼“å­˜æ–‡ä»¶åçš„æœ€å 1 ä¸ªå­—ç¬¦ï¼Œç¬¬äºŒå±‚çš„ç›®å½•åç§°ä¸ºç¼“å­˜æ–‡ä»¶åå€’æ•°ç¬¬ 3 å’Œ ç¬¬ 2 ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c</code></li>
<li><code>keys_zone</code>ï¼šæŒ‡å®šç¼“å­˜çš„åç§°å’Œå¤§å°ã€‚ä¾‹å¦‚ï¼š<code>keys_zone=stone:200m</code></li>
<li><code>inactive</code>ï¼šæŒ‡å®šæ²¡æœ‰è¢«è®¿é—®çš„ç¼“å­˜è¾“å‡ºå¯ä»¥è¢«ä¿ç•™çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼š<code>inactive=1d</code></li>
<li><code>max_size</code>ï¼šæŒ‡å®šæœ€å¤§ç¼“å­˜å¤§å°ã€‚ä¾‹å¦‚ï¼š<code>max_size=10g</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">http</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">proxy_cache_path</span> <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>cache keys_zone<span class="token operator">=</span>stone<span class="token punctuation">:</span><span class="token number">200</span>m  levels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span> inactive<span class="token operator">=</span><span class="token number">1</span>d max_size<span class="token operator">=</span><span class="token number">10</span>g<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h4><p>ä½¿ç”¨ <code>proxy_cache</code> æŒ‡ä»¤æŒ‡å®šç”¨äºç¼“å­˜çš„ç¼“å†²åŒºã€‚</p>
<p>| Syntax:  | <code>proxy_cache zone</code> | <code>off;</code>  |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>proxy_cache off;</code>           |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code> |</p>
<p><code>proxy_cache off;</code> è¡¨ç¤ºç¦ç”¨ç¼“å­˜ã€‚</p>
<h4 id="proxy-cache-key"><a href="#proxy-cache-key" class="headerlink" title="proxy_cache_key"></a>proxy_cache_key</h4><p>ä½¿ç”¨ <code>proxy_cache_key</code> æŒ‡ä»¤æŒ‡å®šç¼“å­˜çš„é”®ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_cache_key string;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_cache_key $scheme$proxy_host$request_uri;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h4><p>ä½¿ç”¨ <code>proxy_cache_valid</code> æŒ‡ä»¤ä¸ºä¸åŒçš„å“åº”çŠ¶æ€ç è®¾ç½®ç¼“å­˜æ—¶é—´ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_cache_valid [code ...] time;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">10</span>m<span class="token punctuation">;</span>
<span class="token keyword">proxy_cache_valid</span> <span class="token number">404</span>      <span class="token number">1</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¦‚æœåªè®¾ç½®æ—¶é—´å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_cache_valid</span> <span class="token number">5</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆ™åªç¼“å­˜å“åº”çŠ¶æ€ç ä¸º 200ï¼Œ301 å’Œ 302 çš„å“åº”ã€‚</p>
<p>ä½¿ç”¨ <code>any</code> å‚æ•°ç¼“å­˜ä»»æ„çŠ¶æ€ç ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">302</span> <span class="token number">10</span>m<span class="token punctuation">;</span>
<span class="token keyword">proxy_cache_valid</span> <span class="token number">301</span>      <span class="token number">1</span>h<span class="token punctuation">;</span>
<span class="token keyword">proxy_cache_valid</span> any      <span class="token number">1</span>m<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="proxy-cache-min-uses"><a href="#proxy-cache-min-uses" class="headerlink" title="proxy_cache_min_uses"></a>proxy_cache_min_uses</h4><p>ä½¿ç”¨ <code>proxy_cache_min_uses</code> æŒ‡ä»¤è®¾ç½®å¤šå°‘æ¬¡è¯·æ±‚åå¯¹åº”çš„å“åº”æ‰ä¼šè¢«ç¼“å­˜ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_cache_min_uses number;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td><code>proxy_cache_min_uses 1;</code></td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<h4 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="headerlink" title="proxy_cache_methods"></a>proxy_cache_methods</h4><p>ä½¿ç”¨ <code>proxy_cache_methods</code> æŒ‡ä»¤è®¾ç½®ä¼šè¢«ç¼“å­˜çš„ HTTP æ–¹æ³•ã€‚</p>
<p>| Syntax:  | <code>proxy_cache_methods GET</code> | <code>HEAD</code> | <code>POST ...;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | <code>proxy_cache_methods GET HEAD;</code>                  |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>                     |</p>
<h4 id="proxy-no-cache"><a href="#proxy-no-cache" class="headerlink" title="proxy_no_cache"></a>proxy_no_cache</h4><p>ä½¿ç”¨ <code>proxy_no_cache</code> æŒ‡ä»¤å®šä¹‰ä¸ç¼“å­˜å“åº”æ•°æ®çš„æ¡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_no_cache string ...;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>å¦‚æœå¤šä¸ª <code>string</code> å‚æ•°æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¸ç­‰äº â€œ0â€ åˆ™ä¸ç¼“å­˜å“åº”æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_no_cache</span> <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span><span class="token variable">$arg_comment</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_no_cache</span> <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>$cookie_nocache</code>ï¼šå½“å‰è¯·æ±‚çš„ Cookie ä¸­é”®çš„åç§°ä¸º <code>nocache</code> å¯¹åº”çš„å€¼</li>
<li><code>$arg_nocache</code>ï¼šå½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸º <code>nocache</code> å¯¹åº”çš„å±æ€§å€¼</li>
<li><code>$arg_comment</code>ï¼šå½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸º <code>comment</code> å¯¹åº”çš„å±æ€§å€¼</li>
</ul>
<h4 id="proxy-cache-bypass"><a href="#proxy-cache-bypass" class="headerlink" title="proxy_cache_bypass"></a>proxy_cache_bypass</h4><p>ä½¿ç”¨ <code>proxy_cache_bypass</code> æŒ‡ä»¤å®šä¹‰ä¸ç¼“å­˜å“åº”æ•°æ®çš„æ¡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_cache_bypass string ...;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>
</tbody></table>
<p>å¦‚æœå¤šä¸ª <code>string</code> å‚æ•°æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¸ç­‰äº â€œ0â€ åˆ™ä¸ç¼“å­˜å“åº”æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span><span class="token variable">$arg_comment</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$http_pragma</span>    <span class="token variable">$http_authorization</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>$cookie_nocache</code>ï¼šå½“å‰è¯·æ±‚çš„ Cookie ä¸­é”®çš„åç§°ä¸º <code>nocache</code> å¯¹åº”çš„å€¼</li>
<li><code>$arg_nocache</code>ï¼šå½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸º <code>nocache</code> å¯¹åº”çš„å±æ€§å€¼</li>
<li><code>$arg_comment</code>ï¼šå½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸º <code>comment</code> å¯¹åº”çš„å±æ€§å€¼</li>
</ul>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ç¼“å­˜é…ç½®ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">http</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">proxy_cache_path</span> <span class="token operator">/</span>data<span class="token operator">/</span>nginx<span class="token operator">/</span>cache keys_zone<span class="token operator">=</span>stone<span class="token punctuation">:</span><span class="token number">200</span>m  levels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span> inactive<span class="token operator">=</span><span class="token number">1</span>d max_size<span class="token operator">=</span><span class="token number">10</span>g<span class="token punctuation">;</span>
	<span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
		<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">listen</span>       <span class="token number">8080</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
        	<span class="token keyword">proxy_cache</span> stone<span class="token punctuation">;</span>
            <span class="token keyword">proxy_cache_min_uses</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">5</span>d<span class="token punctuation">;</span>
            <span class="token keyword">proxy_cache_valid</span> <span class="token number">404</span> <span class="token number">30</span>s<span class="token punctuation">;</span>
            <span class="token keyword">proxy_cache_valid</span> any <span class="token number">1</span>m<span class="token punctuation">;</span>
            <span class="token keyword">add_header</span> nginx<span class="token operator">-</span>cache <span class="token string">"$upstream_cache_status"</span><span class="token punctuation">;</span>
        	<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token operator">/</span>js<span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸ç¼“å­˜é…ç½®ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span>	<span class="token number">8080</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">~</span> <span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span>js$<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token keyword">set</span> <span class="token variable">$nocache</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
		<span class="token keyword">proxy_no_cache</span> <span class="token variable">$nocache</span> <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span> <span class="token variable">$arg_comment</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$nocache</span> <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span> <span class="token variable">$arg_comment</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="ä¸‹è½½ç«™ç‚¹"><a href="#ä¸‹è½½ç«™ç‚¹" class="headerlink" title="ä¸‹è½½ç«™ç‚¹"></a>ä¸‹è½½ç«™ç‚¹</h3><p>ä½¿ç”¨æ¨¡å—ä¸‹çš„æŒ‡ä»¤åˆ›å»ºä¸‹è½½ç«™ç‚¹ã€‚</p>
<h4 id="autoindex"><a href="#autoindex" class="headerlink" title="autoindex"></a>autoindex</h4><p>ä½¿ç”¨ <code>autoindex</code> æŒ‡ä»¤å¯ç”¨æˆ–ç¦ç”¨ç›®å½•åˆ—è¡¨è¾“å‡ºã€‚</p>
<p>| Syntax:  | <code>autoindex on | off;</code>        |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>autoindex off;</code>             |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code> |</p>
<h4 id="autoindex-format"><a href="#autoindex-format" class="headerlink" title="autoindex_format"></a>autoindex_format</h4><p>ä½¿ç”¨ <code>autoindex_format</code> æŒ‡ä»¤è®¾ç½®ç›®å½•åˆ—è¡¨æ ¼å¼ã€‚</p>
<p>| Syntax:  | <code>autoindex_format html | xml | json | jsonp;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | <code>autoindex_format html;</code>                      |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>                  |</p>
<p>å¯¹äºä¸‹è½½ç«™ç‚¹ï¼Œéœ€è¦ä¿æŒä¸ºé»˜è®¤å€¼ï¼Œå³ï¼š<code>autoindex_format html</code>ã€‚</p>
<h4 id="autoindex-exact-size"><a href="#autoindex-exact-size" class="headerlink" title="autoindex_exact_size"></a>autoindex_exact_size</h4><p>ä½¿ç”¨ <code>autoindex_exact_size</code> æŒ‡ä»¤æŒ‡å®šæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½åœ¨ç›®å½•åˆ—è¡¨æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å°ï¼Œè¿˜æ˜¯ä»¥ KBï¼ŒMB æˆ–è€… GB ä¸ºå•ä½æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚ç”¨äº <code>autoindex_format html</code>ã€‚</p>
<p>| Syntax:  | <code>autoindex_exact_size on | off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>autoindex_exact_size on;</code>       |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>     |</p>
<h4 id="autoindex-localtime"><a href="#autoindex-localtime" class="headerlink" title="autoindex_localtime"></a>autoindex_localtime</h4><p>ä½¿ç”¨ <code>autoindex_localtime</code> æŒ‡ä»¤æŒ‡å®šæ˜¾ç¤ºçš„æ—¶é—´æ ¼å¼æ˜¯æœ¬åœ°æ—¶åŒºè¿˜æ˜¯ UTCã€‚ç”¨äº <code>autoindex_format html</code>ã€‚</p>
<p>| Syntax:  | <code>autoindex_localtime on | off;</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| Default: | <code>autoindex_localtime off;</code>      |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>    |</p>
<h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>download <span class="token punctuation">&#123;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>tmp<span class="token punctuation">;</span>
    <span class="token keyword">autoindex</span> on<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">ngx_http_auth_basic_moduleopen in new window</a> æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç°è®¤è¯ã€‚</p>
<h4 id="auth-basic"><a href="#auth-basic" class="headerlink" title="auth_basic"></a>auth_basic</h4><p>ä½¿ç”¨ <code>auth_basic</code> æŒ‡ä»¤é‡‡ç”¨ HTTP Basic Authentication åè®®å¯ç”¨ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ã€‚</p>
<p>| Syntax:  | <code>auth_basic string | off;</code>                   |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Default: | <code>auth_basic off;</code>                            |<br>| Context: | <code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code> |</p>
<p>å¼€å¯åï¼ŒæœåŠ¡ç«¯ä¼šè¿”å› 401ï¼ŒæŒ‡å®šçš„å­—ç¬¦ä¸²ä¼šè¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œç»™ç”¨æˆ·ä»¥æç¤ºä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒçš„æµè§ˆå™¨å¯¹å†…å®¹çš„å±•ç¤ºä¸ä¸€è‡´ã€‚</p>
<h4 id="auth-basic-user-file"><a href="#auth-basic-user-file" class="headerlink" title="auth_basic_user_file"></a>auth_basic_user_file</h4><p>ä½¿ç”¨ <code>auth_basic_user_file</code> æŒ‡ä»¤æŒ‡å®šç”¨æˆ·åå’Œå¯†ç æ‰€åœ¨æ–‡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>auth_basic_user_file file;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code></td>
</tr>
</tbody></table>
<p>å®‰è£… <code>httpd-tools</code> å¹¶ä½¿ç”¨ <code>htpasswd</code> å‘½ä»¤ç”Ÿæˆå¯†ç æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># yum -y install httpd-tools</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># htpasswd -c /tmp/htpasswd stone</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># cat /tmp/htpasswd </span>
stone:<span class="token variable">$apr1</span><span class="token variable">$RW9BxhaW</span><span class="token variable">$nsQY6</span>/M/DfcF1rjRh897U0
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># htpasswd -b /tmp/htpasswd tom 123456</span>
Adding password <span class="token keyword">for</span> user tom
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># cat /tmp/htpasswd </span>
stone:<span class="token variable">$apr1</span><span class="token variable">$RW9BxhaW</span><span class="token variable">$nsQY6</span>/M/DfcF1rjRh897U0
tom:<span class="token variable">$apr1</span><span class="token variable">$vdJBd3ga</span><span class="token variable">$PhBRkHdKLWGge0Qku1Bb50</span>
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># htpasswd -D /tmp/htpasswd tom</span>
Deleting password <span class="token keyword">for</span> user tom
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># cat /tmp/htpasswd </span>
stone:<span class="token variable">$apr1</span><span class="token variable">$RW9BxhaW</span><span class="token variable">$nsQY6</span>/M/DfcF1rjRh897U0
<span class="token punctuation">[</span>root@proxy ~<span class="token punctuation">]</span><span class="token comment"># htpasswd -v /tmp/htpasswd stone</span>
Enter password: 
Password <span class="token keyword">for</span> user stone correct.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">location</span> <span class="token operator">/</span>download <span class="token punctuation">&#123;</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>tmp<span class="token punctuation">;</span>
    <span class="token keyword">autoindex</span> on<span class="token punctuation">;</span>
    <span class="token keyword">auth_basic</span> <span class="token string">'please input your username and password'</span><span class="token punctuation">;</span>
    <span class="token keyword">auth_basic_user_file</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>htpasswd<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>å¯ä»¥ä½¿ç”¨ Nginx é…ç½®è´Ÿè½½å‡è¡¡ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†æ‘Šåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚</p>
<p><img src="/img/202309191313689.png" alt="202309191313689.png" loading="lazy"></p>
<p>è´Ÿè½½å‡è¡¡å¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li>ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå·¥ä½œåœ¨åº”ç”¨å±‚ï¼Œç»å¸¸ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚å¯ä»¥ä½¿ç”¨ Nginxï¼ŒHAProxy å®ç°ã€‚</li>
<li>å››å±‚è´Ÿè½½å‡è¡¡ï¼Œå·¥ä½œä¸­ä¼ è¾“å±‚ï¼Œæ˜¯åŸºäº IP å’Œç«¯å£çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥ä½¿ç”¨ LVSï¼ŒNginx å®ç°ã€‚</li>
</ul>
<h3 id="ä¸ƒå±‚"><a href="#ä¸ƒå±‚" class="headerlink" title="ä¸ƒå±‚"></a>ä¸ƒå±‚</h3><p>Nginx ä½¿ç”¨  æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡ã€‚</p>
<h4 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h4><p>ä½¿ç”¨ <code>upstream</code> æŒ‡ä»¤å®šä¹‰ä¸€ç»„åç«¯æœåŠ¡å™¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>upstream name &#123; ... &#125;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>http</code></td>
</tr>
</tbody></table>
<h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p>ä½¿ç”¨ <code>server</code> æŒ‡ä»¤åœ¨ <code>upstream</code> ä¸­å®šä¹‰åç«¯æœåŠ¡å™¨çš„åœ°å€åŠå…¶ä»–å‚æ•°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>server address [parameters];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p><code>parameters</code> åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>weight=number</code>ï¼šåç«¯æœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1ã€‚</li>
<li><code>max_conns=number</code>ï¼šåˆ°åç«¯æœåŠ¡å™¨çš„æœ€å¤§æ´»åŠ¨è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºæ— é™åˆ¶ã€‚</li>
<li><code>max_fails=number</code>ï¼šè®¾ç½®è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚</li>
<li><code>fail_timeout=time</code>ï¼šå¤±è´¥æ¬¡æ•°è¾¾åˆ° <code>max_fails</code> åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´ï¼Œé»˜è®¤ä¸º 10 ç§’ã€‚</li>
<li><code>backup</code>ï¼šæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸å¯ç”¨åå¯ç”¨ã€‚</li>
<li><code>down</code>ï¼šæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºä¸å¯ç”¨ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸ºè½®è¯¢</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸ºåŠ æƒè½®è¯¢</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span> weight<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span> weight<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span> weight<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¾‹å¦‚ï¼šä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œä¸€ä¸ªåç«¯æœåŠ¡å™¨ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œä¸€ä¸ªåç«¯æœåŠ¡å™¨å¤±è´¥æ¬¡æ•°è¾¾åˆ° 3 æ¬¡åï¼ŒæœåŠ¡æš‚åœçš„ 15 ç§’</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span> down<span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span> backup<span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span> max_fails<span class="token operator">=</span><span class="token number">3</span> fail_timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="random"><a href="#random" class="headerlink" title="random"></a>random</h4><p>ä½¿ç”¨ <code>random</code> æŒ‡ä»¤æŒ‡å®šè´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œå°†è¯·æ±‚éšæœºä¼ é€’ç»™éšæœºé€‰æ‹©çš„åç«¯æœåŠ¡å™¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>random [two [method]];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸º <code>random</code></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	random<span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="least-conn"><a href="#least-conn" class="headerlink" title="least_conn"></a>least_conn</h4><p>ä½¿ç”¨ <code>least_conn</code> æŒ‡ä»¤æŒ‡å®šè´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™æœ€å°‘æ´»åŠ¨è¿æ¥æ•°çš„åç«¯æœåŠ¡å™¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>least_conn;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸º <code>least_conn</code></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	least_conn<span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h4><p>ä½¿ç”¨ <code>ip_hash</code> æŒ‡ä»¤æŒ‡å®šè´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œå°†ç›¸åŒ IP çš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•ä¼ é€’åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>ip_hash;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸º <code>ip_hash</code></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	<span class="token keyword">ip_hash</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h4><p>ä½¿ç”¨ <code>hash</code> æŒ‡ä»¤æŒ‡å®šè´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œå¯ä»¥å°†ç›¸åŒ URL çš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•ä¼ é€’åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>hash key [consistent];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡æ–¹å¼ä¸º <code>hash</code></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	hash <span class="token operator">&amp;</span>request_uri consistent<span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>å¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> filebackend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">upstream</span> imagebackend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.134</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span>file<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>filebackend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span>image<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>imagebackend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> stonebackend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">upstream</span> shibackend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.134</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span>	<span class="token number">8080</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>stonecoding<span class="token punctuation">.</span>net<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>stonebackend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span>	<span class="token number">8080</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> www<span class="token punctuation">.</span>shihanle<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>shibackend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¸¦æœ‰ URL é‡å†™çš„è´Ÿè½½å‡è¡¡ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">upstream</span> backend <span class="token punctuation">&#123;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.131</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.132</span><span class="token punctuation">;</span>
	<span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.133</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">listen</span>	<span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span>file<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token operator">/</span>file<span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">server</span><span class="token operator">/</span>$<span class="token number">1</span> last<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å››å±‚"><a href="#å››å±‚" class="headerlink" title="å››å±‚"></a>å››å±‚</h3><p>Nginx ä½¿ç”¨ Stream æ¨¡å—ä¸‹çš„æŒ‡ä»¤å®ç°å››å±‚è´Ÿè½½å‡è¡¡ï¼Œè¯¥æ¨¡å—åœ¨ Nginx 1.9.0 åå¯ç”¨ï¼Œç”¨æ³•ä¸ Http æ¨¡å—ç±»ä¼¼ï¼Œå…è®¸é…ç½®ä¸€ç»„ TCP æˆ–è€… UDP ç­‰åè®®çš„ç›‘å¬ï¼Œç„¶åé€šè¿‡ <code>proxy_pass</code> è½¬å‘è¯·æ±‚ï¼Œé€šè¿‡ <code>upstream</code> æ·»åŠ å¤šä¸ªåç«¯æœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><p>ä½¿ç”¨ <code>stream</code> æŒ‡ä»¤æŒ‡å®šå››å±‚è´Ÿè½½å‡è¡¡çš„é…ç½®ã€‚ä½äº [ngx_stream_core_moduleopen in new window] æ¨¡å—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>stream &#123; ... &#125;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>main</code></td>
</tr>
</tbody></table>
<h4 id="server-1"><a href="#server-1" class="headerlink" title="server"></a>server</h4><p>ä½¿ç”¨ <code>server</code> æŒ‡ä»¤åœ¨ <code>stream</code> ä¸­å®šä¹‰è™šæ‹ŸæœåŠ¡å™¨ã€‚ä½äº [ngx_stream_core_moduleopen in new window]æ¨¡å—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>server &#123; ... &#125;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>stream</code></td>
</tr>
</tbody></table>
<h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>ä½¿ç”¨ <code>listen</code> æŒ‡ä»¤åœ¨ <code>server</code> ä¸­æŒ‡å®šç›‘å¬çš„åœ°å€å’Œç«¯å£ã€‚ä½äº [ngx_stream_core_moduleopen in new window] æ¨¡å—ã€‚</p>
<p>| Syntax:  | <code>listen address:port [ssl] [udp] [proxy_protocol] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]];</code> |<br>| :â€”â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |<br>| Default: | â€”                                                            |<br>| Context: | <code>server</code>                                                     |</p>
<h4 id="proxy-pass-1"><a href="#proxy-pass-1" class="headerlink" title="proxy_pass"></a>proxy_pass</h4><p>ä½¿ç”¨ <code>proxy_pass</code> æŒ‡ä»¤åœ¨ <code>server</code> ä¸­æŒ‡å®šæœåŠ¡ç«¯åœ°å€ã€‚ä½äº [ngx_stream_proxy_moduleopen in new window] æ¨¡å—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>proxy_pass address;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>server</code></td>
</tr>
</tbody></table>
<h4 id="upstream-1"><a href="#upstream-1" class="headerlink" title="upstream"></a>upstream</h4><p>ä½¿ç”¨ <code>upstream</code> æŒ‡ä»¤åœ¨ <code>stream</code> ä¸­å®šä¹‰ä¸€ç»„åç«¯æœåŠ¡å™¨ã€‚ä½äº [ngx_stream_upstream_moduleopen in new window]æ¨¡å—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>upstream name &#123; ... &#125;</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>stream</code></td>
</tr>
</tbody></table>
<h4 id="server-2"><a href="#server-2" class="headerlink" title="server"></a>server</h4><p>ä½¿ç”¨ <code>server</code> æŒ‡ä»¤åœ¨ <code>upstream</code> ä¸­å®šä¹‰åç«¯æœåŠ¡å™¨çš„åœ°å€åŠå…¶ä»–å‚æ•°ã€‚ä½äº [ngx_stream_upstream_moduleopen in new window]æ¨¡å—ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Syntax:</th>
<th><code>server address [parameters];</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Default:</td>
<td>â€”</td>
</tr>
<tr>
<td align="left">Context:</td>
<td><code>upstream</code></td>
</tr>
</tbody></table>
<p><code>parameters</code> åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>weight=number</code>ï¼šåç«¯æœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1ã€‚</li>
<li><code>max_conns=number</code>ï¼šåˆ°åç«¯æœåŠ¡å™¨çš„æœ€å¤§æ´»åŠ¨è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºæ— é™åˆ¶ã€‚</li>
<li><code>max_fails=number</code>ï¼šè®¾ç½®è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚</li>
<li><code>fail_timeout=time</code>ï¼šå¤±è´¥æ¬¡æ•°è¾¾åˆ° <code>max_fails</code> åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´ï¼Œé»˜è®¤ä¸º 10 ç§’ã€‚</li>
<li><code>backup</code>ï¼šæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œåœ¨ä¸»æœåŠ¡å™¨ä¸å¯ç”¨åå¯ç”¨ã€‚</li>
<li><code>down</code>ï¼šæ ‡è®°è¯¥æœåŠ¡å™¨ä¸ºä¸å¯ç”¨ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --name redis1 -p 6378:6379 redis</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --name redis2 -p 6379:6379 redis</span>
<span class="token punctuation">[</span>root@server ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS                                       NAMES
528f9acd05e9   redis     <span class="token string">"docker-entrypoint.sâ€¦"</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6379-<span class="token operator">></span><span class="token number">6379</span>/tcp, :::6379-<span class="token operator">></span><span class="token number">6379</span>/tcp   redis2
a0b16f5ff613   redis     <span class="token string">"docker-entrypoint.sâ€¦"</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:6378-<span class="token operator">></span><span class="token number">6379</span>/tcp, :::6378-<span class="token operator">></span><span class="token number">6379</span>/tcp   redis1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®è´Ÿè½½å‡è¡¡ï¼š</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx">stream <span class="token punctuation">&#123;</span>
    <span class="token keyword">upstream</span> redisbackend <span class="token punctuation">&#123;</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">6378</span><span class="token punctuation">;</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.92</span><span class="token number">.129</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">server</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">listen</span>  <span class="token number">6379</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span> redisbackend<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">ç»™ä¸ªé¥­é’±ï¼Ÿ</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/J2Sv6rVeLtAPiHx.jpg"><img loading="lazy" src="https://i.loli.net/2020/12/23/J2Sv6rVeLtAPiHx.jpg" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/4rBXF1deMD6KyN8.png"><img loading="lazy" src="https://i.loli.net/2020/12/23/4rBXF1deMD6KyN8.png" alt="QQ æ”¯ä»˜" title="QQ æ”¯ä»˜"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://i.loli.net/2020/12/23/XvirFV3o6GyRMZU.png"><img loading="lazy" src="https://i.loli.net/2020/12/23/XvirFV3o6GyRMZU.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Sovzn</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://sovzn.github.io/2025/11/16/Nginx/" title="Nginx">http://sovzn.github.io/2025/11/16/Nginx/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2026/01/20/%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/" rel="prev" title="éš”ç¦»çº§åˆ«"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">éš”ç¦»çº§åˆ«</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2025/10/26/ElasticSearch-7-14/" rel="next" title="ElasticSearch-7.14"><span class="post-nav-text">ElasticSearch-7.14</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>ç‚¹å‡»æŒ‰é’®è·³è½¬ GitHub Issues è¯„è®ºã€‚</span><br><span>è‹¥æ²¡æœ‰æœ¬æ–‡ Issueï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Comment æ¨¡ç‰ˆæ–°å»ºã€‚</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+Nginx">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2026 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Sovzn</span></div><div class="live_time"><span>æœ¬åšå®¢å·²è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-04-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " å¤© " + passHour + " å°æ—¶ " + passMinute + " åˆ† " + passSecond + " ç§’";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>